d = d_pointfromline(cbind(data$I, data$X, data$Y), betas),
posX = d * cos(angle),
posY = d * sin(angle)
)
# return(data_ang[!is.nan(data_ang$angle) | !(data_ang$d == 0),])
return(data_ang)
}
compute_angles(data[,c(1, 5, 2, 3)])
angles <- compute_angles(data[,c(1, 5, 2, 3)])
angles
plot <- ggplot(angles, aes(posX, posY)) + geom_point(aes(colour = angle))
plot
# Compute angle
compute_angles <- function(data, betas = c(rep(sqrt(1/3), 3))){
# data_ang <- data[,cols]
colnames(data)[c(1,2,3, 4)] <- c("gene","I", "X", "Y")
print(str(data))
# d = d_pointfromline(cbind(data$I, data$X, data$Y), betas)
data$tann <- atan((data$I - data$X)/(data$I- data$Y))
# print(tann)
data <- data[complete.cases(data),]
data_ang <- mutate(data,
angle = as.circular(tann),
d = d_pointfromline(cbind(data$I, data$X, data$Y), betas),
posX = d * cos(angle*2),
posY = d * sin(angle*2)
)
# return(data_ang[!is.nan(data_ang$angle) | !(data_ang$d == 0),])
return(data_ang)
}
angles <- compute_angles(data[,c(1, 5, 2, 3)])
plot <- ggplot(angles, aes(posX, posY)) + geom_point(aes(colour = angle))
plot
library(XML)
library(OpenStreetMap)
library(dplyr)
setwd("C:/Users/Clemt/Documents/Maps/Medicine")
bar_binned <- bar %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by(pix) %>% transmute(n_bar = n())
bar <- read.csv("bar.csv", stringsAsFactors = F)[,1:3]
pharmacy <- read.csv("pharmacy.csv", stringsAsFactors = F)[,1:3]
colnames(bar) <-  c("id", "lat", "lon")
colnames(pharmacy) <-  c("id", "lat", "lon")
bw <- 5
# bar_binned <- bar %>% mutate(latb = lat %/% bw,
# lonb = lon %/% bw) %>% group_by(pix = interaction(latb, lonb)) %>% count()
bar_binned <- bar %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by(pix) %>% transmute(n_bar = n())
pharmacy_binned <- pharmacy %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by( pix) %>% transmute(n_pharmacy = n())
#
head(pharmacy_binned    )
ratio <- merge(bar_binned, pharmacy_binned, all = T)
head(ratio)
head(pharmacy_binned)
rm(ratio)
bar_binned <- bar %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by(pix) %>% summarise(n_bar = n())
(n_pharmacy = n())
pharmacy_binned <- pharmacy %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by( pix) %>% summarise(n_pharmacy = n())
ratio <- merge(bar_binned, pharmacy_binned, all = T)
ratio
bar_binned <- bar %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by(pix, latb, lonb) %>% summarise(n_bar = n())
ratio <- merge(bar_binned, pharmacy_binned, all = T)
summary(ratio)
ratio
pharmacy_binned
pharmacy_binned <- pharmacy %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by( pix, latb, lonb) %>% summarise(n_pharmacy = n())
pharmacy_binned
ratio <- merge(bar_binned, pharmacy_binned, all = T)
ratio
ratio$n_bar[is.na(ratio$n_bar)] <- 0
ratio$n_pharmacy[is.na(ratio$n_pharmacy)] <- 0
summary(ratio)
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy))
summary(ratio)
library(ggplot2)
map <- ggplot(ratio, aes(lonb, latb))+ geom_point(aes(colour(r))) + scale_color_gradient2(mid.point = mean(r))
map <- ggplot(ratio, aes(lonb, latb))+ geom_point(aes(colour(r))) + scale_color_gradient2(mid.point = mean(ratio$r))
map <- ggplot(ratio, aes(lonb, latb))+ geom_point(aes(colour(r))) + scale_color_gradient2(midpoint = mean(ratio$r))
map
map <- ggplot(ratio, aes(lonb, latb))+ geom_point(aes(colour =r)) + scale_color_gradient2(midpoint = mean(ratio$r))
map
bw <- 1
pharmacy_binned <- pharmacy %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by( pix, latb, lonb) %>% summarise(n_pharmacy = n())
ratio$n_bar[is.na(ratio$n_bar)] <- 0
ratio$n_pharmacy[is.na(ratio$n_pharmacy)] <- 0
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy))
summary(ratio)
map <- ggplot(ratio, aes(lonb, latb))+ geom_point(aes(colour =r)) + scale_color_gradient2(midpoint = mean(ratio$r))
map
summary(bar)
bw <- 0.1
bar_binned <- bar %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by(pix, latb, lonb) %>% summarise(n_bar = n())
bar_binned <- bar %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by(pix, latb, lonb) %>% summarise(n_bar = n())
pharmacy_binned <- pharmacy %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by( pix, latb, lonb) %>% summarise(n_pharmacy = n())
ratio <- merge(bar_binned, pharmacy_binned, all = T)
ratio$n_bar[is.na(ratio$n_bar)] <- 0
ratio$n_pharmacy[is.na(ratio$n_pharmacy)] <- 0
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy))
summary(ratio)
map <- ggplot(ratio, aes(lonb, latb))+ geom_point(aes(colour =r)) + scale_color_gradient2(midpoint = mean(ratio$r))
map
map <- ggplot(ratio, aes(lonb, latb))+ geom_point(aes(colour =r)) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map
hist(bar$lon)
hist(bar$lat)
bar_binned <- bar %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by(pix, latb, lonb) %>% summarise(n_bar = n())
pharmacy_binned <- pharmacy %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by( pix, latb, lonb) %>% summarise(n_pharmacy = n())
ratio$n_bar[is.na(ratio$n_bar)] <- 0
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy))
summary(ratio)
map <- ggplot(ratio, aes(lonb, latb))+ geom_point(aes(colour =r)) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map
bar_binned <- bar %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by(pix, latb, lonb) %>% summarise(n_bar = n())
bar_binned
bar_binned <- bar %>% filter(lon < 20 & lon > -20 & lat > 40)
bar_binned
summary(bar)
summary(bar_binned)
bar_binned <- bar %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by(pix, latb, lonb) %>% summarise(n_bar = n())
pharmacy_binned <- pharmacy %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by( pix, latb, lonb) %>% summarise(n_pharmacy = n())
ratio <- merge(bar_binned, pharmacy_binned, all = T)
ratio$n_bar[is.na(ratio$n_bar)] <- 0
ratio$n_pharmacy[is.na(ratio$n_pharmacy)] <- 0
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy))
summary(ratio)
map <- ggplot(ratio, aes(lonb, latb))+ geom_point(aes(colour =r)) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map
bw <- 1
bar_binned <- bar %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by(pix, latb, lonb) %>% summarise(n_bar = n())
pharmacy_binned <- pharmacy %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by( pix, latb, lonb) %>% summarise(n_pharmacy = n())
ratio <- merge(bar_binned, pharmacy_binned, all = T)
ratio$n_pharmacy[is.na(ratio$n_pharmacy)] <- 0
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy))
summary(ratio)
map <- ggplot(ratio, aes(lonb, latb))+ geom_point(aes(colour =r)) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map
bar_binned <- bar %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by(pix, latb, lonb) %>% summarise(n_bar = n())
pharmacy_binned <- pharmacy %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by( pix, latb, lonb) %>% summarise(n_pharmacy = n())
ratio <- merge(bar_binned, pharmacy_binned, all = T)
ratio$n_bar[is.na(ratio$n_bar)] <- 0
ratio$n_pharmacy[is.na(ratio$n_pharmacy)] <- 0
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy))
summary(ratio)
map <- ggplot(ratio, aes(lonb, latb))+ geom_point(aes(colour =r)) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map
map <- ggplot(ratio, aes(lonb, latb))+ geom_point(aes(colour =r), size = 3) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map
library(mapproj)
install.packages("mapproj")
library(mapproj)
head(bar)
mapproject(bar$lon, bar$lat)
head(mapproject(bar$lon, bar$lat))
head(bar)
mapproject(head(bar$lon), head(bar$lat))
mapproject(head(bar$lon), head(bar$lat), projection = mercaztor())
mapproject(head(bar$lon), head(bar$lat), projection = mercator())
mapproject(head(bar$lon), head(bar$lat), projection = "mercator")
coords <- mapproject(ratio$lonb, ratio$latb)
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 3) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map
coords <- mapproject(ratio$lonb, ratio$latb, projection = "bicentric")
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
coords <- mapproject(ratio$lonb, ratio$latb, projection = "bicentric")
coords <- mapproject(ratio$lonb, ratio$latb, projection = "bicentric(lon0)")
coords <- mapproject(ratio$lonb, ratio$latb, projection = "bicentric(0)")
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
coords <- mapproject(ratio$lonb, ratio$latb, projection = "bicentric(0)")
coords <- mapproject(ratio$lonb, ratio$latb, projection = "cylendrical")
coords <- mapproject(ratio$lonb, ratio$latb, projection = "cylindrical")
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 3) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map
coords <- mapproject(ratio$lonb, ratio$latb, projection = "gilbert")
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 3) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map
coords <- mapproject(ratio$lonb, ratio$latb, projection = "mollweide")
summary(ratio)
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 3) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map
coords <- mapproject(ratio$lonb, ratio$latb, projection = "orthographic")
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 3) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map
map + theme_void()+ coord_fixed()
coords <- mapproject(ratio$lonb, ratio$latb, projection = "mercator")
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 3) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map + theme_void()+ coord_fixed()
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 5) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map + theme_void()+ coord_fixed()
coords <- mapproject(ratio$lonb, ratio$latb, projection = "rectangular")
coords <- mapproject(ratio$lonb, ratio$latb, projection = "rectangular(lat0)")
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
summary(ratio)
amples
library(maps)
# Bonne equal-area projection with state abbreviations
map("state",proj='bonne', param=45)
data(state)
text(mapproject(state.center), state.abb)
# this does not work because the default orientations are different:
map("state",proj='bonne', param=45)
text(mapproject(state.center,proj='bonne',param=45),state.abb)
map("state",proj="albers",par=c(30,40))
map("state",par=c(20,50)) # another Albers projection
map("world",proj="gnomonic",orient=c(0,-100,0)) # example of orient
# see map.grid for more examples
# tests of projections added RSB 091101
projlist <- c("aitoff", "albers", "azequalarea", "azequidist", "bicentric",
"bonne", "conic", "cylequalarea", "cylindrical", "eisenlohr", "elliptic",
"fisheye", "gall", "gilbert", "guyou", "harrison", "hex", "homing",
"lagrange", "lambert", "laue", "lune", "mercator", "mollweide", "newyorker",
"orthographic", "perspective", "polyconic", "rectangular", "simpleconic",
"sinusoidal", "tetra", "trapezoidal")
x <- seq(-100, 0, 10)
y <- seq(-45, 45, 10)
xy <- expand.grid(x=x, y=y)
pf <- c(0, 2, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 2, 0, 1, 0, 2, 0, 2,
0, 0, 1, 0, 1, 0, 1, 2, 0, 0, 2)
res <- vector(mode="list", length=length(projlist))
for (i in seq(along=projlist)) {
if (pf[i] == 0) res[[i]] <- mapproject(xy$x, xy$y, projlist[i])
else if (pf[i] == 1) res[[i]] <- mapproject(xy$x, xy$y, projlist[i], 0)
else res[[i]] <- mapproject(xy$x, xy$y, projlist[i], c(0,0))
}
names(res) <- projlist
lapply(res, function(p) rbind(p$x, p$y))
coords <- mapproject(ratio$lonb, ratio$latb, projection = "rectangular", param = 45)
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 5) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map + theme_void()+ coord_fixed()
bw <- 0.6
bar_binned <- bar %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by(pix, latb, lonb) %>% summarise(n_bar = n())
ratio$n_bar[is.na(ratio$n_bar)] <- 0
ratio$n_pharmacy[is.na(ratio$n_pharmacy)] <- 0
coords <- mapproject(ratio$lonb, ratio$latb, projection = "rectangular", param = 45)
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 5) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map + theme_void()+ coord_fixed()
bw <- 2
# bar_binned <- bar %>% mutate(latb = lat %/% bw,
# lonb = lon %/% bw) %>% group_by(pix = interaction(latb, lonb)) %>% count()
bar_binned <- bar %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by(pix, latb, lonb) %>% summarise(n_bar = n())
pharmacy_binned <- pharmacy %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by( pix, latb, lonb) %>% summarise(n_pharmacy = n())
# colnames(pharmacy_binned)<- c("pix", "np")
ratio <- merge(bar_binned, pharmacy_binned, all = T)
ratio$n_bar[is.na(ratio$n_bar)] <- 0
ratio$n_pharmacy[is.na(ratio$n_pharmacy)] <- 0
coords <- mapproject(ratio$lonb, ratio$latb, projection = "rectangular", param = 45)
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 5) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map + theme_void()+ coord_fixed()
bw <- 0.4
# bar_binned <- bar %>% mutate(latb = lat %/% bw,
# lonb = lon %/% bw) %>% group_by(pix = interaction(latb, lonb)) %>% count()
bar_binned <- bar %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by(pix, latb, lonb) %>% summarise(n_bar = n())
pharmacy_binned <- pharmacy %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by( pix, latb, lonb) %>% summarise(n_pharmacy = n())
# colnames(pharmacy_binned)<- c("pix", "np")
ratio <- merge(bar_binned, pharmacy_binned, all = T)
ratio$n_bar[is.na(ratio$n_bar)] <- 0
ratio$n_pharmacy[is.na(ratio$n_pharmacy)] <- 0
coords <- mapproject(ratio$lonb, ratio$latb, projection = "rectangular", param = 45)
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 5) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map + theme_void()+ coord_fixed()
bw <- 0.6
# bar_binned <- bar %>% mutate(latb = lat %/% bw,
# lonb = lon %/% bw) %>% group_by(pix = interaction(latb, lonb)) %>% count()
bar_binned <- bar %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by(pix, latb, lonb) %>% summarise(n_bar = n())
pharmacy_binned <- pharmacy %>% filter(lon < 20 & lon > -20 & lat > 40) %>% transmute(latb = lat %/% bw,
lonb = lon %/% bw, pix = interaction(latb, lonb)) %>% group_by( pix, latb, lonb) %>% summarise(n_pharmacy = n())
# colnames(pharmacy_binned)<- c("pix", "np")
ratio <- merge(bar_binned, pharmacy_binned, all = T)
ratio$n_bar[is.na(ratio$n_bar)] <- 0
ratio$n_pharmacy[is.na(ratio$n_pharmacy)] <- 0
coords <- mapproject(ratio$lonb, ratio$latb, projection = "rectangular", param = 45)
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 5) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map + theme_void()+ coord_fixed()
ratio$r[ratio$r == Inf] <- max(ratio$r)
ratio$r[ratio$r == -Inf] <- min(ratio$r)
coords <- mapproject(ratio$lonb, ratio$latb, projection = "rectangular", param = 45)
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 5) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map + theme_void()+ coord_fixed()
ratio$r[ratio$r == Inf] <- max(ratio$r[!is.inf(ratio$r)])
ratio$r[ratio$r == -Inf] <- min(ratio$r[!is.inf(ratio$r)])
ratio$r[ratio$r == Inf] <- max(ratio$r[!is.infinite(ratio$r)])
ratio$r[ratio$r == -Inf] <- min(ratio$r[!is.infinite(ratio$r)])
coords <- mapproject(ratio$lonb, ratio$latb, projection = "rectangular", param = 45)
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
summary(ratio)
is.infinite(ratio$r)
max(ratio$r[!is.infinite(ratio$r)])
ratio$r[ratio$r == Inf]
ratio$r[ratio$r == Inf] <- max(ratio$r[!is.infinite(ratio$r)])
ratio$r[ratio$r == Inf]
ratio$r[ratio$r == -Inf] <- min(ratio$r[!is.infinite(ratio$r)])
coords <- mapproject(ratio$lonb, ratio$latb, projection = "rectangular", param = 45)
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 5) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map + theme_void()+ coord_fixed()
summary(ratio)
ratio$r[ratio$r == -Inf]
ratio$r[ratio$r == Inf]
ratio$r[ratio$r == Inf] <- max(ratio$r[!is.infinite(ratio$r)])
ratio
summary(ratio)
ratio$r[ratio$r == -Inf] <- min(ratio$r[!is.infinite(ratio$r)])
summary(ratio)
coords <- mapproject(ratio$lonb, ratio$latb, projection = "rectangular", param = 45)
ratio <- mutate(ratio, r = log(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 5) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map + theme_void()+ coord_fixed()
ratio$r[ratio$r == Inf] <- max(ratio$r[!is.infinite(ratio$r)])
ratio$r[ratio$r == -Inf] <- min(ratio$r[!is.infinite(ratio$r)])
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 5) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map + theme_void()+ coord_fixed()
ratio <- mutate(ratio, r = log2(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
ratio$r[ratio$r == Inf] <- max(ratio$r[!is.infinite(ratio$r)])
ratio$r[ratio$r == -Inf] <- min(ratio$r[!is.infinite(ratio$r)])
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 5) + scale_color_gradient2(midpoint = median(ratio$r), low = "green", high = "red")
map + theme_void()+ coord_fixed()
exp(1)
log2(2)
log2(4)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r), size = 5) + scale_color_gradient2(midpoint = 0, low = "green", high = "red")
map + theme_void()+ coord_fixed()
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r, size = n_pharmacy + n_bar),) + scale_color_gradient2(midpoint = 0, low = "green", high = "red")
map + theme_void()+ coord_fixed()
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r, alpha = n_pharmacy + n_bar),size = 5) + scale_color_gradient2(midpoint = 0, low = "green", high = "red")
map + theme_void()+ coord_fixed()
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r, alpha = log(n_pharmacy + n_bar)),size = 5) + scale_color_gradient2(midpoint = 0, low = "green", high = "red")
map + theme_void()+ coord_fixed()
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r),size = 5) + scale_color_gradient2(midpoint = 0, low = "green", high = "red")
map + theme_void()+ coord_fixed()
coords <- mapproject(ratio$lonb, ratio$latb, projection = "azequalarea", param = 45)
coords <- mapproject(ratio$lonb, ratio$latb, projection = "azequalarea")#, param = 45)
ratio <- mutate(ratio, r = log2(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
ratio$r[ratio$r == Inf] <- max(ratio$r[!is.infinite(ratio$r)])
ratio$r[ratio$r == -Inf] <- min(ratio$r[!is.infinite(ratio$r)])
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r),size = 5) + scale_color_gradient2(midpoint = 0, low = "green", high = "red")
map + theme_void()+ coord_fixed()
coords <- mapproject(ratio$lonb, ratio$latb, projection = "guilbert")#, param = 45)
coords <- mapproject(ratio$lonb, ratio$latb, projection = "gilbert")#, param = 45)
ratio <- mutate(ratio, r = log2(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
ratio$r[ratio$r == Inf] <- max(ratio$r[!is.infinite(ratio$r)])
ratio$r[ratio$r == -Inf] <- min(ratio$r[!is.infinite(ratio$r)])
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r),size = 5) + scale_color_gradient2(midpoint = 0, low = "green", high = "red")
map + theme_void()+ coord_fixed()
map + theme_void()+ coord_fixed()
coords <- mapproject(ratio$lonb, ratio$latb, projection = "mercator")#, param = 45)
coords <- mapproject(ratio$lonb, ratio$latb, projection = "mercator")#, param = 45)
ratio <- mutate(ratio, r = log2(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
ratio$r[ratio$r == Inf] <- max(ratio$r[!is.infinite(ratio$r)])
ratio$r[ratio$r == -Inf] <- min(ratio$r[!is.infinite(ratio$r)])
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r),size = 5) + scale_color_gradient2(midpoint = 0, low = "green", high = "red")
map + theme_void()+ coord_fixed()
coords <- mapproject(ratio$lonb, ratio$latb, projection = "mercator")#, param = 45)
ratio <- mutate(ratio, r = log2(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
ratio$r[ratio$r == Inf] <- max(ratio$r[!is.infinite(ratio$r)])
ratio$r[ratio$r == -Inf] <- min(ratio$r[!is.infinite(ratio$r)])
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r),size = 5) + scale_color_gradient2(midpoint = 0, low = "green", high = "red")
map + theme_void()+ coord_fixed()
coords <- mapproject(ratio$lonb, ratio$latb, projection = "rectangular")#, param = 45)
coords <- mapproject(ratio$lonb, ratio$latb, projection = "cylindrical")#, param = 45)
ratio <- mutate(ratio, r = log2(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
ratio$r[ratio$r == Inf] <- max(ratio$r[!is.infinite(ratio$r)])
ratio$r[ratio$r == -Inf] <- min(ratio$r[!is.infinite(ratio$r)])
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r),size = 5) + scale_color_gradient2(midpoint = 0, low = "green", high = "red")
map + theme_void()+ coord_fixed()
coords <- mapproject(ratio$lonb, ratio$latb, projection = "rectangular", param = 45)
ratio <- mutate(ratio, r = log2(n_bar/n_pharmacy), lonb2 = coords$x, latb2 = coords$y)
ratio$r[ratio$r == Inf] <- max(ratio$r[!is.infinite(ratio$r)])
ratio$r[ratio$r == -Inf] <- min(ratio$r[!is.infinite(ratio$r)])
summary(ratio)
map <- ggplot(ratio, aes(lonb2, latb2))+ geom_point(aes(colour =r),size = 5) + scale_color_gradient2(midpoint = 0, low = "green", high = "red")
map + theme_void()+ coord_fixed()
?install.packages
getd()
getwd()
list.files(getwd())
install.packages("C:/Users/Clemt/Downloads/mountgrass_1.07.5.tar.gz")
install.packages("C:/Users/Clemt/Downloads/mountgrass_1.07.5.tar.gz", repos = NULL)
install.packages("C:/Users/Clemt/Downloads/mountgrass_1.07.5.tar.gz", repos = NULL, dependencies = T)
install.packages(c("xts", "tidyr", "fields", "data.table", "lubridate", "gridExtra"))
library(mountgrass)
install.packages("C:/Users/Clemnt/Downloads/mountgrass_1.07.5.tar.gz", repos = NULL, type="source")
list.files("C:/Users/Clemnt/Downloads/")
list.files("C:\Users\Clemnt\Downloads\")
list.files("C:/Users/Clemt/Downloads/")
install.packages("C:/Users/Clemt/Downloads/mountgrass_1.07.5.tar.gz", repos = NULL, type="source")
library(mountgrass)
library(tidyr# load data
)
library(ggplot2)
setwd(dir = "C:/Users/Clemt/PhD/PhD/")
setwd(dir = "C:/Users/Clemt/Documents/PhD/PhD/")
library(readr)
install.packages("readr")
library(readr)
showtime <- read_rds("Resources/2017-12-17_showtime2.rds")
summary(showtime)
showtime$plasticity <- as.factor(showtime$plasticity, levels = c("none", "fixed-equilibrium", "fixed", "plastic"))
showtime$plasticity <- factor(showtime$plasticity, levels = c("none", "fixed-equilibrium", "fixed", "plastic"))
showtime <- showtime %>% transmute(
RGR = RGR,
BM_ag = BM_ag,
BM_bg = BM_bg,
BM_tot = BM_ag + BM_bg+ stem,
stem = stem,
PAS = 1 / (1+1/as_s),
PAR = 1 / (1+1/as_r),
RMF = BM_bg / (BM_ag + BM_bg),
NPP = NPP,
respiration = respiration
)
showtime$plasticity <- factor(showtime$plasticity, levels = c("none", "fixed-equilibrium", "fixed", "plastic"))
showtime_med <- showtime %>% group_by(rain, plasticity, tau, age) %>% summarise_all(mediam)
showtime <- showtime %>% group_by(rain, plasticity, tau, age) %>% transmute(
RGR = RGR,
BM_ag = BM_ag,
BM_bg = BM_bg,
BM_tot = BM_ag + BM_bg+ stem,
stem = stem,
PAS = 1 / (1+1/as_s),
PAR = 1 / (1+1/as_r),
RMF = BM_bg / (BM_ag + BM_bg),
NPP = NPP,
respiration = respiration
)
showtime <- read_rds("Resources/2017-12-17_showtime2.rds")
showtime <- showtime %>% group_by(rain, plasticity, tau, age) %>% transmute(
RGR = RGR,
BM_ag = BM_ag,
BM_bg = BM_bg,
BM_tot = BM_ag + BM_bg+ stem,
stem = stem,
PAS = 1 / (1+1/as_s),
PAR = 1 / (1+1/as_r),
RMF = BM_bg / (BM_ag + BM_bg),
NPP = NPP,
respiration = respiration
)
showtime$plasticity <- factor(showtime$plasticity, levels = c("none", "fixed-equilibrium", "fixed", "plastic"))
showtime_med <- showtime %>% group_by(rain, plasticity, tau, age) %>% summarise_all(mediam)
showtime_med <- showtime %>% group_by(rain, plasticity, tau, age) %>% summarise_all(median)
showtime_med %>% ggplot(aes(age, BM_tot)) + faecet_wrap(~plasticity) + geom_line(aes(colour = as.facot(tau)))+
theme_mountgrass() + scale_colour_mountgrass()
showtime_med %>% ggplot(aes(age, BM_tot)) + facet_wrap(~plasticity) + geom_line(aes(colour = as.facot(tau)))+
theme_mountgrass() + scale_colour_mountgrass()
showtime_med %>% ggplot(aes(age, BM_tot)) + facet_wrap(~plasticity) + geom_line(aes(colour = as.factor(tau)))+
theme_mountgrass() + scale_colour_mountgrass()
showtime_med %>% ggplot(aes(age, BM_tot)) + facet_grid(rain~plasticity) + geom_line(aes(colour = as.factor(tau)))+
theme_mountgrass() + scale_colour_mountgrass()
showtime_med %>% ggplot(aes(age, BM_tot)) + facet_grid(rain~plasticity) + geom_line(aes(colour = as.factor(tau)))+
theme_mountgrass() + scale_colour_mountgrass() + geom_ribbon(data = showtime, aes(ymin = min(BM_tot), ymax = max(BM_tot)))
showtime_med %>% ggplot(aes(age, PAS)) + facet_grid(rain~plasticity) + geom_line(aes(colour = as.factor(tau)))+
theme_mountgrass() + scale_colour_mountgrass()
summary(showtime)
showtime2 <- read_rds("Resources/2017-12-17_showtime2.rds")
summary(showtime2)
length(unique(showtime$par_v))
length(unique(showtime2$par_v))
