if(!window.com_zimbra_attachmail){
com_zimbra_attachmail={}
}
a=com_zimbra_attachmail;
a.label="Email Attacher";
a.description="Attach email messages when composing a new message.";
a.AttachMailZimlet_panel_label="Email Attacher";
a.AttachMailZimlet_panel_tooltip='Adds an "Attach Mail" tab to the compose toolbar "Add Attachment" dialog.';
a.AttachMailZimlet_tab_label="Mail";
a.AttachMailZimlet_tab_button_search="Search";
a.AttachMailZimlet_tab_button_view="View Message";
delete a;
if(!window.com_zimbra_attachmail){
com_zimbra_attachmail={}
}
a=com_zimbra_attachmail;
a.label="Email Attacher";
a.description="Joignez des mails lorsque vous en r\u00e9digez un nouveau.";
a.AttachMailZimlet_panel_label="Email Attacher";
a.AttachMailZimlet_panel_tooltip='Ajoute une \u00e9tiquette "Joindre mail" \u00e0 la barre d\'outils de composition de la bo\u00eete de dialogue "Ajouter pi\u00e8ce jointe".';
a.AttachMailZimlet_tab_label="Mail";
a.AttachMailZimlet_tab_button_search="Rechercher";
a.AttachMailZimlet_tab_button_view="Visualiser message";
delete a;
if(!window.com_zimbra_srchhighlighter){
com_zimbra_srchhighlighter={}
}
a=com_zimbra_srchhighlighter;
a.label="Search Highlighter";
a.description="After a mail search, this Zimlet highlights Search terms with yellow color.";
a.SearchHighlighterZimlet_MenuLabel="Clear Search Highlights";
a.SearchHighlighterZimlet_ZimletError="Search Highlighter Zimlet Error:";
delete a;
if(!window.com_zimbra_srchhighlighter){
com_zimbra_srchhighlighter={}
}
a=com_zimbra_srchhighlighter;
a.label="Surligneur de recherche";
a.description="Apr\u00e8s une recherche de mail, ce Zimlet surligne les termes de la recherche en jaune";
a.SearchHighlighterZimlet_MenuLabel="\u00c9liminer Surligner la recherche";
a.SearchHighlighterZimlet_ZimletError="Erreur surligneur de recherche Zimlet\u00a0:";
delete a;
if(!window.net_partage_zimletplus){
net_partage_zimletplus={}
}
a=net_partage_zimletplus;
a.zimletPlusLabel="Zimlet plus";
a.zimletPlusDesc="Cr\u00e9ez des marques pages personnalis\u00e9s - V1.3";
a.zimletPanelDesc="Modifiez vos r\u00e9f\u00e9rences des onglets personnels.";
a.validBtnName="Valider";
a.editDialogTitle="R\u00e9f\u00e9rence personnelle";
a.nameCTitle="Nom de l'onglet";
a.urlCTitle="Site (https obligatoire)";
a.CSBtnName="Modifier site";
a.TabAppDefine="L'onglet personnel";
a.noContentInfo1="Aucun contenu";
a.noContentInfo2='Cliquez sur le bouton "Modifier site" pour personnaliser cette page.';
a.newUrlName="Nouveau site";
a.showChangeDialogInfo="Votre adresse doit correspondre \u00e0 une URL valide.";
a.addTrBtnName="Ajouter";
a.okBtnName="Valider";
a.urlChangeErr="L'URL que vous avez saisie ne semble pas correcte.";
a.mode="dev";
a.docInfo1="Attention, apr\u00e8s configuration du Zimlet le nouvel onglet sera gris.";
a.docInfo2="Pour que le site s'affiche correctement veuillez consulter la";
a.docInfo3="Certains sites ne peuvent pas \u00eatre configur\u00e9s dans la Zimlet, pour plus d'informations, veuillez consulter la";
a.docInfo4="documentation";
a.pageCannotLoadInfo="La page web {0} dispose d'un param\u00e9trage qui ne permet pas son affichage dans cette fen\u00eatre.<br><br>Code erreur: {1}.";
a.soapURL="http://localhost/service/soap";
delete a;
if(!window.net_yaziba_chat){
net_yaziba_chat={}
}
a=net_yaziba_chat;
a.jabberUrl_dev="http://ppd-im.partage.renater.fr:5280/http-bind/";
a.jabberUrl_prod="http://im.partage.renater.fr:5280/http-bind/";
a.yazibaUrl_dev="https://ppd-mail.partage.renater.fr";
a.yazibaUrl_prod="https://webmail.partage.renater.fr";
a.smile="Sourire";
a["smile-big"]="Grand sourire";
a.sad="Triste";
a.wink="Clin d'\u0153il";
a.tongue="Tirer la langue";
a.shock="Surprise";
a.kiss="Bise";
a.crying="Pleurs";
a.angry="F\u00e2ch\u00e9";
a.embarrassed="Embarrass\u00e9";
a.neutral="Neutre";
a.confused="Confus";
a["glasses-cool"]="Cool";
a.thinking="Pens\u00e9e";
a.angel="Ange";
a["shut-mouth"]="Silence";
a.waiting="Attente";
a.bye="Au revoir";
a.sick="Malade";
a.sleepy="Somnolent";
a.good="Bon";
a.bad="Mauvais";
a.rose="Rose";
a["rose-dead"]="Fan\u00e9";
a.phone="T\u00e9l\u00e9phone";
a.mail="Email";
a.lamp="Lampe";
a.cake="G\u00e2teau";
a.love="C\u0153ur";
a["love-over"]="C\u0153ur bris\u00e9";
a["musical-note"]="Musique";
a.beer="Bi\u00e8re";
a.coffee="Caf\u00e9";
a.coins="Monnaie";
a.moon="Lune";
a.sun="soleil";
a.star="\u00e9toile";
a.connect="Disponible";
a.disconnect="D\u00e9connect\u00e9";
a["temp-away"]="Courte absence";
a.chatting="Libre";
a.busy="Occup\u00e9";
a.away="Longue absence";
a["s-online"]="est en ligne.";
a["s-offline"]="est d\u00e9connect\u00e9.";
a["s-temp-away"]="n'est pas l\u00e0 pour instant.";
a["s-chat"]="est libre.";
a["s-busy"]="est occup\u00e9.";
a["s-away"]="est absent.";
a.connError="Merci de bien vouloir actualiser la page puis essayez de vous connecter de nouveau. Si apr\u00e8s cela le zimlet chat ne fonctionne pas, merci de contacter le support.";
a.mailInvalidErr="L'adresse mail est invalide.";
delete a;
if(!window.com_zimbra_url){
com_zimbra_url={}
}
a=com_zimbra_url;
a.zimletLabel="URL Links";
a.description="Highlight Web URLs for linking in email messages.";
a.youTubeTitle="Videos from this email";
a.youTubeTitleMax="Showing {0} videos from this email";
a.youTubeClickToToggle="Click to play or hide video";
a.goToUrl="Go to URL";
a.newCalendar="Create New Calendar";
delete a;
if(!window.com_zimbra_url){
com_zimbra_url={}
}
a=com_zimbra_url;
a.zimletLabel="Liens URL";
a.description="Surligner les URL Web \u00e0 lier dans les mails.";
a.youTubeTitle="Vid\u00e9os de ce mail";
a.youTubeTitleMax="Affichage de {0} vid\u00e9os de ce mail";
a.youTubeClickToToggle="Cliquer pour lire ou masquer la vid\u00e9o";
a.goToUrl="Aller \u00e0 l'URL";
a.newCalendar="Cr\u00e9er un nouveau calendrier";
delete a;
if(!window.com_zimbra_email){
com_zimbra_email={}
}
a=com_zimbra_email;
a.zimletLabel="Email Contact Details";
a.description="Highlights and previews associated contact details for an email address.";
a.preferencesSaved="Preferences Saved";
a.emailZimletPreferences="Email Zimlet Preferences";
a.label="Email";
a.tooltip="Shows Email Zimlet's preferences";
a.VERYSMALL="Very Small";
a.SMALL="Small";
a.MEDIUM="Medium";
a.LARGE="Large";
a.XL="XL";
a["2XL"]="2XL";
a.selectToolTipSize="Please select tool-tip's size:";
a.rightClickForMoreOptions="Right click for more options";
a.contact="Contact";
a.close="Close";
a.slideTooltip="Email Profile";
a.slideMailTooltip="New Email";
a.slideCalendarTooltip="New Appointment";
a.slideChatTooltip="Chat";
a.loading="Loading...";
a.msg_available="Available";
a.msg_unavailable="Unavailable";
a.msg_busy="Busy";
a.msg_away="Away";
a.msg_dnd="Do not disturb";
a.msg_onthephone="On the phone";
a.msg_vacation="Vacation";
a.msg_unknown="Unknown";
a.postalAddress="{0} {1} {2} {3}";
a.jobTitleDepartmentCompany="jobTitle,department,company";
delete a;
if(!window.com_zimbra_email){
com_zimbra_email={}
}
a=com_zimbra_email;
a.zimletLabel="D\u00e9tails contact mail";
a.description="Souligne et donne un aper\u00e7u des d\u00e9tails contact associ\u00e9s \u00e0 une adresse mail.";
a.preferencesSaved="Les pr\u00e9f\u00e9rences ont \u00e9t\u00e9 enregistr\u00e9es.";
a.emailZimletPreferences="Pr\u00e9f\u00e9rences mail Zimlet";
a.label="Adresse mail";
a.tooltip="Affiche les pr\u00e9f\u00e9rences mail Zimlet";
a.VERYSMALL="Tr\u00e8s petit";
a.SMALL="Petit";
a.MEDIUM="Moyen";
a.LARGE="Grand";
a.XL="XL";
a["2XL"]="2XL";
a.selectToolTipSize="Veuillez s\u00e9lectionner la taille de l'info-bulle\u00a0: ";
a.rightClickForMoreOptions="Cliquez avec le bouton droit de la souris pour plus d'options";
a.contact="Contact";
a.close="Fermer";
a.slideTooltip="Profil de messagerie";
a.slideMailTooltip="Nouveau mail";
a.slideCalendarTooltip="Nouveau rendez-vous";
a.slideChatTooltip="Chat";
a.loading="Chargement...";
a.msg_available="Disponible";
a.msg_unavailable="Indisponible";
a.msg_busy="Occup\u00e9";
a.msg_away="Absent";
a.msg_dnd="Ne pas d\u00e9ranger";
a.msg_onthephone="Au t\u00e9l\u00e9phone";
a.msg_vacation="Cong\u00e9";
a.msg_unknown="Inconnu";
a.jobTitleDepartmentCompany="jobTitle,department,company";
delete a;
if(!window.com_zimbra_ymemoticons){
com_zimbra_ymemoticons={}
}
a=com_zimbra_ymemoticons;
a.label="Yahoo! Emoticons";
a.description="Displays Yahoo! Emoticons images in email messages.";
a.yahooEmoticons="Yahoo! Emoticons";
a.temporarilyDisableInMail="Temporarily disable in Mail";
a.preferences="Preferences";
a.enableInMail="Enable Emoticons In Mail";
a.yahoo_emoticons_pref_dialog_title="Yahoo! Emoticons Preferences";
a.emoticon_happy="happy";
a.emoticon_sad="sad";
a.emoticon_pumpkin="pumpkin";
a.emoticon_coffee="coffee";
a.emoticon_blushing="blushing";
a.emoticon_not_talking="not talking";
a.emoticon_big_hug="big hug";
a.emoticon_d_oh="d'oh";
a.emoticon_shame_on_you="shame on you";
a.emoticon_time_out="time out";
a.emoticon_monkey="monkey";
a.emoticon_clown="clown";
a.emoticon_sleepy="sleepy";
a.emoticon_batting_eyelashes="batting eyelashes";
a.emoticon_liar="liar";
a.emoticon_party="party";
a.emoticon_angry="angry";
a.emoticon_confused="confused";
a.emoticon_whew="whew!";
a.emoticon_daydreaming="daydreaming";
a.emoticon_big_grin="big grin";
a.emoticon_dancing="dancing";
a.emoticon_nerd="nerd";
a.emoticon_chatterbox="chatterbox";
a.emoticon_wave="wave";
a.emoticon_call_me="call me";
a.emoticon_drooling="drooling";
a.emoticon_yawn="yawn";
a.emoticon_surprise="surprise";
a.emoticon_hiro="hiro";
a.emoticon_laughing="laughing";
a.emoticon_raised_eyebrow="raised eyebrow";
a.emoticon_idea="idea";
a.emoticon_on_the_phone="on the phone";
a.emoticon_nailbiting="nailbiting";
a.emoticon_yin_yang="yin yang";
a.emoticon_kiss="kiss";
a.emoticon_at_wits_end="at wits' end";
a.emoticon_billy="billy";
a.emoticon_I_dont_know="I don't know";
a.emoticon_hypnotized="hypnotized";
a.emoticon_cow="cow";
a.emoticon_applause="applause";
a.emoticon_waiting="waiting";
a.emoticon_love_struck="love struck";
a.emoticon_dont_tell_anyone="don't tell anyone";
a.emoticon_chicken="chicken";
a.emoticon_bug="bug";
a.emoticon_star="star";
a.emoticon_straight_face="straight face";
a.emoticon_crying="crying";
a.emoticon_skull="skull";
a.emoticon_angel="angel";
a.emoticon_phbbbbt="phbbbbt";
a.emoticon_alien="alien";
a.emoticon_broken_heart="broken heart";
a.emoticon_loser="loser";
a.emoticon_pig="pig";
a.emoticon_bring_it_on="bring it on";
a.emoticon_feeling_beat_up="feeling beat up";
a.emoticon_money_eyes="money eyes";
a.emoticon_thinking="thinking";
a.emoticon_peace_sign="peace sign";
a.emoticon_oh_go_on="oh go on";
a.emoticon_good_luck="good luck";
a.emoticon_not_listening="not listening";
a.emoticon_tongue="tongue";
a.emoticon_not_worthy="not worthy";
a.emoticon_whistling="whistling";
a.emoticon_sigh="sigh";
a.emoticon_puppy_dog_eyes="puppy dog eyes";
a.emoticon_devil="devil";
a.emoticon_talk_to_the_hand="talk to the hand";
a.emoticon_rolling_eyes="rolling eyes";
a.emoticon_flag="flag";
a.emoticon_april="april";
a.emoticon_silly="silly";
a.emoticon_rolling_on_the_floor="rolling on the floor";
a.emoticon_frustrated="frustrated";
a.emoticon_cool="cool";
a.emoticon_winking="winking";
a.emoticon_smug="smug";
a.emoticon_sick="sick";
a.emoticon_cowboy="cowboy";
a.emoticon_worried="worried";
a.emoticon_hee_hee="hee hee";
a.emoticon_praying="praying";
a.emoticon_rose="rose";
delete a;
if(!window.com_zimbra_ymemoticons){
com_zimbra_ymemoticons={}
}
a=com_zimbra_ymemoticons;
a.label="\u00c9motic\u00f4nes Yahoo!";
a.description="Affiche des images \u00c9motic\u00f4nes Yahoo! dans les mails";
a.yahooEmoticons="\u00c9motic\u00f4nes Yahoo!";
a.temporarilyDisableInMail="D\u00e9sactivez temporairement pour cet envoi";
a.preferences="Pr\u00e9f\u00e9rences";
a.enableInMail="Autoriser les \u00e9motic\u00f4nes dans les mails";
a.yahoo_emoticons_pref_dialog_title="Yahoo! Pr\u00e9f\u00e9rences des \u00e9motic\u00f4nes";
a.yahoo_emoticons_toaster_enabled="\u00c9motic\u00f4nes activ\u00e9es dans la messagerie.";
a.yahoo_emoticons_toaster_disabled="\u00c9motic\u00f4nes d\u00e9sactiv\u00e9es dans la messagerie.";
a.yahoo_emoticons_toaster_temporarily_disabled="\u00c9motic\u00f4nes d\u00e9sactiv\u00e9es temporairement.";
a.emoticon_happy="heureux";
a.emoticon_sad="triste";
a.emoticon_pumpkin="citrouille";
a.emoticon_coffee="caf\u00e9";
a.emoticon_blushing="rougissement";
a.emoticon_not_talking="pas bavard";
a.emoticon_big_hug="grande \u00e9treinte";
a.emoticon_d_oh="Pff";
a.emoticon_shame_on_you="quelle honte\u00a0!";
a.emoticon_time_out="on se calme\u00a0!";
a.emoticon_monkey="singe";
a.emoticon_clown="clown";
a.emoticon_sleepy="envie de dormir";
a.emoticon_batting_eyelashes="\u0153illade";
a.emoticon_liar="menteur";
a.emoticon_party="f\u00eate";
a.emoticon_angry="en col\u00e8re";
a.emoticon_confused="perplexe";
a.emoticon_whew="\u00e7a alors\u00a0!";
a.emoticon_daydreaming="r\u00eaverie";
a.emoticon_big_grin="grand sourire";
a.emoticon_dancing="danse";
a.emoticon_nerd="nerd";
a.emoticon_chatterbox="pipelette";
a.emoticon_wave="signe de la main";
a.emoticon_call_me="appelle-moi";
a.emoticon_drooling="j\u2019en bave\u00a0!";
a.emoticon_yawn="b\u00e2illement";
a.emoticon_surprise="surprise";
a.emoticon_hiro="hiro";
a.emoticon_laughing="rire";
a.emoticon_raised_eyebrow="sourcils fronc\u00e9s";
a.emoticon_idea="id\u00e9e";
a.emoticon_on_the_phone="au t\u00e9l\u00e9phone";
a.emoticon_nailbiting="angoissant";
a.emoticon_yin_yang="yin yang";
a.emoticon_kiss="baiser";
a.emoticon_at_wits_end="d\u00e9pass\u00e9";
a.emoticon_billy="ch\u00e8vre";
a.emoticon_I_dont_know="j\u2019sais pas";
a.emoticon_hypnotized="hypnotis\u00e9";
a.emoticon_cow="vache";
a.emoticon_applause="applaudissements";
a.emoticon_waiting="attente";
a.emoticon_love_struck="coup de foudre";
a.emoticon_dont_tell_anyone="ne le dites \u00e0 personne";
a.emoticon_chicken="poulet";
a.emoticon_bug="insecte";
a.emoticon_star="\u00e9toile";
a.emoticon_straight_face="impassible";
a.emoticon_crying="pleurs";
a.emoticon_skull="cr\u00e2ne";
a.emoticon_angel="ange";
a.emoticon_phbbbbt="blblblbl";
a.emoticon_alien="extra-terrestre";
a.emoticon_broken_heart="c\u0153ur bris\u00e9";
a.emoticon_loser="incapable";
a.emoticon_pig="cochon";
a.emoticon_bring_it_on="provocation";
a.emoticon_feeling_beat_up="\u00e9puis\u00e9";
a.emoticon_money_eyes="r\u00eaves d\u2019argent";
a.emoticon_thinking="pensif";
a.emoticon_peace_sign="symbole de paix";
a.emoticon_oh_go_on="sans blague\u00a0?!";
a.emoticon_good_luck="bonne chance";
a.emoticon_not_listening="pas attentif";
a.emoticon_tongue="langue";
a.emoticon_not_worthy="\u00e7a ne vaut pas le coup";
a.emoticon_whistling="siffleur";
a.emoticon_sigh="soupir";
a.emoticon_puppy_dog_eyes="yeux de petit chien";
a.emoticon_devil="diable";
a.emoticon_talk_to_the_hand="parle \u00e0 ma main";
a.emoticon_rolling_eyes="roule les yeux";
a.emoticon_flag="drapeau";
a.emoticon_april="avril";
a.emoticon_silly="b\u00eatise";
a.emoticon_rolling_on_the_floor="mort de rire";
a.emoticon_frustrated="frustr\u00e9";
a.emoticon_cool="cool";
a.emoticon_winking="clin d\u2019\u0153il";
a.emoticon_smug="fier";
a.emoticon_sick="malade";
a.emoticon_cowboy="cow-boy";
a.emoticon_worried="inquiet";
a.emoticon_hee_hee="hi hi";
a.emoticon_praying="pri\u00e8re";
a.emoticon_rose="rose";
delete a;
if(!window.com_zimbra_attachcontacts){
com_zimbra_attachcontacts={}
}
a=com_zimbra_attachcontacts;
a.label="Attach Contacts";
a.description="Allows Attaching contacts when composing a new message.";
a.ACZ_tab_label="Contacts";
a.ACZ_tab_button_search="Search";
a.ACZ_NoContactsFound="No contacts found.";
a.ACZ_Send="Forward";
a.ACZ_SendContact="Forward Contact";
a.ACZ_SendContactsAsAttachments="Send Contacts as email attachments";
a.ACZ_more="({0} more)";
delete a;
if(!window.com_zimbra_attachcontacts){
com_zimbra_attachcontacts={}
}
a=com_zimbra_attachcontacts;
a.label="Joindre contacts";
a.description="Permet de Joindre des contacts lorsque vous composez un nouveau message.";
a.ACZ_tab_label="Contacts";
a.ACZ_tab_button_search="Rechercher";
a.ACZ_NoContactsFound="Aucun contact n'a \u00e9t\u00e9 trouv\u00e9.";
a.ACZ_Send="Faire suivre";
a.ACZ_SendContact="Faire suivre contact";
a.ACZ_SendContactsAsAttachments="Envoyer les contacts comme des pi\u00e8ces jointes au mail";
a.ACZ_more="(encore {0})";
delete a;
if(!window.com_zimbra_date){
com_zimbra_date={}
}
a=com_zimbra_date;
a.label="Date";
a.description="Highlights dates, previews associated appointments and creates a link to the calendar.";
a.viewDay="Day";
a.appointmentNewTitle="New Appointment";
a.searchForMessages="Search for mail messages";
a.boundaryTrue="true";
a.boundaryFalse="false";
a["format.boundary"]="true";
a["format1.pattern"]="(today|tonight|this morning)";
a["format1.rule"]="now";
a["format2.pattern"]="(tomorrow night|tomorrow morning|tomorrow)";
a["format2.rule"]="now +1 day";
a["format3.pattern"]="(last night|yesterday morning|yesterday)";
a["format3.rule"]="now -1 day";
a["format4.pattern"]="(this|next) {dayname}";
a["format4.rule"]="now +1 {dayname}";
a["format5.pattern"]="last {dayname}";
a["format5.rule"]="now -1 {dayname}";
a["format6.pattern"]="{weekord} {dayname} (of|in) {monthname}";
a["format6.rule"]="now date=1 +1 {monthname} week={weekord},{dayname}";
a["format7.pattern"]="{weekord} {dayname}";
a["format7.rule"]="now week={weekord},{dayname}";
a["format8.pattern"]="{datenum}(st|nd|rd|th)? (of|in) {monthname}";
a["format8.rule"]="now month={monthname},{datenum}";
a["format9.pattern"]="{monthname} {datenum}(st|nd|rd|th)?.? {timenum}.?(am|pm)";
a["format9.rule"]="now month={monthname},{datenum}";
a["format10.pattern"]="{datenum}(st|nd|rd|th)? {monthname} {timenum}.?(am|pm)";
a["format10.rule"]="now month={monthname},{datenum}";
a["format11.pattern"]="{monthname} {datenum}(st|nd|rd|th).? {militarytimenum} (hrs|hours)";
a["format11.rule"]="now month={monthname},{datenum}";
a["format12.pattern"]="{datenum}(st|nd|rd|th).? {monthname}.? {militarytimenum} (hrs|hours)";
a["format12.rule"]="now month={monthname},{datenum}";
a["format13.pattern"]="{monthname} {datenum}(st|nd|rd|th).? {yearnum}";
a["format13.rule"]="now year={yearnum},{monthname},{datenum}";
a["format14.pattern"]="{dayname}.? {datenum} {monthname} {yearnum}";
a["format14.rule"]="now year={yearnum},{monthname},{datenum}";
a["format15.pattern"]="{dayname}.? {monthname}  {datenum}";
a["format15.rule"]="now month={monthname},{datenum}";
a["format16.pattern"]="{monthname} {datenum}(st|nd|rd|th)?";
a["format16.rule"]="now month={monthname},{datenum}";
a["format17.pattern"]="{datenum} {monthname}.? {yearnum}";
a["format17.rule"]="now year={yearnum},{monthname},{datenum}";
a["format18.pattern"]="{monthnum}/{datenum}/{yearnum}";
a["format18.rule"]="now year={yearnum},{monthnum},{datenum}";
a["format19.pattern"]="{yearnum}-{monthnum}-{datenum}";
a["format19.rule"]="now year={yearnum},{monthnum},{datenum}";
a["format20.pattern"]="{monthname} {yearnum}";
a["format20.rule"]="now year={yearnum},{monthname},1";
a["format21.pattern"]="{dayname}";
a["format21.rule"]="now +1 {dayname}";
a["format22.pattern"]="{datenum}(st|nd|rd|th)? {monthname}.? {yearnum}";
a["format22.rule"]="now year={yearnum},{monthname},{datenum}";
a["format23.pattern"]="Thanksgiving";
a["format23.rule"]="now month=November week=fourth,Thursday";
a["format24.pattern"]="Christmas Eve";
a["format24.rule"]="now month=December,24";
a["format25.pattern"]="Christmas";
a["format25.rule"]="now month=December,25";
a["format26.pattern"]="New Year'?s Eve";
a["format26.rule"]="now month=December,31";
a["format27.pattern"]="New Year'?s Day";
a["format27.rule"]="now +1 year month=January,1";
a["format28.pattern"]="###";
delete a;
if(!window.com_zimbra_date){
com_zimbra_date={}
}
a=com_zimbra_date;
a.label="Date";
a.description="Souligne les dates, donne un aper\u00e7u des rendez-vous associ\u00e9s et cr\u00e9e un lien vers le calendrier.";
a.viewDay="Jour";
a.appointmentNewTitle="Nouveau rendez-vous";
a.searchForMessages="Rechercher des mails";
a.boundaryTrue="true";
a.boundaryFalse="false";
a["format.boundary"]="true";
a["format1.pattern"]="(aujourd\u2019hui|ce soir|ce matin|aujourd'?hui)";
a["format1.rule"]="now";
a["format2.pattern"]="(demain soir|demain matin|demain)";
a["format2.rule"]="now +1 day";
a["format3.pattern"]="(hier soir|hier matin|hier)";
a["format3.rule"]="now -1 day";
a["format4.pattern"]="(ce|le prochain) {dayname}";
a["format4.rule"]="now +1 {dayname}";
a["format5.pattern"]="le dernier {dayname}";
a["format5.rule"]="now -1 {dayname}";
a["format6.pattern"]="{weekord} {dayname} (de\u00a0:) {monthname}";
a["format6.rule"]="now date=1 +1 {monthname} week={weekord},{dayname}";
a["format7.pattern"]="{weekord} {dayname}";
a["format7.rule"]="now week={weekord},{dayname}";
a["format8.pattern"]="jour num\u00e9ro {datenum} (de) {monthname}";
a["format8.rule"]="now month={monthname},{datenum}";
a["format9.pattern"]="{monthname} {datenum}(er|e)\u00a0? {timenum}.?";
a["format9.rule"]="now month={monthname},{datenum}";
a["format10.pattern"]="{datenum}(er|e)\u00a0? {monthname} {timenum}.?";
a["format10.rule"]="now month={monthname},{datenum}";
a["format11.pattern"]="{monthname} {datenum}(er|e)\u00a0? {militarytimenum} (h|heures)";
a["format11.rule"]="now month={monthname},{datenum}";
a["format12.pattern"]="{datenum}(er|e)\u00a0? {monthname}.? {militarytimenum} (h|heures)";
a["format12.rule"]="now month={monthname},{datenum}";
a["format13.pattern"]="{monthname} {datenum}(er|e)\u00a0? {yearnum}";
a["format13.rule"]="now year={yearnum},{monthname},{datenum}";
a["format14.pattern"]="{dayname}.? {datenum} {monthname} {yearnum}";
a["format14.rule"]="now year={yearnum},{monthname},{datenum}";
a["format15.pattern"]="{dayname}.? {monthname} {datenum}";
a["format15.rule"]="now month={monthname},{datenum}";
a["format16.pattern"]="{monthname} {datenum}(er|e)\u00a0?";
a["format16.rule"]="now month={monthname},{datenum}";
a["format17.pattern"]="{datenum} {monthname}.? {yearnum}";
a["format17.rule"]="now year={yearnum},{monthname},{datenum}";
a["format18.pattern"]="{datenum}/{monthnum}/{yearnum} ";
a["format18.rule"]="now year={yearnum},{monthnum},{datenum}";
a["format19.pattern"]="{yearnum}-{monthnum}-{datenum}";
a["format19.rule"]="now year={yearnum},{monthnum},{datenum}";
a["format20.pattern"]="{monthname} {yearnum}";
a["format20.rule"]="now year={yearnum},{monthname},1";
a["format21.pattern"]="{dayname}";
a["format21.rule"]="now +1 {dayname}";
a["format22.pattern"]="{datenum}(er|e)\u00a0? {monthname}.? {yearnum} ";
a["format22.rule"]="now year={yearnum},{monthname},{datenum}";
a["format23.pattern"]="Thanksgiving";
a["format23.rule"]="now month=November week=fourth,Thursday";
a["format24.pattern"]="Veille de No\u00ebl";
a["format24.rule"]="now month=December,24";
a["format25.pattern"]="Jour de No\u00ebl";
a["format25.rule"]="now month=December,25";
a["format26.pattern"]="Veille du jour de l\u2019an";
a["format26.rule"]="now month=December,31";
a["format27.pattern"]="Jour de l\u2019an";
a["format27.rule"]="now +1 year month=January,1";
a["format28.pattern"]="{datenum}/{monthnum}/{yearnum}";
a["format28.rule"]="now year={yearnum},{monthnum},{datenum}";
a["format29.pattern"]="{datenum}-{monthnum}-{yearnum}";
a["format29.rule"]="now year={yearnum},{monthnum},{datenum}";
a["format30.pattern"]="###";
delete a;
function com_zimbra_srchhltr_HandlerObject(){}
com_zimbra_srchhltr_HandlerObject.prototype=new ZmZimletBase();
com_zimbra_srchhltr_HandlerObject.prototype.constructor=com_zimbra_srchhltr_HandlerObject;
var SearchHighlighterZimlet=com_zimbra_srchhltr_HandlerObject;
SearchHighlighterZimlet.prototype.init=function(){
this._searchController=appCtxt.getSearchController();
this._spanIds=[]
};
SearchHighlighterZimlet.prototype.match=function(o,h){
this._setRegExps();
if(this._regexps.length==0){
return
}
var t=this._regexps;
var n=null;
for(var s=0;
s<t.length;
++s){
var r=t[s];
r.lastIndex=h;
var e=r.exec(o);
if(e&&e[0]!=""){
if(!n||e.index<n.index){
n=e;
n.matchLength=e[0].length;
return n
}}}
return n
};
SearchHighlighterZimlet.prototype.generateSpan=function(n,e,r,s,o){
var t=appCtxt.getCurrentApp();
if(t&&t.isZmSearchApp){
var h=Dwt.getNextId();
this._spanIds.push(h);
n[e++]=["<span id= '",h,"'class='ZmSearchResult'>",AjxStringUtil.htmlEncode(r),"</span>"].join("")
}else{
n[e++]=AjxStringUtil.htmlEncode(r)
}
return e
};
SearchHighlighterZimlet.prototype._getSearchWords=function(t){
if(!t){
return[]
}
var e=[];
var n=(new ZmParsedQuery(t)).getTokens();
for(var o=0;
o<n.length;
o++){
if(n[o].op===ZmParsedQuery.OP_CONTENT&&(o==0||(n[o-1].op!==ZmParsedQuery.COND_NOT))){
e.push(n[o].arg)
}}
return AjxUtil.uniq(e)
};
SearchHighlighterZimlet.prototype._setRegExps=function(){
this._currentSearchQuery=(this._searchController.currentSearch)?this._searchController.currentSearch.query:null;
if(!this._oldSearchQuery||this._currentSearchQuery!=this._oldSearchQuery){
var r=this._getSearchWords(this._currentSearchQuery);
this._regexps=[];
try{
var s,o,h;
for(var t=0;
t<r.length;
t++){
o=r[t];
h=o[o.length-1]=="*"?true:false;
o=o.replace(/^\W*/,"").replace(/\W*$/,"");
o=AjxStringUtil.regExEscape(o);
if(h){
o=o.concat("\\S*")
}
if(s){
s=s+"|"+o
}else{
s=o
}}
if(s){
s="\\b("+s+")\\b";
this._regexps.push(new RegExp(s,"ig"))
}}
catch(n){
this._regexps=[]
}
this._oldSearchQuery=this._currentSearchQuery
}};
SearchHighlighterZimlet.prototype.onParticipantActionMenuInitialized=function(e,t){
this.onActionMenuInitialized(e,t)
};
SearchHighlighterZimlet.prototype.onActionMenuInitialized=function(e,t){
this.addMenuButton(e,t)
};
SearchHighlighterZimlet.prototype.addMenuButton=function(t,s){
var e="COM_ZIMBRA_SEARCH_WORD_HIGHLIGHTER_ZIMLET";
var n=this.getMessage("SearchHighlighterZimlet_MenuLabel");
if(!s.getMenuItem(e)){
var r={
id:e,text:n,image:"search"};
var o=ZmOperation.defineOperation(null,r);
s.addOp(e,1000);
s.addSelectionListener(e,new AjxListener(this,this._clearSearchWordHighlights,t))
}};
SearchHighlighterZimlet.prototype._clearSearchWordHighlights=function(s){
var h=appCtxt.getAppViewMgr().getCurrentView();
var l;
if(h.getItemView){
l=h.getItemView()
}else{
if(h.getMsgView){
l=h.getMsgView()
}}
if(!l){
return
}
var e=l.getDocument();
if(!e){
var t=l.getHTMLElId();
if(t){
var d=document.getElementById(t+"_body__iframe");
if(!AjxEnv.isIE){
if(d){
e=d.contentDocument
}}else{
if(d){
e=d.contentWindow.document
}}}}
for(var n=0;
n<this._spanIds.length;
n++){
var o=document.getElementById(this._spanIds[n]);
var r;
if(e!=undefined||e!=null){
r=e.getElementById(this._spanIds[n])
}
if((o!=undefined)&&(o.className!=undefined)){
o.className=""
}
if((r!=undefined)&&(r.className!=undefined)){
r.className=""
}}
this._spanIds=[]
};
AjxTemplate.register("com_zimbra_email.templates.Email1#Frame",function(t,r,s,e){
var n=Boolean(e);
s=(typeof s=="string"?{
id:s}
:s)||{};
e=e||[];
var o=e.length;
e[o++]="<div id='UnknownPersonSlide_Frame' style='background:white;display:block;height:100%;overflow:auto;padding:10px;'><table width='100%'><tr><td valign='top' width='65'><div id=\"";
e[o++]=s.photoParentId;
e[o++]='"></div></td><td><div id="';
e[o++]=s.textDivId;
e[o++]="\" style='margin-left:10px;'></div></td></tr></table></div>";
return n?e.length:e.join("")
}
,{
id:"Frame"}
,true);
AjxPackage.define("com_zimbra_email.templates.Email1");
AjxTemplate.register("com_zimbra_email.templates.Email1",AjxTemplate.getTemplate("com_zimbra_email.templates.Email1#Frame"),AjxTemplate.getParams("com_zimbra_email.templates.Email1#Frame"));
AjxTemplate.register("com_zimbra_email.templates.Email1#ContactDetails",function(e,t,h,s){
var o=Boolean(s);
h=(typeof h=="string"?{
id:h}
:h)||{};
s=s||[];
var n=s.length;
if(h.fullName){
s[n++]="<div><label id='UnknownPersonSlide_NameAnchorId' class='FakeAnchor' style='font-size:15px;font-weight:bold;'>";
s[n++]=AjxStringUtil.htmlEncode(h.fullName);
s[n++]="</label></div>"
}
s[n++]="<table style='margin-bottom:.5em;'><tr id='row_Presence'><td><div id='img_Presence'></div></td><td><label id='text_Presence'></label></td></tr></table>";
var d=this.com_zimbra_email.jobTitleDepartmentCompany.split(",");
var l=d.length;
var r;
for(r=0;
r<l;
r++){
s[n++]="<div><label>";
s[n++]=AjxStringUtil.htmlEncode(h[d[r]]);
s[n++]="</label></div>"
}
if(h.email){
s[n++]="<div><label  id='UnknownPersonSlide_EmailAnchorId' class='FakeAnchor'>";
s[n++]=AjxStringUtil.htmlEncode(h.email);
s[n++]="</label></div>"
}
if(h.mobilePhone){
s[n++]="<div><label id='UnknownPersonSlide_mobilePhoneAnchorId' class='FakeAnchor'>";
s[n++]=AjxStringUtil.htmlEncode(h.mobilePhone);
s[n++]=" (";
s[n++]=ZmMsg.cell;
s[n++]=")</label></div>"
}
if(h.workPhone){
s[n++]="<div><label id='UnknownPersonSlide_workPhoneAnchorId' class='FakeAnchor'>";
s[n++]=AjxStringUtil.htmlEncode(h.workPhone);
s[n++]=" (";
s[n++]=ZmMsg.work;
s[n++]=")</label></div>"
}
if(h.homePhone){
s[n++]="<div><label id='UnknownPersonSlide_workPhoneAnchorId' class='FakeAnchor'>";
s[n++]=AjxStringUtil.htmlEncode(h.homePhone);
s[n++]=" (";
s[n++]=ZmMsg.home;
s[n++]=")</label></div>"
}
if(h.address){
s[n++]="<div><label>";
s[n++]=AjxStringUtil.htmlEncode(h.address);
s[n++]=" (";
s[n++]=ZmMsg.work;
s[n++]=")</label></div>"
}
return o?s.length:s.join("")
}
,{
id:"ContactDetails"}
,true);
function com_zimbra_email_handlerObject(){
this.isPrimaryEmailTooltip=true
}
com_zimbra_email_handlerObject.prototype=new ZmZimletBase();
com_zimbra_email_handlerObject.prototype.constructor=com_zimbra_email_handlerObject;
var EmailTooltipZimlet=com_zimbra_email_handlerObject;
EmailTooltipZimlet.NEW_FILTER="__new__";
EmailTooltipZimlet.MAILTO_RE=/^mailto:[\x27\x22]?([^@?&\x22\x27]+@[^@?&]+\.[^@?&\x22\x27]+)[\x27\x22]?/;
EmailTooltipZimlet.tooltipWidth=280;
EmailTooltipZimlet.prototype.init=function(){
if(appCtxt.get(ZmSetting.CONTACTS_ENABLED)){
AjxDispatcher.require(["ContactsCore","Contacts"])
}
this._prefDialog=new EmailToolTipPrefDialog(this);
this._subscriberZimlets=[];
this._presenceProvider=null;
this._preLoadImgs();
this._presenceCache=[]
};
EmailTooltipZimlet.prototype.doubleClicked=function(){
this.singleClicked()
};
EmailTooltipZimlet.prototype.singleClicked=function(){
this._prefDialog.popup()
};
EmailTooltipZimlet.prototype._getHtmlContent=function(n,h,o,e,t,d){
if(o instanceof AjxEmailAddress){
var e=window.parentAppCtxt||window.appCtxt;
var r=e.getApp(ZmApp.CONTACTS);
var s=r&&r.getContactByEmail(o.address);
if(r&&!s&&s!==null){
var l=new AjxCallback(this,this._handleResponseGetContact,[n,h,o,t,d]);
r.getContactByEmail(o.address,l)
}
return this._updateHtmlContent(n,h,o,s,t,d)
}else{
n[h++]=AjxStringUtil.htmlEncode(o);
return h
}};
EmailTooltipZimlet.prototype._updateHtmlContent=function(n,t,l,e,r,o){
var h=AjxStringUtil.htmlEncode(l.toString(o&&o.shortAddress));
var s=r&&document.getElementById(r);
if(s){
s.innerHTML=h
}else{
n[t++]=h;
return t
}};
EmailTooltipZimlet.prototype._handleResponseGetContact=function(n,t,r,s,o,e){
if(e){
this._updateHtmlContent(n,t,r,e,s,o)
}};
EmailTooltipZimlet.prototype.hoverOut=function(e,t,n,o){
if(!this.tooltip){
return
}
this._hoverOver=false;
this.tooltip.setSticky(true);
setTimeout(AjxCallback.simpleClosure(this.popDownIfMouseNotOnSlide,this),700)
};
EmailTooltipZimlet.prototype.popDownIfMouseNotOnSlide=function(){
if(this._hoverOver){
return
}else{
if(this.slideShow&&this.slideShow.isMouseOverTooltip){
return
}else{
if(this.tooltip){
this.tooltip.setSticky(false);
this.tooltip.popdown()
}}}};
EmailTooltipZimlet.prototype.popdown=function(){
this._hoverOver=false;
if(this.tooltip){
this.tooltip.setSticky(false);
this.tooltip.popdown()
}};
EmailTooltipZimlet.prototype.addSubscriberZimlet=function(e,o,t){
this._subscriberZimlets.push(e);
if(o){
this.primarySubscriberZimlet=e
}
if(t&&t.presenceCallback&&!this._presenceProvider){
this._presenceProvider=t.presenceCallback
}};
EmailTooltipZimlet.prototype.onEmailHover=function(t,n,e,h,s){
var o=DwtShell.getShell(window);
var r=o.getToolTip();
r.setContent('<div id="zimletTooltipDiv"/>',true);
this.x=e;
this.y=h;
if(!this.toolTipPoppedUp(s,t,n,document.getElementById("zimletTooltipDiv"))){
r.popup(e,h,true,new AjxCallback(this,this.hoverOut,t,n,s))
}
return true
};
EmailTooltipZimlet.prototype.toolTipPoppedUp=function(o,n,t,e){
var r=appCtxt.getToolTipMgr().getToolTip(ZmToolTipMgr.PERSON,{
address:n}
);
if(r){
var s=document.getElementById("zimletTooltipDiv");
if(s){
s.innerHTML=r
}
return false
}
return true
};
EmailTooltipZimlet.prototype.onHoverOverEmailInList=function(t,r,s){
if(!t||!t.address){
return false
}
var e=r?r.docX:this.x;
var h=r?r.docY:this.y;
this.noRightClick=s;
var n=DwtShell.getShell(window);
var o=n.getHoverMgr();
o.setHoverOutDelay(500);
return this.handleHover(t,null,e,h)
};
EmailTooltipZimlet.prototype.handleHover=function(t,o,e,r,s,n){
this._hoverOver=true;
this._initializeProps(t,o,e,r,s);
appCtxt.notifyZimlets("onEmailHoverOver",[this],{
waitUntilLoaded:true}
);
if(this.primarySubscriberZimlet){
this.primarySubscriberZimlet.showTooltip();
return true
}
this._unknownPersonSlide=new UnknownPersonSlide();
this._unknownPersonSlide.onEmailHoverOver(this);
this._unknownPersonSlide.showTooltip();
return true
};
EmailTooltipZimlet.prototype._initializeProps=function(t,n,e,l,s){
if(!this.seriesAnimation){
this.seriesAnimation=new SeriesAnimation()
}
this.seriesAnimation.reset();
var o=DwtShell.getShell(window);
var r=o.getToolTip();
r.setContent('<div id="zimletTooltipDiv"></div>',true);
this.x=e;
this.y=l;
this.tooltip=r;
r.setListener((AjxEnv.isIE8?DwtEvent.ONMOUSELEAVE:DwtEvent.ONMOUSEOUT),new AjxListener(this,this.hoverOut));
var h=(t.isAjxEmailAddress)?t.address:t;
h=AjxStringUtil.parseMailtoLink(h).to;
this.emailAddress=h;
this.fullName=(t instanceof AjxEmailAddress)?t.name:"";
this.canvas=document.getElementById("zimletTooltipDiv");
this.slideShow=new EmailToolTipSlideShow(this,this.canvas);
this.contextMenu=this.getActionMenu(t,s,n,false)
};
EmailTooltipZimlet.prototype._preLoadImgs=function(){
this._busyImg=new Image();
this._busyImg.src=this.getResource("img/EmailZimlet_busy.gif");
this._unknownPersonImg=new Image();
this._unknownPersonImg.src=this.getResource("img/UnknownPerson_dataNotFound.jpg")
};
EmailTooltipZimlet.prototype.showBusyImg=function(e,t,s){
var n=s?this.y+s:this.y;
var o=t?this.x+t:this.x;
this._busyImg.style.top=n;
this._busyImg.style.left=o;
this._busyImg.style.display="block";
this._busyImg.style.position="absolute";
this._busyImg.style.zIndex="500";
this._busyImgTimer=setTimeout(AjxCallback.simpleClosure(this._handleNoImg,this,e),4000)
};
EmailTooltipZimlet.prototype.showLoadingAtId=function(e,o){
var t=document.getElementById(o);
t.innerHTML=["<br/><br/><label style='color:gray'>",ZmMsg.loading,"</label>"].join("");
this._busyImgTimer=setTimeout(AjxCallback.simpleClosure(this._handleNoImgAtId,this,e,o),4000)
};
EmailTooltipZimlet.prototype._handleNoImgAtId=function(e,t){
clearTimeout(this._busyImgTimer);
if(e){
e.run()
}};
EmailTooltipZimlet.prototype._handleNoImg=function(e){
clearTimeout(this._busyImgTimer);
this._busyImg.style.zIndex="100";
this._busyImg.style.display="none";
if(e){
e.run()
}};
EmailTooltipZimlet.prototype.hideBusyImg=function(){
clearTimeout(this._busyImgTimer);
this._busyImg.style.zIndex="100";
this._busyImg.style.display="none"
};
EmailTooltipZimlet.prototype._getAddress=function(e){
return e.isAjxEmailAddress?e.address:e
};
EmailTooltipZimlet.prototype._phoneListener=function(e){
if(!e){
return
}
appCtxt.notifyZimlets("onPhoneClicked",[e],{
waitUntilLoaded:true}
)
};
EmailTooltipZimlet.prototype._imListener=function(e){
if(!e){
return
}};
EmailTooltipZimlet.prototype.animateOpacity=function(h,s,e,t){
this.changeOpac(s,document.getElementById(h).style);
var o=Math.round(t/100);
var r=0;
var n=document.getElementById(h).style;
if(s>e){
for(i=s;
i>=e;
i--){
setTimeout(AjxCallback.simpleClosure(this.changeOpac,this,i,n),(r*o));
r++
}}else{
if(s<e){
for(i=s;
i<=e;
i++){
setTimeout(AjxCallback.simpleClosure(this.changeOpac,this,i,n),(r*o));
r++
}}}};
EmailTooltipZimlet.prototype.changeOpac=function(e,t){
t.opacity=(e/100);
t.MozOpacity=(e/100);
t.KhtmlOpacity=(e/100);
t.zoom=1
};
EmailTooltipZimlet.prototype.openCenteredWindow=function(o){
this.popdown();
var n=800;
var e=600;
var h=parseInt((screen.availWidth/2)-(n/2));
var r=parseInt((screen.availHeight/2)-(e/2));
var t="width="+n+",height="+e+",status,resizable,left="+h+",top="+r+"screenX="+h+",screenY="+r;
var s=window.open(o,"subWind",t);
if(!s){
this._showWarningMsg(ZmMsg.popupBlocker)
}};
EmailToolTipSlideShow.mainDivId="EmailZimlet_slidesMainDiv";
EmailToolTipSlideShow.navDivId="EmailZimlet_slidesNavDiv";
EmailToolTipSlideShow.navTableRowId="EmailZimlet_slidesNavTableRow";
function EmailToolTipSlideShow(e,t){
this.slidesIconAndSlideMap=[];
this.numberOfSlides=0;
this.emailZimlet=e;
this.canvas=t;
this._createFrame(t);
this.mainDiv=document.getElementById(EmailToolTipSlideShow.mainDivId);
this.navDiv=document.getElementById(EmailToolTipSlideShow.navDivId);
this.navTableRow=document.getElementById(EmailToolTipSlideShow.navTableRowId);
this.currentSelectCellId=null;
this.currentSlideId=null;
this.navDiv.onclick=AjxCallback.simpleClosure(this._handleClick,this);
t.onmouseover=AjxCallback.simpleClosure(this.handleMouseOver,this);
t.onmouseout=AjxCallback.simpleClosure(this.handleMouseOut,this);
this.mainDiv.style.width=EmailTooltipZimlet.tooltipWidth+"px";
this.navDiv.style.width=EmailTooltipZimlet.tooltipWidth+"px"
}
EmailToolTipSlideShow.prototype._createFrame=function(e){
e.innerHTML=["<div id='",EmailToolTipSlideShow.mainDivId,"'></div>","<div id='",EmailToolTipSlideShow.navDivId,"'>","<div class='horizsep'></div>","<table width=100%><tr id='",EmailToolTipSlideShow.navTableRowId,"'>","</tr></table></div>"].join("")
};
EmailToolTipSlideShow.prototype._handleClick=function(o){
if(!o){
var o=window.event
}
var t;
if(o.target){
t=o.target
}else{
if(o.srcElement){
t=o.srcElement
}}
if(t.nodeType==3){
t=t.parentNode
}
if(t.id){
if(this.slidesIconAndSlideMap[t.id]){
this.slidesIconAndSlideMap[t.id].select()
}}};
EmailToolTipSlideShow.prototype.addSlide=function(e,t){
e.slideShow=this;
if(!t){
t=this.numberOfSlides
}
this.slidesIconAndSlideMap[e.iconDivId]=e;
var o=document.createElement("div");
o.id=e.id;
o.style.display="none";
this.mainDiv.appendChild(o);
o.innerHTML=e.html;
this._insertSlideIcon(e);
this.numberOfSlides++
};
EmailToolTipSlideShow.prototype._insertSlideIcon=function(e){
var r=e.iconName;
var n=e.iconDivId;
var t=e.selectCellId;
var o=e.name;
var s=this.navTableRow.insertCell(0);
this._insertIconHtml(s,t,o,n,r)
};
EmailToolTipSlideShow.prototype._insertIconHtml=function(n,e,t,o,s){
n.align="center";
n.id=e;
n.innerHTML=["<div title='",t,"' id='",o,"' class='Img",s,"' style='cursor:pointer;'></div>"].join("")
};
EmailToolTipSlideShow.prototype.handleMouseOver=function(){
this.isMouseOverTooltip=true
};
EmailToolTipSlideShow.prototype.handleMouseOut=function(){
this.isMouseOverTooltip=false;
this.emailZimlet.hoverOut()
};
function EmailToolTipSlide(o,n,s,e,t){
this.html=o;
this.visible=n;
this.iconName=s;
this.id=Dwt.getNextId();
this.iconDivId=Dwt.getNextId();
this.selectCellId=Dwt.getNextId();
this.slideShow=null;
this.canvasElement=null;
this._selectCallback=e;
this.name=t
}
EmailToolTipSlide.prototype.select=function(){
if(this.slideShow.currentSlideId){
document.getElementById(this.slideShow.currentSlideId).style.display="none"
}
document.getElementById(this.id).style.display="block";
this.slideShow.currentSlideId=this.id;
if(this.slideShow.currentSelectCellId){
document.getElementById(this.slideShow.currentSelectCellId).style.background=""
}
document.getElementById(this.selectCellId).style.display="none";
this.slideShow.currentSelectCellId=this.selectCellId;
if(this._selectCallback){
this._selectCallback.run()
}};
EmailToolTipSlide.prototype.setCanvasElement=function(e){
this.canvasElement=e
};
EmailToolTipSlide.prototype.setInfoMessage=function(e){
this._appendMsg2Slide(e,"EmailToolTipSlideMsgColor")
};
EmailToolTipSlide.prototype.setErrorMessage=function(e){
this._appendMsg2Slide(e,"EmailToolTipSlideErrorColor")
};
EmailToolTipSlide.prototype._appendMsg2Slide=function(o,e){
var t=["<div class='EmailToolTipSlideText ",e,"'>",o,"</div>"].join("");
if(this.canvasElement){
this.canvasElement.innerHTML=t
}};
EmailToolTipSlide.prototype.clearSlideMessage=function(t,e){
if(this.canvasElement){
this.canvasElement.innerHTML=""
}};
function EmailToolTipPrefDialog(e){
this.zimlet=e;
this.emailZimlet_tooltipArea=this.zimlet.getUserProperty("emailZimlet_tooltipArea");
if(!this.emailZimlet_tooltipArea){
this.emailZimlet_tooltipArea=EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_MEDIUM]
}
this.updateEmailTooltipSize()
}
EmailToolTipPrefDialog.SIZE_VERYSMALL="VERYSMALL";
EmailToolTipPrefDialog.SIZE_SMALL="SMALL";
EmailToolTipPrefDialog.SIZE_MEDIUM="MEDIUM";
EmailToolTipPrefDialog.SIZE_LARGE="LARGE";
EmailToolTipPrefDialog.SIZE_XL="XL";
EmailToolTipPrefDialog.DIMENSIONS=[];
EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_VERYSMALL]="220px x 130px";
EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_SMALL]="230px x 140px";
EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_MEDIUM]="280px x 150px";
EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_LARGE]="260px x 200px";
EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_XL]="270px x 210px";
EmailToolTipPrefDialog.prototype.updateEmailTooltipSize=function(){
var e=this.emailZimlet_tooltipArea.replace(/px/ig,"");
var t=e.split(" x ");
EmailTooltipZimlet.tooltipWidth=t[0];
EmailTooltipZimlet.tooltipHeight=t[1]
};
function SeriesAnimation(){
this._objsToAnimate=[];
this._objIdAndAnimationTypeMap=[]
}
SeriesAnimation.prototype.startAnimation=function(){
this._animateNextItem()
};
SeriesAnimation.prototype.reset=function(){
this._objsToAnimate=[];
this._objIdAndAnimationTypeMap=[]
};
SeriesAnimation.prototype.addFadeIn=function(e,t){
this._addObjs({
objId:e,aType:"FADEIN",endingOpac:t,millisecs:null}
)
};
SeriesAnimation.prototype.addPause=function(e){
this._addObjs({
objId:"__PAUSE__",aType:"PAUSE",endingOpac:null,millisecs:e}
)
};
SeriesAnimation.prototype.addFadeOut=function(e,t){
this._addObjs({
objId:e,aType:"FADEOUT",endingOpac:t,millisecs:null}
)
};
SeriesAnimation.prototype.addslideUp=function(t,e){
this._addObjs({
objId:t,aType:"SLIDEUP",endHeightPercent:e}
)
};
SeriesAnimation.prototype.addslideDown=function(t,e){
this._addObjs({
objId:t,aType:"SLIDEDOWN",endHeightPercent:e}
)
};
SeriesAnimation.prototype.addZoomIn=function(o,e,n,t){
this._addObjs({
objId:o,aType:"ZOOMIN",objWidth:e,objHeight:n,zoomByThisPixels:t}
)
};
SeriesAnimation.prototype._addObjs=function(n){
var o=n.objId;
var e=n.aType;
var t=o+Dwt.getNextId();
this._objIdAndAnimationTypeMap[t]=n;
this._objsToAnimate.push(t)
};
SeriesAnimation.prototype._animate=function(s){
var n=s.objId;
var t=s.aType;
if(n.indexOf("__PAUSE__")==-1&&!document.getElementById(n)){
this.reset();
return
}
if(n.indexOf("__PAUSE__")==-1){
document.getElementById(n).style.display="block"
}
if(t=="FADEOUT"){
var r=s.endingOpac?s.endingOpac:0;
this._animateOpacity(n,100,r,500)
}else{
if(t=="PAUSE"){
this._animatePause(s.millisecs)
}else{
if(t=="FADEIN"){
var r=s.endingOpac?s.endingOpac:100;
this._animateOpacity(n,0,r,500)
}else{
if(t=="SLIDEUP"){
var o=s.endHeightPercent?s.endHeightPercent:100;
this._animateSliding(n,o,t,500)
}else{
if(t=="SLIDEDOWN"){
var o=s.endHeightPercent?s.endHeightPercent:0;
this._animateSliding(n,o,t,500)
}else{
if(t=="ZOOMIN"){
var e=s.zoomByThisPixels?s.zoomByThisPixels:0;
this._animateZoomIn(s)
}}}}}}};
SeriesAnimation.prototype._animateZoomIn=function(h){
var n=document.getElementById(h.objId);
var r=n.style;
var o=h.objWidth;
var e=h.objHeight;
var t=h.zoomByThisPixels;
var s=2;
var l=0;
for(i=0;
i<t;
i++){
if(i==t-1){
setTimeout(AjxCallback.simpleClosure(this._zoomInItem,this,r,(o+i),(e+i),true),(l*s))
}else{
setTimeout(AjxCallback.simpleClosure(this._zoomInItem,this,r,(o+i),(e+i),false),(l*s))
}
l++
}};
SeriesAnimation.prototype._zoomInItem=function(n,o,e,t){
n.width=o;
n.height=e;
if(t){
this._animateNextItem()
}};
SeriesAnimation.prototype._animateSliding=function(o,t,e,n){
var s=Math.round(n/100);
var l=0;
var r=document.getElementById(o).style;
var h=Math.round(document.getElementById(o).offsetHeight);
if(e=="SLIDEUP"){
for(i=h;
i<=t;
i++){
if(i==t){
setTimeout(AjxCallback.simpleClosure(this._changeHeight,this,i,r,true),(l*s))
}else{
setTimeout(AjxCallback.simpleClosure(this._changeHeight,this,i,r,false),(l*s))
}
l++
}}else{
if(e=="SLIDEDOWN"){
for(i=h;
i>=t;
i--){
if(i==t){
setTimeout(AjxCallback.simpleClosure(this._changeHeight,this,i,r,true),(l*s))
}else{
setTimeout(AjxCallback.simpleClosure(this._changeHeight,this,i,r,false),(l*s))
}
l++
}}}};
SeriesAnimation.prototype._animateOpacity=function(l,s,e,t){
var h=document.getElementById(l);
if(!h){
this.reset();
return
}
this._changeOpac(s,h.style);
var o=Math.round(t/100);
var r=0;
var n=h.style;
if(s>e){
for(i=s;
i>=e;
i--){
if(i==e){
setTimeout(AjxCallback.simpleClosure(this._changeOpac,this,i,n,true),(r*o))
}else{
setTimeout(AjxCallback.simpleClosure(this._changeOpac,this,i,n,false),(r*o))
}
r++
}}else{
if(s<e){
for(i=s;
i<=e;
i++){
if(i==e){
setTimeout(AjxCallback.simpleClosure(this._changeOpac,this,i,n,true),(r*o))
}else{
setTimeout(AjxCallback.simpleClosure(this._changeOpac,this,i,n,false),(r*o))
}
r++
}}}};
SeriesAnimation.prototype._changeHeight=function(e,o,t){
o.height=e;
if(t){
this._animateNextItem()
}};
SeriesAnimation.prototype._changeOpac=function(t,o,e){
if(!o){
return
}
o.opacity=(t/100);
o.MozOpacity=(t/100);
o.KhtmlOpacity=(t/100);
o.zoom=1;
o.filter="progid:DXImageTransform.Microsoft.Alpha(opacity="+t+")";
if(e){
this._animateNextItem()
}};
SeriesAnimation.prototype._animateNextItem=function(){
if(this._objsToAnimate.length==0){
return
}
var e=this._objsToAnimate[0];
var t=this._objIdAndAnimationTypeMap[e];
this._objsToAnimate.splice(0,1);
this._animate(t)
};
SeriesAnimation.prototype._animatePause=function(e){
setTimeout(AjxCallback.simpleClosure(this._animateNextItem,this),e)
};
function UnknownPersonSlide(){}
UnknownPersonSlide.PHOTO_ID="unkownPerson_photoBG";
UnknownPersonSlide.PHOTO_PARENT_ID="unkownPerson_photoBGDiv";
UnknownPersonSlide.TEXT_DIV_ID="unkownPerson_TextDiv";
UnknownPersonSlide.DOMAIN="";
UnknownPersonSlide.WIDTH=65;
UnknownPersonSlide.HEIGHT=80;
UnknownPersonSlide.prototype.onEmailHoverOver=function(e){
e.addSubscriberZimlet(this,false);
this.emailZimlet=e;
this._alwaysSetTooltipToSmall();
this._presenceCache=this.emailZimlet._presenceCache
};
UnknownPersonSlide.prototype._alwaysSetTooltipToSmall=function(){
var t=EmailToolTipPrefDialog.DIMENSIONS[EmailToolTipPrefDialog.SIZE_VERYSMALL];
var e=t.replace(/px/ig,"");
var o=e.split(" x ");
this._tooltipWidth=o[0];
this._tooltipHeight=o[1]
};
UnknownPersonSlide.prototype.showTooltip=function(){
if(appCtxt.get(ZmSetting.CALENDAR_ENABLED)){
this._setCalendarFrame()
}
if(appCtxt.get(ZmSetting.MAIL_ENABLED)){
this._setMailFrame()
}
this._setContactFrame();
this.emailZimlet.tooltip.popup(this.emailZimlet.x,this.emailZimlet.y,true,null);
this._slide.select()
};
UnknownPersonSlide.prototype._setContactFrame=function(){
this.emailZimlet.hideBusyImg();
var t=this._getTooltipBGHtml();
var e=new AjxCallback(this,this._handleContactSlideSelect);
this._slide=new EmailToolTipSlide(t,true,"UnknownPerson_contact",e,this.emailZimlet.getMessage("slideTooltip"));
this.emailZimlet.slideShow.addSlide(this._slide);
this._mainDiv=document.getElementById(UnknownPersonSlide.TEXT_DIV_ID);
this._slide.setCanvasElement(this._mainDiv)
};
UnknownPersonSlide.prototype._setMailFrame=function(){
var t=new AjxCallback(this,this._handleMailSlideSelect);
var e=new EmailToolTipSlide(null,true,"Mail_icon",t,this.emailZimlet.getMessage("slideMailTooltip"));
this.emailZimlet.slideShow.addSlide(e)
};
UnknownPersonSlide.prototype._setCalendarFrame=function(){
var t=new AjxCallback(this,this._handleCalendarSlideSelect);
var e=new EmailToolTipSlide(null,true,"Calendar_icon",t,this.emailZimlet.getMessage("slideCalendarTooltip"));
this.emailZimlet.slideShow.addSlide(e)
};
UnknownPersonSlide.prototype._setChatFrame=function(){
var t=this._handleChatSlideSelect.bind(this);
var e=new EmailToolTipSlide(null,true,"Conversation_icon",t,this.emailZimlet.getMessage("slideChatTooltip"));
this.emailZimlet.slideShow.addSlide(e)
};
UnknownPersonSlide.prototype._setPresence=function(){};
UnknownPersonSlide.prototype._handleImgLoadFailure=function(){
var e=new Image();
e.onload=AjxCallback.simpleClosure(this._handleImageLoad,this,e);
e.id=UnknownPersonSlide.PHOTO_ID;
e.src=this.emailZimlet.getResource("img/UnknownPerson_dataNotFound.jpg")
};
UnknownPersonSlide.prototype._handleImageLoad=function(e){
this.emailZimlet.hideBusyImg();
var t=document.getElementById(UnknownPersonSlide.PHOTO_PARENT_ID);
if(!t){
return
}
t.innerHTML="";
t.style.textAlign="center";
t.appendChild(e);
if(this.emailZimlet.emailAddress.indexOf(UnknownPersonSlide.DOMAIN)!=-1){
e.onclick=AjxCallback.simpleClosure(this._handleProfileImageClick,this);
e.style.cursor="pointer"
}};
UnknownPersonSlide.prototype._handleProfileImageClick=function(){};
UnknownPersonSlide.prototype._handleAllClicks=function(o){
var n;
this.emailZimlet.popdown();
o=DwtUiEvent.getEvent(o);
if(o.which){
n=(o.which==3)
}else{
if(o.button){
n=(o.button==2)
}}
if(n){
return
}
var t=DwtShell.mouseEvent;
t.setFromDhtmlEvent(o);
var e=t.target;
if(e.id=="UnknownPersonSlide_EmailAnchorId"){
this._composeListener(null,this.emailZimlet.emailAddress)
}else{
if(e.id=="UnknownPersonSlide_NameAnchorId"){
this._contactListener(true)
}else{
if(e.id=="UnknownPersonSlide_mobilePhoneAnchorId"&&appCtxt.getSettings()._hasVoiceFeature()){
this.emailZimlet._phoneListener(this.attribs&&this.attribs.mobilePhone)
}else{
if(e.id=="UnknownPersonSlide_workPhoneAnchorId"&&appCtxt.getSettings()._hasVoiceFeature()){
this.emailZimlet._phoneListener(this.attribs&&this.attribs.workPhone)
}else{
if(e.id=="UnknownPersonSlide_imAnchorId"&&appCtxt.getSettings()._hasVoiceFeature()){
ZmZimbraMail.unloadHackCallback();
location.href=this.imURI;
this.emailZimlet._imListener(this.imURI);
return false
}}}}}};
UnknownPersonSlide.prototype._handleRightClick=function(t){
var e;
if(!t){
var t=window.event
}
if(t.which){
e=(t.which==3)
}else{
if(t.button){
e=(t.button==2)
}}
if(!e){
return
}
this.emailZimlet.popdown();
DwtUiEvent.setBehaviour(t,true,false);
this.emailZimlet.contextMenu.popup(100,this.emailZimlet.x,this.emailZimlet.y)
};
UnknownPersonSlide.prototype._handleContactSlideSelect=function(){
if(this._slide.loaded){
return
}
this._slide.loaded=true;
this._getContactDetailsAndShowTooltip()
};
UnknownPersonSlide.prototype._handleMailSlideSelect=function(){
this.emailZimlet.popdown();
this._composeListener(null,this.emailZimlet.emailAddress)
};
UnknownPersonSlide.prototype._handleCalendarSlideSelect=function(){
this.emailZimlet.popdown();
var e=new ZmAppt();
var t=this._getActionedContact()||new AjxEmailAddress(this.emailZimlet.emailAddress);
e.setAttendees(t,ZmCalBaseItem.PERSON);
AjxDispatcher.run("GetCalController").newAppointment(e,null,null,null)
};
UnknownPersonSlide.prototype._handleChatSlideSelect=function(){
this.emailZimlet.popdown();
appCtxt.getAppController().getApp(ZmApp.CHAT).startChat(this.xmppURI)
};
UnknownPersonSlide.prototype._getContactDetailsAndShowTooltip=function(){
this._slide.setInfoMessage(this.emailZimlet.getMessage("loading"));
var e=AjxDispatcher.run("GetContacts");
var t=e?e.getContactByEmail(this.emailZimlet.emailAddress):null;
if(!appCtxt.get(ZmSetting.GAL_ENABLED)){
this._handleContactDetails(t)
}else{
var r,n,o;
r={
SearchGalRequest:{
_jsns:"urn:zimbraAccount"}};
n=r.SearchGalRequest;
n.type="account";
n.name=this.emailZimlet.emailAddress;
n.offset=0;
n.limit=3;
var s=new AjxCallback(this,this._handleContactDetails,t);
appCtxt.getAppController().sendRequest({
jsonObj:r,asyncMode:true,callback:s,noBusyOverlay:true}
)
}};
UnknownPersonSlide.prototype._handleContactDetails=function(e,t){
var o={};
var d=null;
if(t){
var s=t.getResponse();
var n=s.SearchGalResponse;
var l=n.cn;
if(l&&l[0]){
d=l[0].id;
o=AjxUtil.hashCopy(l[0]._attrs,["objectClass"])
}}
if(e&&e.attr){
AjxUtil.hashUpdate(o,e.attr,true)
}
o.fullName=this.emailZimlet.fullName||o.fullName||e&&e._fileAs;
this._presentity=o.email=this.emailZimlet.emailAddress||o.email;
var h=e&&e.getImageUrl(UnknownPersonSlide.WIDTH,UnknownPersonSlide.HEIGHT);
this._setProfileImage(h);
this._setContactDetails(o);
this._popupToolTip();
this._setPresenceUI()
};
UnknownPersonSlide.prototype._getPresence=function(){
var e=new Date();
var t=this._presenceCache[this._presentity]&&this._presenceCache[this._presentity].timestamp||0;
if(e-t<5000){
return this._presenceCache[this._presentity]
}
if(this.emailZimlet._presenceProvider){
this.emailZimlet._presenceProvider(this._presentity,this._handlePresence.bind(this))
}
return null
};
UnknownPersonSlide.prototype._handlePresence=function(t){
if(!t){
return
}
var e=this._presenceCache[this._presentity];
if(!e){
e=this._presenceCache[this._presentity]={}
}
e.presenceStatus=t.presenceStatus;
e.notes=t.notes;
e.timestamp=new Date();
this._setPresenceUI()
};
UnknownPersonSlide.prototype._popupToolTip=function(){
this.emailZimlet.tooltip.popup(this.emailZimlet.x,this.emailZimlet.y,true,null)
};
UnknownPersonSlide.prototype._getTooltipBGHtml=function(e){
var o=";";
var n=";";
if(AjxEnv.isIE8){
var o="width:100%;";
var n="left:3%;"
}
var t={
photoParentId:UnknownPersonSlide.PHOTO_PARENT_ID,textDivId:UnknownPersonSlide.TEXT_DIV_ID,width:o,left:n};
return AjxTemplate.expand("com_zimbra_email.templates.Email1#Frame",t)
};
UnknownPersonSlide.prototype._setContactDetails=function(m){
if(m.workState||m.workCity||m.workStreet||m.workPostalCode){
var h=m.workState||"";
var s=m.workCity||"";
var v=m.workStreet||"";
var y=m.workPostalCode||"";
var b=this.emailZimlet.getMessage("postalAddress");
var p=new AjxMessageFormat(b);
var o=[v,s,h,y];
var n=AjxStringUtil.trim(p.format(o),true);
m.address=AjxStringUtil.trim(n)
}
var l=m.imAddress||m.imAddress1||m.imAddress2||m.imAddress3;
if(l){
var e=l.split(":");
if(e.length==2){
var w=e[0];
l=l.split(":")[1];
if(w&&w=="xmpp"){
if(appCtxt.get(ZmSetting.CHAT_FEATURE_ENABLED)&&appCtxt.get(ZmSetting.CHAT_ENABLED)){
var f=appCtxt.getAppController().getApp(ZmApp.CHAT);
if(f&&f.getRosterContact(l.substring(2))){
this.xmppURI=m.xmppURI=AjxStringUtil.htmlEncode(l.substring(2));
this._setChatFrame()
}}}else{
if(w&&w=="other"){
w="im"
}else{
if(w&&w=="aol"){
w="aim"
}}
l="<a  id='UnknownPersonSlide_imAnchorId' href='"+w+":"+AjxStringUtil.htmlEncode(l.substring(2))+"'>"+AjxStringUtil.htmlEncode(l.substring(2))+"</a>";
this.imURI=m.imURI=l
}}}else{
if(appCtxt.get(ZmSetting.CHAT_FEATURE_ENABLED)&&appCtxt.get(ZmSetting.CHAT_ENABLED)){
var f=appCtxt.getAppController().getApp(ZmApp.CHAT);
if(f){
for(var g=0;
g<4;
g++){
var r="email"+((g==0)?"":g);
if(m[r]&&f.getRosterContact(m[r])){
this.xmppURI=AjxStringUtil.htmlEncode(m[r]);
this._setChatFrame();
break
}}}}}
if(!this.emailZimlet.noRightClick){
m.rightClickForMoreOptions=false
}
this.attribs=m;
m=this._formatTexts(m);
var d=AjxTemplate.expand("com_zimbra_email.templates.Email1#ContactDetails",m),t=document.getElementById(UnknownPersonSlide.TEXT_DIV_ID),u=document.getElementById("UnknownPersonSlide_Frame");
if(t){
t.innerHTML=d
}
if(u){
u.onmouseup=AjxCallback.simpleClosure(this._handleAllClicks,this)
}};
UnknownPersonSlide.prototype._formatTexts=function(t){
var e=t.email?t.email:"";
t.formattedEmail=e;
if(e.length>25){
var o=e.split("@");
var n=o[0];
var r=o[1];
if(n.length>25){
n=n.substring(0,24)+".."
}
t.formattedEmail=[n," @",r].join("")
}
var s=t.fullName?t.fullName:"";
if(s==e){
t.fullName=""
}
return t
};
UnknownPersonSlide.prototype._setProfileImage=function(n){
var o=document.getElementById(UnknownPersonSlide.PHOTO_PARENT_ID);
if(!o||!this.emailZimlet.emailAddress){
return
}
if(this.emailZimlet.emailAddress.indexOf(UnknownPersonSlide.DOMAIN)==-1||!n||!o){
this._handleImgLoadFailure();
return
}
o.width=o.style.width=UnknownPersonSlide.WIDTH;
o.height=o.style.height=UnknownPersonSlide.HEIGHT;
var t=new Image();
t.onload=AjxCallback.simpleClosure(this._handleImageLoad,this,t);
t.onerror=function(){
this.onerror=null;
this.src=ZmZimbraMail.DEFAULT_CONTACT_ICON
};
t.src=n;
var e=new AjxCallback(this,this._handleImgLoadFailure);
this.emailZimlet.showLoadingAtId(e,UnknownPersonSlide.PHOTO_PARENT_ID)
};
UnknownPersonSlide.prototype._contactListener=function(){
this.emailZimlet.popdown();
var e=new AjxCallback(this,this._handleLoadContact);
AjxDispatcher.require(["ContactsCore","Contacts"],false,e,null,true)
};
UnknownPersonSlide.prototype._handleLoadContact=function(){
var e=this._getActionedContact(true);
var t=this._isNewContact;
if(window.parentAppCtxt){
var o=window.parentAppCtxt.getApp(ZmApp.CONTACTS);
o.getContactController().show(e,t)
}else{
AjxDispatcher.run("GetContactController").show(e,t)
}};
UnknownPersonSlide.prototype._composeListener=function(t,s){
this.emailZimlet.popdown();
var o=this.emailZimlet._actionObject;
s=s?this.emailZimlet._getAddress(s):(o?this.emailZimlet._getAddress(o):"");
var n={};
var e=(!appCtxt.get(ZmSetting.NEW_WINDOW_COMPOSE)&&t&&t.shiftKey)||(appCtxt.get(ZmSetting.NEW_WINDOW_COMPOSE)&&t&&!t.shiftKey);
n.action=ZmOperation.NEW_MESSAGE;
n.inNewWindow=e;
if(!n.toOverride){
n.toOverride=s+AjxEmailAddress.SEPARATOR
}
if(o&&o.isAjxEmailAddress&&o.address==s){
n.toOverride=o
}
AjxDispatcher.run("Compose",n)
};
UnknownPersonSlide.prototype._getActionedContact=function(t){
var e;
var o=this.emailZimlet._actionObject;
if(o){
if(o.isZmContact){
e=this._actionObject
}else{
if(AjxUtil.isString(o)){
o=this.emailZimlet._getAddress(o);
e=AjxDispatcher.run("GetContacts").getContactByEmail(o)
}else{
e=AjxDispatcher.run("GetContacts").getContactByEmail(o.address)
}}}
this._isNewContact=false;
if(e==null&&t){
this._isNewContact=true;
e=new ZmContact(null);
e.initFromEmail(o)
}
return e
};
UnknownPersonSlide.prototype._isKnownPresenceCode=function(o){
if(!this._presenceCodes){
var e=["dnd","vacation","on-the-phone","busy","unavailable","away","available","unknown"];
this._presenceCodes={};
for(var t=0;
t<e.length;
t++){
this._presenceCodes[e[t]]=true
}}
return this._presenceCodes[o]
};
UnknownPersonSlide.prototype._setPresenceUI=function(){
var o=this._getPresence();
var n=o&&o.presenceStatus;
var s=document.getElementById("row_Presence");
var r=document.getElementById("img_Presence");
var t=document.getElementById("text_Presence");
if(!s||!r||!t){
return
}
if(n){
if(!this._isKnownPresenceCode(n)){
n="unknown"
}
s.style.display="";
var e=n.split("-").join("");
r.className="Img_"+e;
if(o.notes){
t.innerHTML=o.notes
}else{
t.innerHTML=this.emailZimlet.getMessage("msg_"+e)
}}else{
s.style.display="none"
}
return
};
function com_zimbra_attachmail_HandlerObject(){}
com_zimbra_attachmail_HandlerObject.prototype=new ZmZimletBase();
com_zimbra_attachmail_HandlerObject.prototype.constructor=com_zimbra_attachmail_HandlerObject;
var AttachMailZimlet=com_zimbra_attachmail_HandlerObject;
AttachMailZimlet.prototype.initializeAttachPopup=function(t,e){
e._createAttachMenuItem(t,ZmMsg.mail,this.showAttachmentDialog.bind(this),"ATTACH_MENU_MAIL")
};
AttachMailZimlet.prototype.removePrevAttDialogContent=function(t){
var e=t&&t.firstChild;
if(e&&e.className=="DwtComposite"){
t.removeChild(e)
}};
AttachMailZimlet.prototype.onDisposeComposeController=function(){
this.AMV._overview._controller.dispose()
};
AttachMailZimlet.prototype.showAttachmentDialog=function(){
var t=this._attachDialog=appCtxt.getAttachDialog();
t.setTitle(ZmMsg.attachMail);
this.removePrevAttDialogContent(t._getContentDiv().firstChild);
if(!this.AttachContactsView||!this.AttachContactsView.attachDialog){
this.AMV=new AttachMailTabView(this._attachDialog,this)
}
this.AMV.reparentHtmlElement(t._getContentDiv().childNodes[0],0);
this.AMV.attachDialog=t;
t.setOkListener(new AjxCallback(this.AMV,this.AMV.uploadFiles));
var e=appCtxt.getCurrentView();
var o=new AjxCallback(e,e._attsDoneCallback,[true]);
t.setUploadCallback(o);
this.AMV.attachDialog.popup();
this.AMV.attachDialog.enableInlineOption(false);
this._addedToMainWindow=true
};
AttachMailZimlet.prototype.doubleClicked=function(){
this.singleClicked()
};
AttachMailZimlet.prototype.singleClicked=function(){};
AttachMailTabView=function(o,e,t){
this.zimlet=e;
DwtComposite.call(this,o,t,Dwt.STATIC_STYLE);
var n=appCtxt.multiAccounts?appCtxt.getAppViewMgr().getCurrentView().getFromAccount():appCtxt.getActiveAccount();
if(this.prevAccount&&(n.id==this.prevAccount.id)){
this.setSize(Dwt.DEFAULT,"275");
return
}
this.prevAccount=n;
this._createHtml1();
document.getElementById(this._folderTreeCellId).onclick=AjxCallback.simpleClosure(this._treeListener,this)
};
AttachMailTabView.prototype=new DwtComposite;
AttachMailTabView.prototype.constructor=AttachMailTabView;
AttachMailTabView.ELEMENT_ID_SEARCH_FIELD="attDlg_attMsg_SearchField";
AttachMailTabView.ELEMENT_ID_SEARCH_BUTTON="attDlg_attMsg_SearchBtn";
AttachMailTabView.ELEMENT_ID_VIEW_MESSAGE_BUTTON="attDlg_attMsg_ViewMsgBtn";
AttachMailTabView.ELEMENT_ID_NAV_BUTTON_CELL="attDlg_attMsg_NavBtnCell";
AttachMailTabView.prototype.toString=function(){
return"AttachMailTabView"
};
AttachMailTabView.prototype.showMe=function(){
DwtTabViewPage.prototype.showMe.call(this);
var e=appCtxt.multiAccounts?appCtxt.getAppViewMgr().getCurrentView().getFromAccount():appCtxt.getActiveAccount();
if(this.prevAccount&&(e.id==this.prevAccount.id)){
this.setSize(Dwt.DEFAULT,"275");
return
}
this.prevAccount=e;
this._createHtml1();
document.getElementById(this._folderTreeCellId).onclick=AjxCallback.simpleClosure(this._treeListener,this)
};
AttachMailTabView.prototype._resetQuery=function(e){
if(this._currentQuery==undefined){
this._currentQuery=e;
return e
}
if(this._currentQuery!=e){
this._offset=0;
this._currentQuery=e
}
return e
};
AttachMailTabView.prototype._getQueryFromFolder=function(e){
return this._resetQuery('inid:"'+e+'"')
};
AttachMailTabView.prototype.hideMe=function(){
DwtTabViewPage.prototype.hideMe.call(this)
};
AttachMailTabView.prototype._createHtml1=function(){
this._tableID=Dwt.getNextId();
this._folderTreeCellId=Dwt.getNextId();
this._folderListId=Dwt.getNextId();
var o=[];
var d=0;
o[d++]='<table width="100%" style="margin-bottom:5px">';
o[d++]='<TR><td width="20%"><INPUT type="text" id="';
o[d++]=AttachMailTabView.ELEMENT_ID_SEARCH_FIELD;
o[d++]='" style="padding:4px"></INPUT></td>';
o[d++]='<td width="10%"><div id="';
o[d++]=AttachMailTabView.ELEMENT_ID_SEARCH_BUTTON;
o[d++]='" style="margin: 0 2px" />';
o[d++]='<td width="10%"><div id="';
o[d++]=AttachMailTabView.ELEMENT_ID_VIEW_MESSAGE_BUTTON;
o[d++]='" style="margin: 0 2px" /></td>';
o[d++]='<td align="right" width="60%"><SPAN id="';
o[d++]=AttachMailTabView.ELEMENT_ID_NAV_BUTTON_CELL;
o[d++]='" /></td></TR></table>';
o[d++]='<table width="100%">';
o[d++]="<tr>";
o[d++]='<td valign="top" id="'+this._folderTreeCellId+'">';
o[d++]="</td>";
o[d++]='<td  valign="top"  id="'+this._folderListId+'">';
o[d++]="</td>";
o[d++]="</tr>";
o[d++]="</table>";
this.setContent(o.join(""));
var h=new DwtButton({
parent:this}
);
var e=this.zimlet.getMessage("AttachMailZimlet_tab_button_search");
h.setText(e);
h.addSelectionListener(new AjxListener(this,this._searchButtonListener));
document.getElementById(AttachMailTabView.ELEMENT_ID_SEARCH_BUTTON).appendChild(h.getHtmlElement());
var r=new DwtButton({
parent:this}
);
var l=this.zimlet.getMessage("AttachMailZimlet_tab_button_view");
r.setText(l);
r.addSelectionListener(new AjxListener(this,this._viewMsgButtonListener));
document.getElementById(AttachMailTabView.ELEMENT_ID_VIEW_MESSAGE_BUTTON).appendChild(r.getHtmlElement());
this._navigationContainer=new DwtComposite(appCtxt.getShell());
this._navTB=new AMZimletNavToolBar({
parent:this._navigationContainer}
);
var s=new AjxListener(this,this._navBarListener);
this._navTB.addSelectionListener(ZmOperation.PAGE_BACK,s);
this._navTB.addSelectionListener(ZmOperation.PAGE_FORWARD,s);
document.getElementById(AttachMailTabView.ELEMENT_ID_NAV_BUTTON_CELL).appendChild(this._navTB.getHtmlElement());
var t={
parent:appCtxt.getShell(),className:"AttachMailTabBox AttachMailList",posStyle:DwtControl.ABSOLUTE_STYLE,view:ZmId.VIEW_BRIEFCASE_ICON,type:ZmItem.ATT};
var n=this._tabAttachMailView=new ZmAttachMailListView(t);
this.showAttachMailTreeView();
n.reparentHtmlElement(this._folderListId);
n.addSelectionListener(new AjxListener(this,this._listSelectionListener));
Dwt.setPosition(n.getHtmlElement(),Dwt.RELATIVE_STYLE)
};
AttachMailTabView.prototype._searchButtonListener=function(e){
this.treeView.deselectAll();
var o=document.getElementById(AttachMailTabView.ELEMENT_ID_SEARCH_FIELD).value;
if(o==""){
return
}
var t=this._resetQuery(o);
this.executeQuery(t)
};
AttachMailTabView.prototype._viewMsgButtonListener=function(o){
var e=this.getSelectedMsgs();
for(var t=0;
t<e.length;
t++){
e[t].load({}
);
ZmMailMsgView.detachMsgInNewWindow(e[t])
}};
AttachMailTabView.prototype._navBarListener=function(e){
var t=e.item.getData(ZmOperation.KEY_ID);
this._paginate(t==ZmOperation.PAGE_FORWARD)
};
AttachMailTabView.prototype._paginate=function(e){
this.executeQuery(this._currentQuery,e)
};
AttachMailTabView.prototype.searchFolder=function(t){
var e=AjxSoapDoc.create("SearchRequest","urn:zimbraMail");
e.setMethodAttribute("types","message");
e.setMethodAttribute("limit",t.limit);
e.setMethodAttribute("offset",t.offset);
e.set("query",t.query);
t.response=appCtxt.getAppController().sendRequest({
soapDoc:e,noBusyOverlay:false}
);
this.handleSearchResponse(t)
};
AttachMailTabView.prototype.handleSearchResponse=function(t){
var e=t.response;
if(e&&(e.SearchResponse||e._data.SearchResponse)){
t.searchResponse=e.SearchResponse||e._data.SearchResponse;
t.items=this.processDocsResponse(t)
}
if(t.callback){
t.callback.run(t)
}};
AttachMailTabView.prototype.processDocsResponse=function(s){
var o=s.searchResponse.m;
var e=new ZmMailList(ZmItem.MSG,this._currentSearch);
e.clear();
e.setHasMore(s.searchResponse.more);
if(o==undefined){
return e
}
for(var t=0;
t<o.length;
t++){
var n=o[t];
e.addFromDom(n)
}
return e
};
AttachMailTabView.prototype.showResultContents=function(n){
var t=n.items;
this._navTB.enable(ZmOperation.PAGE_BACK,n.offset>0);
this._navTB.enable(ZmOperation.PAGE_FORWARD,t.hasMore());
var o=t.size();
if(o==0){
this._navTB.setText("")
}else{
this._navTB.setText((this._offset+1)+"-"+(this._offset+t.size()))
}
if(t){
this._list=t
}else{
this._list=new ZmList(ZmItem.BRIEFCASE_ITEM)
}
var e=this._tabAttachMailView;
e.set(this._list)
};
AttachMailTabView.prototype._handleKeys=function(t){
var e=DwtKeyEvent.getCharCode(t);
return !DwtKeyEvent.IS_RETURN[e]
};
AttachMailTabView.prototype.gotAttachments=function(){
return false
};
AttachMailTabView.prototype.getSelectedMsgs=function(){
var e=this._tabAttachMailView;
return e.getSelection()
};
AttachMailTabView.prototype.uploadFiles=function(o,e){
if(!e){
e=[];
var t=this.getSelectedMsgs();
if(!t||(t.length==0)){
return
}
for(var n in t){
e.push(t[n].id)
}}
if(o==undefined){
o=this.attachDialog
}
if(o._uploadCallback){
o._uploadCallback.run(AjxPost.SC_OK,null,null,e)
}
o.popdown()
};
AttachMailTabView.prototype.showAttachMailTreeView=function(){
var e=new AjxCallback(this,this._showTreeView);
AjxPackage.undefine("zimbraMail.mail.controller.ZmMailFolderTreeController");
AjxPackage.require({
name:"MailCore",forceReload:true,callback:e}
)
};
AttachMailTabView.prototype._showTreeView=function(){
if(appCtxt.isChildWindow){
ZmOverviewController.CONTROLLER.FOLDER="ZmMailFolderTreeController"
}
var o=appCtxt.getApp(ZmApp.MAIL);
o._createDeferredFolders();
var e=this.toString();
var t={
treeIds:["FOLDER"],fieldId:this._folderTreeCellId,overviewId:(appCtxt.multiAccounts)?([e,this.prevAccount.name].join(":")):e,account:this.prevAccount};
this._setOverview(t);
this.setSize(Dwt.DEFAULT,"275");
this._currentQuery=this._getQueryFromFolder("2");
setTimeout(AjxCallback.simpleClosure(this.treeView.setSelected,this.treeView,2),100)
};
AttachMailTabView.prototype._setOverview=function(n){
var o=n.overviewId;
var s=appCtxt.getOverviewController();
var t=s.getOverview(o);
if(!t){
var e={
overviewId:o,overviewClass:"AttachMailTabBox",headerClass:"DwtTreeItem",noTooltips:true,treeIds:n.treeIds};
t=s.createOverview(e);
t.account=this.prevAccount;
t.set(n.treeIds);
t.clearChangeListener(n.treeIds)
}else{
if(n.account){
t.account=n.account
}}
t.setSelected(this.prevAccount.id+":"+ZmFolder.ID_INBOX,"FOLDER");
this._overview=t;
document.getElementById(n.fieldId).appendChild(t.getHtmlElement());
this.treeView=t.getTreeView("FOLDER");
this.treeView.addSelectionListener(new AjxListener(this,this._treeListener));
this._hideRoot(this.treeView)
};
AttachMailTabView.prototype._treeListener=function(o,e){
o=o||window.event;
if(e||o.detail==DwtTree.ITEM_SELECTED){
var t=this.treeView.getSelected();
document.getElementById(AttachMailTabView.ELEMENT_ID_SEARCH_FIELD).value=['in:"',t.getSearchPath(),'"'].join("");
var n=this._getQueryFromFolder(t.id);
this.executeQuery(n);
this._tabAttachMailView.focus()
}};
AttachMailTabView.prototype._hideRoot=function(t){
var o=t.getTreeItemById(ZmOrganizer.ID_ROOT);
if(!o){
var e=ZmOrganizer.getSystemId(ZmOrganizer.ID_ROOT,this.prevAccount);
o=t.getTreeItemById(e)
}
o.showCheckBox(false);
o.setExpanded(true);
o.setVisible(false,true)
};
AttachMailTabView.prototype.setSize=function(n,e){
DwtTabViewPage.prototype.setSize.call(this,n,e);
var o=this.getSize();
var r=o.x*0.35;
var s=o.x-r;
var t=e-55;
this._overview.setSize(r,t);
this._tabAttachMailView.setSize(s-5,t);
return this
};
AttachMailTabView.prototype.executeQuery=function(t,e){
if(this._limit==undefined){
this._limit=50
}
if(this._offset==undefined){
this._offset=0
}
if(e!=undefined){
if(e){
this._offset=this._offset+50
}else{
this._offset=this._offset-50
}}
var o=new AjxCallback(this,this.showResultContents);
this.searchFolder({
query:t,offset:this._offset,limit:this._limit,callback:o}
)
};
ZmAttachMailController=function(e){
if(arguments.length==0){
return
}
ZmListController.call(this,null,null);
this.clearChangeListener();
this._currentViewId="ZmAttachMailListView";
this._view={};
this._view[this._currentViewId]=e
};
ZmAttachMailController.prototype=new ZmListController;
ZmAttachMailController.prototype.constructor=ZmAttachMailController;
ZmAttachMailController.prototype._resetToolbarOperations=function(){};
ZmAttachMailController.prototype.clearChangeListener=function(){
if(this._boundTagChangeListener){
var e=appCtxt.getTagTree();
if(e){
e.removeChangeListener(this._boundTagChangeListener)
}}};
ZmAttachMailListView=function(e){
this._showCheckboxColSpan=appCtxt.get(ZmSetting.SHOW_SELECTION_CHECKBOX);
ZmListView.call(this,e);
this.clearChangeListener();
this._controller=new ZmAttachMailController(this)
};
ZmAttachMailListView.prototype=new ZmListView;
ZmAttachMailListView.prototype.constructor=ZmAttachMailListView;
ZmAttachMailListView.prototype._getDivClass=function(t,e,o){
return""
};
ZmAttachMailListView.prototype.clearChangeListener=function(){
if(this._boundFolderChangeListener){
var t=appCtxt.getFolderTree();
if(t){
t.removeChangeListener(this._boundFolderChangeListener)
}}
if(this._tagListChangeListener){
var e=appCtxt.getTagTree();
if(e){
e.removeChangeListener(this._tagListChangeListener)
}}};
ZmAttachMailListView.prototype._getCellContents=function(u,d,m,h,t,e){
var n=m.fragment?AjxStringUtil.htmlEncode(m.fragment.slice(0,80)):"";
var l=m.getAddress("FROM");
if(l.name!=""){
l=l.name
}else{
l=l.address
}
var o="";
var r=2;
if(m.hasAttach){
o="<td width='16px'><div class='ImgAttachment'/></td>";
r=3
}
u[d++]="<div class='AttachMailRowDiv'>";
u[d++]="<table width='100%'>";
var s=m.subject?AjxStringUtil.htmlEncode(m.subject.slice(0,32)):ZmMsg.noSubject;
u[d++]="<tr>";
if(this._showCheckboxColSpan){
u[d++]="<td rowspan=3 style='vertical-align:middle;' width='20'><center>";
d=this._getImageHtml(u,d,"CheckboxUnchecked",this._getFieldId(m,ZmItem.F_SELECTION));
u[d++]="</center></td>"
}
u[d++]=o;
u[d++]="<td align='left' width='80%'><span class='AttachMailSubject'> "+s+"</span></td>";
u[d++]="<td width='20%' align='right'>";
u[d++]=AjxDateUtil.computeDateStr(e.now||new Date(),m.date);
u[d++]="</td></tr>";
u[d++]="<tr><td align='left' colspan='"+r+"'><span class='AttachMailFrom'> ";
u[d++]=l;
u[d++]="</span></td></tr>";
if(n!=""){
u[d++]="<tr><td align=left colspan="+r+"><span class='AttachMailFrag'>"+n+"</span></td></tr>"
}
u[d++]="</table></div>";
return d
};
AMZimletNavToolBar=function(t){
t.className=t.className||"AMZimletNavToolBar";
var e=(t.hasText!==false);
t.buttons=this._getButtons(e);
t.toolbarType=ZmId.TB_NAV;
t.posStyle=t.posStyle||DwtControl.STATIC_STYLE;
ZmButtonToolBar.call(this,t);
if(e){
this._textButton=this.getButton(ZmOperation.TEXT)
}};
AMZimletNavToolBar.prototype=new ZmButtonToolBar;
AMZimletNavToolBar.prototype.constructor=AMZimletNavToolBar;
AMZimletNavToolBar.prototype.toString=function(){
return"AMZimletNavToolBar"
};
AMZimletNavToolBar.prototype._getButtons=function(e){
var t=[];
t.push(ZmOperation.PAGE_BACK);
if(e){
t.push(ZmOperation.TEXT)
}
t.push(ZmOperation.PAGE_FORWARD);
return t
};
AMZimletNavToolBar.prototype.createOp=function(t,e){
e.textClassName="ZWidgetTitle AMZimletNavToolBarTitle";
return ZmButtonToolBar.prototype.createOp.apply(this,arguments)
};
AMZimletNavToolBar.prototype.setText=function(e){
if(!this._textButton){
return
}
this._textButton.setText(e)
};
function com_zimbra_attachcontacts_HandlerObject(){}
com_zimbra_attachcontacts_HandlerObject.prototype=new ZmZimletBase();
com_zimbra_attachcontacts_HandlerObject.prototype.constructor=com_zimbra_attachcontacts_HandlerObject;
var AttachContactsZimlet=com_zimbra_attachcontacts_HandlerObject;
AttachContactsZimlet.SEND_CONTACTS="SEND_CONTACTS_IN_EMAIL";
AttachContactsZimlet.prototype.init=function(){
this._op=ZmOperation.registerOp(AttachContactsZimlet.SEND_CONTACTS,{
image:"MsgStatusSent",text:this.getMessage("ACZ_Send"),tooltip:this.getMessage("ACZ_SendContactsAsAttachments")}
);
this._contactSendListener=new AjxListener(this,this._contactListSendListener);
this.overrideAPI(ZmListController.prototype,"_setContactText",this._setContactText)
};
AttachContactsZimlet.prototype.initializeAttachPopup=function(t,e){
e._createAttachMenuItem(t,ZmMsg.contacts,this.showAttachmentDialog.bind(this),"ATTACH_MENU_CONTACT")
};
AttachContactsZimlet.prototype.removePrevAttDialogContent=function(t){
var e=t&&t.firstChild;
if(e&&e.className=="DwtComposite"){
t.removeChild(e)
}};
AttachContactsZimlet.prototype.showAttachmentDialog=function(){
var e=this._attachDialog=appCtxt.getAttachDialog();
e.setTitle(ZmMsg.attachContact);
e.setButtonEnabled(DwtDialog.OK_BUTTON,false);
this.removePrevAttDialogContent(e._getContentDiv().firstChild);
if(!this.AttachContactsView||!this.AttachContactsView.attachDialog){
this.AttachContactsView=new AttachContactsTabView(this._attachDialog,this);
var t=this._selectionListener.bind(this);
this.AttachContactsView.addListener(DwtEvent.SELECTION,t)
}
this.AttachContactsView.reparentHtmlElement(e._getContentDiv().childNodes[0],0);
this.AttachContactsView.attachDialog=e;
e.setOkListener(new AjxCallback(this,this._okListener));
this.AttachContactsView.attachDialog.popup();
this.AttachContactsView.attachDialog.enableInlineOption(false);
this._addedToMainWindow=true
};
AttachContactsZimlet.prototype._okListener=function(){
this.AttachContactsView.uploadFiles();
this.AttachContactsView.setClosed(true);
this.AttachContactsView.attachDialog.popdown()
};
AttachContactsZimlet.prototype._selectionListener=function(){
var e=this.AttachContactsView.getSelectionCount()>0;
this._attachDialog.setButtonEnabled(DwtDialog.OK_BUTTON,e)
};
AttachContactsZimlet.prototype.addExtraMsgParts=function(o,e){
if(!e||!this._isDraftInitiatedByThisZimlet){
return
}
if(o&&o.m){
if(!o.m.attach){
o.m.attach={};
o.m.attach.cn=[]
}else{
if(!o.m.attach.cn){
o.m.attach.cn=[]
}}
var s=this.contactIdsToAttach;
if(s){
for(var t=0;
t<s.length;
t++){
var n=s[t];
if(appCtxt.multiAccounts&&s[t].indexOf(":")==-1){
n=[appCtxt.getActiveAccount().id,":",s[t]].join("")
}
o.m.attach.cn.push({
id:n}
)
}}}
this._isDraftInitiatedByThisZimlet=false
};
AttachContactsZimlet.prototype._initContactsReminderToolbar=function(n,e){
var s=AttachContactsZimlet.SEND_CONTACTS;
if(n.getButton(s)||!this._isOkayToAttach()){
return
}
var o=AjxUtil.hashCopy(ZmOperation.SETUP[s]);
o.text=this.getMessage("ACZ_Send");
var t=n.createZimletOp(s,o);
t.addSelectionListener(this._contactSendListener)
};
AttachContactsZimlet.prototype.resetContactListToolbarOperations=function(t,e){
var n=t;
var o=null;
if(t.isZmButtonToolBar){
n=n.getActionsMenu();
o=ZmOperation.NEW_MESSAGE
}
this._addContactActionMenuItem(n,o);
n.enable(AttachContactsZimlet.SEND_CONTACTS,e>0&&this._isOkayToAttach())
};
AttachContactsZimlet.prototype._isOkayToAttach=function(){
this._getContactListIds();
return this.contactIdsToAttach&&this.contactIdsToAttach.length>0
};
AttachContactsZimlet.prototype._contactListSendListener=function(){
this._getContactListIds();
if(this.contactIdsToAttach&&this.contactIdsToAttach.length){
this._openCompose()
}};
AttachContactsZimlet.prototype._getContactListIds=function(){
var o=AjxDispatcher.run("GetContactListController");
this.contactIdsToAttach=[];
var t=o.getListView&&o.getListView();
if(t){
var n=t.getSelection();
for(var s=0;
s<n.length;
s++){
var e=n[s];
if(e.isGal||e.isGroup()){
continue
}
this.contactIdsToAttach.push(e.id)
}}
return this.contactIdsToAttach
};
AttachContactsZimlet.prototype._openCompose=function(){
var t=ZmOperation.NEW_MESSAGE;
AjxDispatcher.run("Compose",{
action:t,inNewWindow:false}
);
var e=appCtxt.getApp(ZmApp.MAIL).getComposeController(appCtxt.getApp(ZmApp.MAIL).getCurrentSessionId(ZmId.VIEW_COMPOSE));
this._isDraftInitiatedByThisZimlet=true;
e.saveDraft(ZmComposeController.DRAFT_TYPE_AUTO)
};
AttachContactsZimlet.prototype._setContactText=function(e){
if(this._participantActionMenu){
this._participantActionMenu.enable(AttachContactsZimlet.SEND_CONTACTS,e&&!e.isGal)
}
arguments.callee.func.apply(this,arguments)
};
AttachContactsZimlet.prototype.onParticipantActionMenuInitialized=function(e,t){
this.onActionMenuInitialized(e,t)
};
AttachContactsZimlet.prototype.onActionMenuInitialized=function(e,t){
this.addMenuButton(this._getContact.bind(this),t,ZmOperation.CONTACT)
};
AttachContactsZimlet.prototype._addContactActionMenuItem=function(e,t){
this.addMenuButton(this._getContact.bind(this),e,t||ZmOperation.CONTACT)
};
AttachContactsZimlet.prototype._getContact=function(){
var o=appCtxt.getCurrentController();
if(!o){
return
}
var t=o._actionEv&&o._actionEv.contact;
if(o instanceof ZmContactListController){
var e=o.getListView();
if(e){
var s=e.getSelection();
if(s&&s.length>0){
if(!t){
return s
}
for(var n=0;
n<s.length;
n++){
if(s[n]===t){
return s
}}}}}
return t
};
AttachContactsZimlet.prototype.addMenuButton=function(e,r,s){
if(e&&r&&!r.getMenuItem(AttachContactsZimlet.SEND_CONTACTS)){
var t=null;
if(AjxUtil.isString(s)){
var n=r.getMenuItem(s);
if(n){
for(t=0,c=r.getChildren();
t<c.length&&c[t]!==n;
t++){}}}else{
if(AjxUtil.isNumber(s)){
t=s
}}
if(!s||t!==null){
var h={
id:AttachContactsZimlet.SEND_CONTACTS,text:this.getMessage("ACZ_SendContact"),image:"MsgStatusSent"};
if(t!==null){
h.index=t+1
}
var o=ZmOperation.defineOperation(null,h);
r.addOp(AttachContactsZimlet.SEND_CONTACTS);
r.addSelectionListener(AttachContactsZimlet.SEND_CONTACTS,new AjxListener(this,this._contactActionMenuListener,e))
}}};
AttachContactsZimlet.prototype._contactActionMenuListener=function(t,n){
var e=t.run();
if(e){
var s=AjxUtil.toArray(e);
if(s.length){
this.contactIdsToAttach=[];
for(var o=0;
o<s.length;
o++){
if(!s[o].isGroup()){
this.contactIdsToAttach.push(s[o].id)
}}
if(this.contactIdsToAttach.length>0){
this._openCompose()
}}}};
AttachContactsZimlet.prototype.overrideAPI=function(o,t,n){
n=n||this[t];
if(n){
var e=o[t];
o[t]=function(){
n.func=e;
return n.apply(this,arguments)
};
o[t].func=e
}};
ACZimletNavToolBar=function(t){
t.className=t.className||"ACZimletNavToolBar";
var e=(t.hasText!==false);
t.buttons=this._getButtons(e);
t.toolbarType=ZmId.TB_NAV;
t.posStyle=t.posStyle||DwtControl.STATIC_STYLE;
ZmButtonToolBar.call(this,t);
if(e){
this._textButton=this.getButton(ZmOperation.TEXT)
}};
ACZimletNavToolBar.prototype=new ZmButtonToolBar;
ACZimletNavToolBar.prototype.constructor=ACZimletNavToolBar;
ACZimletNavToolBar.prototype.toString=function(){
return"ACZimletNavToolBar"
};
ACZimletNavToolBar.prototype._getButtons=function(e){
var t=[];
t.push(ZmOperation.PAGE_BACK);
if(e){
t.push(ZmOperation.TEXT)
}
t.push(ZmOperation.PAGE_FORWARD);
return t
};
ACZimletNavToolBar.prototype.createOp=function(t,e){
e.textClassName="ZWidgetTitle ACZimletNavToolBarTitle";
return ZmButtonToolBar.prototype.createOp.apply(this,arguments)
};
ACZimletNavToolBar.prototype.setText=function(e){
if(!this._textButton){
return
}
this._textButton.setText(e)
};
AttachContactsTabView=function(o,e,t){
this.zimlet=e;
DwtComposite.call(this,o,t,Dwt.STATIC_STYLE);
this._createHtml1();
this.closed=true
};
AttachContactsTabView.prototype=new DwtComposite;
AttachContactsTabView.prototype.constructor=AttachContactsTabView;
AttachContactsTabView.ELEMENT_ID_SEARCH_FIELD="attDlg_attContact_SearchField";
AttachContactsTabView.ELEMENT_ID_SEARCH_BUTTON="attDlg_attContact_SearchBtn";
AttachContactsTabView.ELEMENT_ID_NAV_BUTTON_CELL="attDlg_attContact_NavBtnCell";
AttachContactsTabView.DEFAULT_CONTACTS_FOLDER="7";
AttachContactsTabView.GROUP_CUTOFF=6;
AttachContactsTabView.prototype.toString=function(){
return"AttachContactsTabView"
};
AttachContactsTabView.prototype.showMe=function(){
DwtTabViewPage.prototype.showMe.call(this);
var e=appCtxt.multiAccounts?appCtxt.getAppViewMgr().getCurrentView().getFromAccount():appCtxt.getActiveAccount();
if(appCtxt.multiAccounts){
appCtxt.accountList.setActiveAccount(e)
}
if(this.prevAccount&&(e.id==this.prevAccount.id)){
this.reset();
this.setSize(Dwt.DEFAULT,"295");
return
}
this.prevAccount=e;
this._createHtml1();
Dwt.byId(this._folderTreeCellId).onclick=AjxCallback.simpleClosure(this._treeListener,this)
};
AttachContactsTabView.prototype.setClosed=function(e){
this._closed=(e!==false)
};
AttachContactsTabView.prototype._resetQuery=function(e){
if(this._currentQuery==undefined){
return e
}
if(this._currentQuery!=e){
this._offset=0;
this._currentQuery=e
}
return e
};
AttachContactsTabView.prototype._getQueryFromFolder=function(e){
return this._resetQuery('inid:"'+e+'"')
};
AttachContactsTabView.prototype.hideMe=function(){
DwtTabViewPage.prototype.hideMe.call(this)
};
AttachContactsTabView.prototype._createHtml1=function(){
this._tableID=Dwt.getNextId();
this._folderTreeCellId=Dwt.getNextId();
this._folderListId=Dwt.getNextId();
var o=[];
o.push("<table class='AttachContacts_table' width='100%' style='margin-bottom:5px;'>","<TR><td><INPUT type='text' id='",AttachContactsTabView.ELEMENT_ID_SEARCH_FIELD,"'></INPUT></td>","<td width='80%' style='padding:0 2px'><SPAN id='",AttachContactsTabView.ELEMENT_ID_SEARCH_BUTTON,"' /></td>","<td><SPAN id='",AttachContactsTabView.ELEMENT_ID_NAV_BUTTON_CELL,"' /></td></TR></table>","<table width='100%'><tr><td valign='top' id='",this._folderTreeCellId,"'></td>","<td  valign='top'><div  id='",this._folderListId,"' ></div>","</td></tr></table>");
this.setContent(o.join(""));
var t=new DwtButton({
parent:this}
);
var e=this.zimlet.getMessage("ACZ_tab_button_search");
t.setText(e);
t.setImage("Contact");
t.setSize("140");
t.addSelectionListener(new AjxListener(this,this._searchButtonListener));
Dwt.byId(AttachContactsTabView.ELEMENT_ID_SEARCH_BUTTON).appendChild(t.getHtmlElement());
this._navigationContainer=new DwtComposite(appCtxt.getShell());
this._navTB=new ACZimletNavToolBar({
parent:this._navigationContainer}
);
var n=new AjxListener(this,this._navBarListener);
this._navTB.addSelectionListener(ZmOperation.PAGE_BACK,n);
this._navTB.addSelectionListener(ZmOperation.PAGE_FORWARD,n);
Dwt.byId(AttachContactsTabView.ELEMENT_ID_NAV_BUTTON_CELL).appendChild(this._navTB.getHtmlElement());
this.showAttachContactsTreeView();
Dwt.byId(this._folderListId);
Dwt.byId(this._folderListId).onclick=AjxCallback.simpleClosure(this._handleItemSelect,this)
};
AttachContactsTabView.prototype._handleItemSelect=function(n){
if(AjxEnv.isIE){
n=window.event
}
var o=DwtShell.mouseEvent;
o.setFromDhtmlEvent(n);
var e=o.target;
var r=true;
if(e.className=="ImgCheckboxUnchecked"||e.className=="ImgCheckboxChecked"){
r=false
}
while(!Dwt.hasClass(e,"AttachContactRow")&&e.id!=this._folderListId){
e=e.parentNode
}
if(e.id==this._folderListId){
return
}
this._resetRowSelection(r);
var s=e.id.replace("attachContactsZimlet_row_","");
var t=document.getElementById("attachContactsZimlet_checkbox_"+s);
if(t&&!r){
if(t.className=="ImgCheckboxUnchecked"){
this._setCheckBoxSelection(t,true)
}else{
if(t.className=="ImgCheckboxChecked"){
this._setCheckBoxSelection(t,false)
}}}
if(e){
if(e.className.indexOf("Row-selected")>=0){
if(t.className!="ImgCheckboxChecked"){
this._setRowSelection(e,false);
this._selectedItemIds[s]=false
}}else{
this._setRowSelection(e,true);
this._selectedItemIds[s]=true
}}
this._selectionChanged()
};
AttachContactsTabView.prototype._resetRowSelection=function(n){
for(var o in this._selectedItemIds){
var t=document.getElementById("attachContactsZimlet_checkbox_"+o);
var e=document.getElementById("attachContactsZimlet_row_"+o);
if(!n&&t&&t.className=="ImgCheckboxChecked"){
continue
}
this._setRowSelection(e,false);
this._setCheckBoxSelection(t,false);
if(this._selectedItemIds&&this._selectedItemIds[o]){
this._selectedItemIds[o]=false
}}};
AttachContactsTabView.prototype._setCheckBoxSelection=function(t,e){
if(!t){
return
}
if(!e){
t.className="ImgCheckboxUnchecked"
}else{
t.className="ImgCheckboxChecked"
}};
AttachContactsTabView.prototype._setRowSelection=function(e,t){
if(!e){
return
}
if(!t){
e.className=AjxStringUtil.trim(e.className.replace("Row-selected",""))
}else{
if(e.className.indexOf("Row-selected")==-1){
e.className=e.className+" Row-selected"
}}};
AttachContactsTabView.prototype._searchButtonListener=function(e){
this.treeView.deselectAll();
var o=Dwt.byId(AttachContactsTabView.ELEMENT_ID_SEARCH_FIELD).value;
if(o==""){
return
}
var t=this._resetQuery(o);
this.executeQuery(t)
};
AttachContactsTabView.prototype._navBarListener=function(e){
var t=e.item.getData(ZmOperation.KEY_ID);
this._paginate(t==ZmOperation.PAGE_FORWARD)
};
AttachContactsTabView.prototype._paginate=function(e){
this.executeQuery(this._currentQuery,e)
};
AttachContactsTabView.prototype.showResultContents=function(n){
this._checkboxIdAndItemIdMap=[];
this._selectedItemIds={};
var t=[];
var e={};
if(n.response&&n.response.SearchResponse&&n.response.SearchResponse.cn){
e=n.response.SearchResponse;
t=e.cn
}
this._navTB.enable(ZmOperation.PAGE_BACK,e.offset>0);
this._navTB.enable(ZmOperation.PAGE_FORWARD,e.more);
var o=t.length;
if(o==0){
this._navTB.setText("")
}else{
this._navTB.setText((this._offset+1)+"-"+(this._offset+o))
}
this._setListView(t)
};
AttachContactsTabView.prototype._setListView=function(p){
var l=[];
var y=0;
if(p.length==0){
if(!this._noContactsFoundStr){
this._noContactsFoundStr=["<div padding=5px>",this.zimlet.getMessage("ACZ_NoContactsFound"),"</div>"].join("")
}
l[y++]=this._noContactsFoundStr
}else{
var d=[ZmContact.EMAIL_FIELDS,ZmContact.PHONE_FIELDS,ZmContact.IM_FIELDS];
var b=true;
for(var r=0;
r<p.length;
r++){
var w=p[r];
var m;
try{
m=ZmContact.createFromDom(w,{}
)
}
catch(f){
continue
}
if(!m){
continue
}
var h=(b)?"RowOdd AttachContactRow":"RowEven AttachContactRow";
b=!b;
var t=ZmContact.computeFileAs(m);
var u;
if(!m.isGroup()){
u=[];
for(var s=0;
s<d.length;
s++){
var n=this._getFirstWorkingAttr(m.getAttrs(),d[s]);
if(n){
u.push(n)
}}
var g="attachContactsZimlet_checkbox_"+w.id;
var o="attachContactsZimlet_row_"+w.id;
l[y++]="<div  class='";
l[y++]=h;
l[y++]="' id='";
l[y++]=o;
l[y++]="'>";
l[y++]="<table width=100%>";
l[y++]="<tr>";
l[y++]="<td width='1px'><div  id='";
l[y++]=g;
l[y++]="' class='ImgCheckboxUnchecked'></div></td>";
l[y++]="<td width='1px'>";
l[y++]=AjxImg.getImageHtml(m.getIcon());
l[y++]="</td>";
l[y++]="<td width='98%'><span style=\"font-weight:bold;\">";
l[y++]=AjxStringUtil.htmlEncode(t||ZmMsg.noName);
l[y++]="</span></td></tr>";
for(var s=0;
s<u.length;
s++){
l[y++]="<tr><td></td><td colspan=3>";
l[y++]=AjxStringUtil.htmlEncode(u[s]);
l[y++]="</td></tr>"
}
l[y++]="</table></div>"
}}}
Dwt.setInnerHtml(Dwt.byId(this._folderListId),l.join(""));
this._selectionChanged()
};
AttachContactsTabView.prototype._selectionChanged=function(){
if(this.isListenerRegistered(DwtEvent.SELECTION)){
var e=new DwtSelectionEvent(true);
e.button=DwtMouseEvent.LEFT;
e.target=this;
e.item=null;
e.detail=DwtListView.ITEM_SELECTED;
e.ersatz=true;
this.notifyListeners(DwtEvent.SELECTION,e)
}};
AttachContactsTabView.prototype._getFirstWorkingAttr=function(s,t){
var o=[];
if(AjxUtil.isArray(t)){
for(var n=0;
n<t.length;
n++){
var e=this._getFirstWorkingAttr(s,t[n]);
if(e){
return e
}}}else{
if(AjxUtil.isString(t)){
if(s[t]){
return s[t]
}}}};
AttachContactsTabView.prototype._handleKeys=function(t){
var e=DwtKeyEvent.getCharCode(t);
return !DwtKeyEvent.IS_RETURN[e]
};
AttachContactsTabView.prototype.gotAttachments=function(){
return false
};
AttachContactsTabView.prototype._getSelectedItems=function(){
var e=[];
for(var t in this._selectedItemIds){
if(this._selectedItemIds[t]){
e.push(t)
}}
return e
};
AttachContactsTabView.prototype.getSelectionCount=function(){
var t=0;
for(var e in this._selectedItemIds){
t+=this._selectedItemIds[e]
}
return t
};
AttachContactsTabView.prototype.uploadFiles=function(){
var e=appCtxt.getApp(ZmApp.MAIL).getComposeController(appCtxt.getApp(ZmApp.MAIL).getCurrentSessionId(ZmId.VIEW_COMPOSE));
this.zimlet.contactIdsToAttach=this._getSelectedItems();
this.zimlet._isDrafInitiatedByThisZimlet=true;
e.saveDraft(ZmComposeController.DRAFT_TYPE_AUTO,null,null,null,this.zimlet.contactIdsToAttach)
};
AttachContactsTabView.prototype.showAttachContactsTreeView=function(){
var e=new AjxCallback(this,this._showTreeView);
AjxPackage.undefine("zimbraMail.abook.controller.ZmAddrBookTreeController");
AjxPackage.require({
name:["ContactsCore","Contacts"],forceReload:true,callback:e}
)
};
AttachContactsTabView.prototype.reset=function(){
Dwt.byId(AttachContactsTabView.ELEMENT_ID_SEARCH_FIELD).value="";
var e=AttachContactsTabView.DEFAULT_CONTACTS_FOLDER;
this._currentQuery=this._getQueryFromFolder(e);
this.treeView.setSelected(e);
this._treeListener()
};
AttachContactsTabView.prototype._showTreeView=function(){
if(appCtxt.isChildWindow){
ZmOverviewController.CONTROLLER.ADDRBOOK="ZmAddrBookTreeController"
}
var o=appCtxt.getApp(ZmApp.CONTACTS);
o._createDeferredFolders();
var e=this.toString();
var t={
treeIds:["ADDRBOOK"],overviewId:(appCtxt.multiAccounts)?([e,this.prevAccount.name].join(":")):e,account:this.prevAccount};
this._setOverview(t);
this.setSize(Dwt.DEFAULT,"295");
this.reset()
};
AttachContactsTabView.prototype._setOverview=function(s){
var n=s.overviewId;
var r=appCtxt.getOverviewController();
var o=r.getOverview(n);
if(!o){
var e={
overviewId:n,overviewClass:"AttachContactsTabBox",headerClass:"DwtTreeItem",noTooltips:true,treeIds:s.treeIds};
o=r.createOverview(e);
o.account=this.prevAccount;
var t={};
t[ZmOrganizer.ID_DLS]=true;
o.set(s.treeIds,t)
}else{
if(s.account){
o.account=s.account
}}
this._overview=o;
Dwt.byId(this._folderTreeCellId).appendChild(o.getHtmlElement());
this.treeView=o.getTreeView("ADDRBOOK");
this.treeView.addSelectionListener(this._treeListener.bind(this));
this._hideRoot(this.treeView)
};
AttachContactsTabView.prototype._treeListener=function(){
var e=this.treeView.getSelected();
if(e){
var t=this._getQueryFromFolder(e.id);
this.executeQuery(t)
}};
AttachContactsTabView.prototype._hideRoot=function(t){
var o=t.getTreeItemById(ZmOrganizer.ID_ROOT);
if(!o){
var e=ZmOrganizer.getSystemId(ZmOrganizer.ID_ROOT,this.prevAccount);
o=t.getTreeItemById(e)
}
o.showCheckBox(false);
o.setExpanded(true);
o.setVisible(false,true)
};
AttachContactsTabView.prototype.setSize=function(n,e){
DwtTabViewPage.prototype.setSize.call(this,n,e);
var o=this.getSize();
var h=o.x*0.35;
var r=o.x-h;
var t=e-55;
this._overview.setSize(h,t);
var s=Dwt.byId(this._folderListId);
s.style.width=(r-5)+"px";
s.style.height=t+"px";
s.style.overflow="auto";
s.style.background="white";
return this
};
AttachContactsTabView.prototype.executeQuery=function(t,e){
if(this._limit==undefined){
this._limit=50
}
if(this._offset==undefined){
this._offset=0
}
if(e!=undefined){
if(e){
this._offset=this._offset+50
}else{
this._offset=this._offset-50
}}
var o=new AjxCallback(this,this.showResultContents);
this._searchContacts({
query:this._currentQuery,offset:this._offset,limit:this._limit,callback:o}
)
};
AttachContactsTabView.prototype._searchContacts=function(e){
var t={
SearchRequest:{
_jsns:"urn:zimbraMail"}};
t.SearchRequest.query=e.query+" not #type:group";
t.SearchRequest.types="contact";
t.SearchRequest.limit=e.limit;
t.SearchRequest.offset=e.offset;
t.SearchRequest.fetch="1";
e.response=appCtxt.getAppController().sendRequest({
jsonObj:t,noBusyOverlay:false}
);
this.showResultContents(e)
};
function Com_Zimbra_Url(){}
Com_Zimbra_Url.prototype=new ZmZimletBase();
Com_Zimbra_Url.prototype.constructor=Com_Zimbra_Url;
Com_Zimbra_Url.prototype.init=function(){
this._disablePreview=this.getBoolConfig("disablePreview",true);
this._youtubePreview=this.getBoolConfig("youtubePreview",true);
this._alexaId=this.getConfig("alexaThumbnailId");
if(this._alexaId){
this._alexaId=AjxStringUtil.trim(this._alexaId);
this._alexaKey=AjxStringUtil.trim(this.getConfig("alexaThumbnailKey"))
}
Com_Zimbra_Url.REGEXES=[];
var e=this.getConfig("ZIMLET_CONFIG_REGEX_VALUE");
if(e){
var t=new RegExp(e,"gi");
if(t){
Com_Zimbra_Url.REGEXES.push(t)
}}
if(/^\s*true\s*$/i.test(this.getConfig("supportUNC"))){
e=this.getConfig("ZIMLET_UNC_REGEX_VALUE");
var t=new RegExp(e,"gi");
if(t){
Com_Zimbra_Url.REGEXES.push(t)
}}};
Com_Zimbra_Url.THUMB_URL="http://images.websnapr.com/?url=";
Com_Zimbra_Url.THUMB_SIZE='width="200" height="150"';
Com_Zimbra_Url.IGNORE=AjxUtil.arrayAsHash([".",",",";","!","*",":","?",")","]","}"]);
Com_Zimbra_Url.prototype.match=function(u,h){
for(var n=0;
n<Com_Zimbra_Url.REGEXES.length;
n++){
var d=Com_Zimbra_Url.REGEXES[n];
d.lastIndex=h;
var t=d.exec(u);
if(!t){
continue
}
var e=t[0];
var l=e.charAt(e.length-1);
while(e.length&&Com_Zimbra_Url.IGNORE[l]){
if(l==")"){
var r=0;
var s=0;
for(var o in e){
if(e[o]=="("){
r++
}else{
if(e[o]==")"){
s++
}}}
if(r==s){
break
}}
e=e.substring(0,e.length-1);
l=e.charAt(e.length-1)
}
t[0]=e;
return t
}};
Com_Zimbra_Url.prototype._getHtmlContent=function(r,d,s,e){
var h=s.replace(/\"/g,'"').replace(/^\s+|\s+$/g,"");
if(h.substr(0,4)=="www."){
h="http://"+h
}
if(h.indexOf("\\\\")==0){
s.isUNC=true;
h="file://"+h
}
h=h.replace(/\\/g,"/");
var l="<a target='_blank' href='"+h;
if(h.split(/[\?#]/)[0]==(""+window.location).split(/[\?#]/)[0]){
var n=h.substr(h.indexOf("?"));
if(n){
var o=AjxStringUtil.parseQueryString(h);
if(o){
var t=o.app;
if(t&&t.length>0){
t=t.toUpperCase();
if(appCtxt.getApp(ZmApp[t])){
l="<a href='javascript:top.appCtxt.getAppController().activateApp(top.ZmApp."+t+", null, null);"
}}}}}
r[d++]=l;
r[d++]="'>";
r[d++]=AjxStringUtil.htmlEncode(s);
r[d++]="</a>";
return d
};
Com_Zimbra_Url.prototype.toolTipPoppedUp=function(n,s,o,t){
var e=s.replace(/^\s+|\s+$/g,"");
if(/^\s*true\s*$/i.test(this.getConfig("stripUrls"))){
e=e.replace(/[?#].*$/,"")
}
if(e.indexOf("\\\\")==0){
e="file:"+e
}
e=e.replace(/\\/g,"/");
if(this._disablePreview||e.indexOf("file://")==0){
this._showUrlThumbnail(e,t)
}else{
if(this._alexaId){
this._showAlexaThumbnail(e,t)
}else{
(new Image()).src=this.getResource("blank_pixel.gif");
this._showFreeThumbnail(e,t)
}}};
Com_Zimbra_Url.prototype.clicked=function(){
var e=DwtShell.getShell(window).getToolTip();
if(e){
e.popdown()
}
return true
};
Com_Zimbra_Url.prototype._showUrlThumbnail=function(t,e){
var o=AjxStringUtil.urlDecode(t);
if(o&&o!==""){
e.innerHTML="<b>"+ZmMsg.urlLabel+"</b> "+AjxStringUtil.htmlEncode(o)
}else{
if(o===""){
e.innerHTML="<b>"+ZmMsg.urlLabel+"</b> "+AjxStringUtil.htmlEncode(t)
}}};
Com_Zimbra_Url.prototype._showFreeThumbnail=function(t,e){
var n=[];
var o=0;
n[o++]="<img src='";
n[o++]=this.getResource("blank_pixel.gif");
n[o++]="' ";
n[o++]=Com_Zimbra_Url.THUMB_SIZE;
n[o++]=" style='background: url(";
n[o++]='"';
n[o++]=Com_Zimbra_Url.THUMB_URL;
n[o++]=t;
n[o++]='"';
n[o++]=")'/>";
e.innerHTML=n.join("")
};
Com_Zimbra_Url.ALEXA_THUMBNAIL_CACHE={};
Com_Zimbra_Url.ALEXA_CACHE_EXPIRES=10*60*1000;
Com_Zimbra_Url.prototype._showAlexaThumbnail=function(e,o){
o.innerHTML=["<table style='width: 200px; height: 150px; border-collapse: collapse' cellspacing='0' cellpadding='0'><tr><td align='center'>",ZmMsg.fetchingAlexaThumbnail,"</td></tr></table>"].join("");
var r=Com_Zimbra_Url.ALEXA_THUMBNAIL_CACHE[e];
if(r){
var f=new Date().getTime()-r.timestamp;
if(f<Com_Zimbra_Url.ALEXA_CACHE_EXPIRES){
var l=["<img src='",r.img,"' />"].join("");
o.firstChild.rows[0].cells[0].innerHTML=l;
return
}else{
delete Com_Zimbra_Url.ALEXA_THUMBNAIL_CACHE[e]
}}
var t=new Date(),s=Com_Zimbra_Url.zeroPad;
var d=s(t.getUTCFullYear(),4)+"-"+s(t.getUTCMonth()+1,2)+"-"+s(t.getUTCDate(),2)+"T"+s(t.getUTCHours(),2)+":"+s(t.getUTCMinutes(),2)+":"+s(t.getUTCSeconds(),2)+".000Z";
var n=this._computeAlexaSignature(d);
var u={
Service:"AlexaSiteThumbnail",Action:"Thumbnail",AWSAccessKeyId:this._alexaId,Timestamp:d,Signature:n,Size:"Large",Url:e};
var m=[];
for(var h in u){
m.push(h+"="+AjxStringUtil.urlComponentEncode(u[h]))
}
m="http://ast.amazonaws.com/xino/?"+m.join("&");
this.sendRequest(null,m,null,new AjxCallback(this,this._alexaDataIn,[o,e,m]),true)
};
Com_Zimbra_Url.prototype._computeAlexaSignature=function(e){
return AjxSHA1.b64_hmac_sha1(this._alexaKey,"AlexaSiteThumbnailThumbnail"+e)+"="
};
Com_Zimbra_Url.prototype._alexaDataIn=function(n,o,h,e){
var t=AjxXmlDoc.createFromDom(e.xml);
var r=t.toJSObject(true,false,true);
r=r.Response;
if(r.ResponseStatus.StatusCode=="Success"){
if(r.ThumbnailResult.Thumbnail.Exists=="true"){
var s=["<img src='",r.ThumbnailResult.Thumbnail,"' />"].join("");
n.firstChild.rows[0].cells[0].innerHTML=s;
Com_Zimbra_Url.ALEXA_THUMBNAIL_CACHE[o]={
img:r.ThumbnailResult.Thumbnail,timestamp:new Date().getTime()}
}else{
this._showFreeThumbnail(o,n)
}}else{
this._showFreeThumbnail(o,n)
}};
Com_Zimbra_Url.zeroPad=function(o,t){
var e=""+o;
while(e.length<t){
e="0"+e
}
return e
};
Com_Zimbra_Url.YOUTUBE_LINK_PATTERN1="youtube.com/watch?";
Com_Zimbra_Url.YOUTUBE_LINK_PATTERN2="youtube.com/v/";
Com_Zimbra_Url.YOUTUBE_LINK_PATTERN3="youtu.be/";
Com_Zimbra_Url.YOUTUBE_FEED="http://gdata.youtube.com/feeds/api/videos/@ID?alt=jsonc&v=2";
Com_Zimbra_Url.YOUTUBE_EMBED_URL="//www.youtube.com/embed/";
Com_Zimbra_Url.YOUTUBE_DEFAULT_THUMBNAIL="https://img.youtube.com/vi/@ID/default.jpg";
Com_Zimbra_Url.PROTOCOL=location.protocol;
Com_Zimbra_Url.YOUTUBE_MAX_VIDEOS=5;
Com_Zimbra_Url.prototype._getYouTubeFeed=function(r,o,t){
for(var n in o){
var e=Com_Zimbra_Url.YOUTUBE_FEED;
e=e.replace("@ID",n);
e=ZmZimletBase.PROXY+AjxStringUtil.urlComponentEncode(e);
var s={
url:e,callback:this._parseYouTubeFeed.bind(this,n,r,o,t)};
AjxLoader.load(s)
}};
Com_Zimbra_Url.prototype._parseYouTubeFeed=function(youTubeId,msgElId,youTubeHash,youTubeCtrl,req){
if(req.status!=200){
var thumbnail=Com_Zimbra_Url.YOUTUBE_DEFAULT_THUMBNAIL.replace("@ID",youTubeId);
var title=""
}else{
var json=eval("("+req.responseText+")");
var thumbnail=json.data.thumbnail.sqDefault;
var title=json.data.title
}
youTubeHash[youTubeId]={
thumbnail:thumbnail,title:title};
this._buildYouTubeImageHtml(youTubeId,msgElId,youTubeHash,youTubeCtrl)
};
Com_Zimbra_Url.prototype.getYouTubeId=function(o){
var n=null;
var t=o.indexOf(Com_Zimbra_Url.YOUTUBE_LINK_PATTERN1);
if(t!=-1){
var e=AjxStringUtil.parseQueryString(o);
if(e&&e.v){
n=e.v
}}else{
t=o.indexOf(Com_Zimbra_Url.YOUTUBE_LINK_PATTERN2);
if(t!=-1){
n=AjxStringUtil.trim(o.substring(t+Com_Zimbra_Url.YOUTUBE_LINK_PATTERN2.length))
}else{
t=o.indexOf(Com_Zimbra_Url.YOUTUBE_LINK_PATTERN3);
if(t!=-1){
n=AjxStringUtil.trim(o.substring(t+Com_Zimbra_Url.YOUTUBE_LINK_PATTERN3.length))
}}}
return n
};
Com_Zimbra_Url.prototype._showYouTubeVideo=function(n,r,t){
var s=document.getElementById(this._getVidDivId(r));
if(!s){
return
}
var e=document.getElementById(this._getVidIframeId(r));
var o;
if(!Dwt.getVisible(s)){
s.innerHTML=this._getYouTubeEmbed(n,r);
Dwt.setVisible(s,true);
o=true
}else{
if(e&&e.src===this._getVidEmbedUrl(n)){
Dwt.setVisible(s,false);
s.innerHTML="";
o=false
}else{
s.innerHTML=this._getYouTubeEmbed(n,r);
o=true
}}
this._setYouTubeOpacity(n,r,t,o)
};
Com_Zimbra_Url.prototype._getYouTubeEmbed=function(e,o){
var t=this._getVidIframeId(o);
return'<br/><iframe id="'+t+'" class="youtube-player" type="text/html"width="640" height="385"src="'+this._getVidEmbedUrl(e)+'" frameborder="0"></iframe>'
};
Com_Zimbra_Url.prototype._getVidEmbedUrl=function(e){
return Com_Zimbra_Url.PROTOCOL+Com_Zimbra_Url.YOUTUBE_EMBED_URL+e+"?autoplay=1&rel=0"
};
Com_Zimbra_Url.prototype._showYouTubeThumbnail=function(t,e){
return"<div class='thumb-wrapper'><div class='play'></div><img src='"+e[t].thumbnail+"' border='2'></div>"
};
Com_Zimbra_Url.prototype._getAllYouTubeLinks=function(r){
var t={
links:{}
,reachedMax:false};
if(!r){
return t
}
var s=r.match(/(\b(((http | https)\:\/\/)?(www\.)?((youtube\.com\/watch\?v=)|(youtube\.com\/watch\?.*\&v=)|(youtube\.com\/v\/)|(youtu\.be\/))((-)?[0-9a-zA-Z_-]+)?(&\w+=\w+)*)\b)/gi);
var n={};
if(!s){
return t
}
var o=false;
for(var e=0;
e<s.length;
e++){
if(e===Com_Zimbra_Url.YOUTUBE_MAX_VIDEOS){
o=true;
break
}
var h=this.getYouTubeId(s[e]);
if(!n.hasOwnProperty(h)){
n[h]=s[e]
}}
return{
links:n,reachedMax:o}
};
Com_Zimbra_Url.prototype._buildYouTubeImageHtml=function(r,l,n,t){
if(!r){
return
}
var o=this._showYouTubeThumbnail(r,n);
var s=document.createElement("div");
s.className="youTubeImagePreview";
s.innerHTML=o;
s.id=this._getThumbSpanId(r,l);
t.getHtmlElement().appendChild(s);
t.setData(s.id,{
youTubeId:r}
);
var h=this._getVidsContainer(l);
var e=document.getElementById(this._getVidDivId(l));
if(h&&e){
h.insertBefore(t.getHtmlElement(),e);
Dwt.setVisible(h,true)
}};
Com_Zimbra_Url.prototype._onYouTubeClickListener=function(t,o){
if(!o||!o.target||!o.target.parentNode||!o.target.parentNode.parentNode){
return
}
var e=o.target.parentNode.parentNode.id.split("$");
var n=e[1];
var s=e[2];
if(n&&s){
this._showYouTubeVideo(n,s,t)
}};
Com_Zimbra_Url.prototype._onYouTubeMouseOver=function(e){
if(e&&e.target&&e.target.tagName.toLowerCase()=="img"){
e.target.style.border="2px solid white"
}};
Com_Zimbra_Url.prototype._onYouTubeMouseOut=function(e){
if(e&&e.target&&e.target.tagName.toLowerCase()=="img"){
e.target.style.border="2px solid"
}};
Com_Zimbra_Url.prototype._getVidsContainerId=function(e){
return["YOUTUBE",e].join("$")
};
Com_Zimbra_Url.prototype._getVidsContainer=function(e){
return document.getElementById(this._getVidsContainerId(e))
};
Com_Zimbra_Url.prototype._getThumbSpanId=function(e,t){
return["YOUTUBE",e,t].join("$")
};
Com_Zimbra_Url.prototype._getThumbSpan=function(e,t){
return document.getElementById(this._getThumbSpanId(e,t))
};
Com_Zimbra_Url.prototype._getVidDivId=function(e){
return["YOUTUBE-VID",e].join("$")
};
Com_Zimbra_Url.prototype._getVidIframeId=function(e){
return["YOUTUBE-IFRAME",e].join("$")
};
Com_Zimbra_Url.prototype._setYouTubeOpacity=function(o,s,e,t){
for(var n in e){
img=this._getThumbSpan(n,s);
img=img&&img.firstChild;
if(!img){
continue
}
if(t&&n===o){
img.style.opacity=0.4
}else{
img.style.opacity=""
}}};
Com_Zimbra_Url.prototype.onMsgView=function(o,e,t){
this.renderYouTube(o,t)
};
Com_Zimbra_Url.prototype.renderYouTube=function(o,r){
if(!this._youtubePreview||appCtxt.isChildWindow){
return
}
var p=r&&r.getContent();
var l=this._getAllYouTubeLinks(p);
var m=l.links;
var h=l.reachedMax;
if(!AjxUtil.arraySize(m)){
return
}
var t=r._htmlElId;
var n=document.getElementById(t);
if(!n){
return
}
var e=document.createElement("DIV");
e.className="video-panel";
e.id=this._getVidsContainerId(t);
e.style.display="none";
var d=h?this.getMessage("youTubeTitleMax").replace("{0}",Com_Zimbra_Url.YOUTUBE_MAX_VIDEOS):this.getMessage("youTubeTitle");
e.innerHTML="<h3 class='user_font_"+appCtxt.get(ZmSetting.FONT_NAME)+"'>"+d+"</h3>";
var f=document.createElement("div");
f.style.padding="5px";
n.appendChild(f);
n.appendChild(e);
var u=document.createElement("div");
u.id=this._getVidDivId(t);
u.style.display="none";
u.className="movie-player";
e.appendChild(u);
var s=new DwtControl({
parent:appCtxt.getShell()}
);
s.addListener(DwtEvent.ONMOUSEDOWN,this._onYouTubeClickListener.bind(this,m));
s.addListener(DwtEvent.ONMOUSEOVER,this._onYouTubeMouseOver.bind(this));
s.addListener(DwtEvent.ONMOUSEOUT,this._onYouTubeMouseOut.bind(this));
s.reparentHtmlElement(u);
this._getYouTubeFeed(t,m,s)
};
Com_Zimbra_Url.CALENDAR_URL_EXTENSION="ics";
Com_Zimbra_Url.prototype.getActionMenu=function(n,t,e){
var o=AjxStringUtil.parseURL(n),r=o.fileName,s=r?r.substring(r.lastIndexOf(".")+1):"";
if(!appCtxt.get(ZmApp.SETTING[ZmId.APP_CALENDAR])||s!=Com_Zimbra_Url.CALENDAR_URL_EXTENSION){
return false
}
if(this._zimletContext._contentActionMenu instanceof AjxCallback){
this._zimletContext._contentActionMenu=this._zimletContext._contentActionMenu.run()
}
Com_Zimbra_Url._actionObject=n;
Com_Zimbra_Url._actionSpan=t;
Com_Zimbra_Url._actionContext=e;
return this._zimletContext._contentActionMenu
};
Com_Zimbra_Url.prototype.menuItemSelected=function(t,e){
switch(t){
case"NEWCAL":this._newCalListener(e);
break;
case"GOTOURL":this._goToUrlListener();
break
}};
Com_Zimbra_Url.prototype._goToUrlListener=function(){
window.open(Com_Zimbra_Url._actionObject,"_blank")
};
Com_Zimbra_Url.prototype.getMainWindow=function(e){
return appCtxt.isChildWindow?window.opener:window
};
Com_Zimbra_Url.prototype._newCalListener=function(o){
AjxDispatcher.require(["CalendarCore","Calendar"]);
var e=appCtxt.getOverviewController();
var s=e.getTreeController(ZmOrganizer.CALENDAR);
var n={
url:Com_Zimbra_Url._actionObject};
s._newListener(o);
var t=appCtxt.getNewCalendarDialog();
t.setICalData(n)
};
Com_Zimbra_Date=function(e){
if(arguments.length==1){
this._generateRegex(e)
}};
Com_Zimbra_Date.prototype=new ZmZimletBase();
Com_Zimbra_Date.prototype.constructor=Com_Zimbra_Date;
Com_Zimbra_Date.prototype.TYPE=ZmObjectManager.DATE;
Com_Zimbra_Date.validate=function(e,n,t){
if(e<1||e>31){
return false
}
if(n<0||n>11){
return false
}
if((n==3||n==5||n==8||n==10)&&e==31){
return false
}
if(t&&n==1){
var o=(t%4==0&&(t%100!=0||t%400==0));
if(e>29||(e==29&&!o)){
return false
}}
return true
};
Com_Zimbra_Date.prototype.getCurrentDate=function(e){
var t=this[ZmObjectManager.ATTR_CURRENT_DATE];
return t?t:new Date()
};
Com_Zimbra_Date.prototype.init=function(){
Com_Zimbra_Date.prototype._zimletContext=this._zimletContext;
Com_Zimbra_Date.prototype._className="Object";
this._initDateObjectHandlers()
};
Com_Zimbra_Date.prototype.getActionMenu=function(o,t,e){
if(this._zimletContext._contentActionMenu instanceof AjxCallback){
this._zimletContext._contentActionMenu=this._zimletContext._contentActionMenu.run()
}
Com_Zimbra_Date._actionObject=o;
Com_Zimbra_Date._actionSpan=t;
Com_Zimbra_Date._actionContext=e;
return this._zimletContext._contentActionMenu
};
Com_Zimbra_Date.prototype.menuItemSelected=function(e){
switch(e){
case"DAYVIEW":this.showDayView(Com_Zimbra_Date._actionContext.date);
break;
case"NEWAPPT":this._newApptListener();
break;
case"SEARCHMAIL":this._searchMailListener();
break
}};
Com_Zimbra_Date.prototype.toolTipPoppedUp=function(n,s,o,t){
var r=this.getAppInMainWindow(ZmApp.CALENDAR);
if(!r){
return
}
var e=o?o.date:new Date();
if(!isNaN(e)){
t.innerHTML=r.getDateToolTip(e,true)
}};
Com_Zimbra_Date.prototype.getMainWindow=function(e){
return appCtxt.isChildWindow?window.opener:window
};
Com_Zimbra_Date.prototype.getAppInMainWindow=function(o){
var t=this.getMainWindow();
if(!t){
return null
}
var e=t.appCtxt;
if(!e){
return null
}
return e.getApp(o)
};
Com_Zimbra_Date.prototype.clicked=function(o,n,t,e){
this.showDayView(t.date)
};
Com_Zimbra_Date.prototype.showDayView=function(e){
var t=this.getAppInMainWindow(ZmApp.CALENDAR);
if(!t){
return
}
t.showDayView(e);
if(appCtxt.isChildWindow){
window.opener.focus()
}};
Com_Zimbra_Date.prototype.match=function(g,f){
if(!Com_Zimbra_Date.PATTERNS){
return null
}
var r,t,d,p,n,s;
for(s=0;
s<Com_Zimbra_Date.REGEXES.length;
s++){
p=Com_Zimbra_Date.REGEXES[s];
p.lastIndex=f;
n=p.exec(g);
if(n&&n[0]&&(!r||n[0].length>r[0].length)){
r=n;
d=Com_Zimbra_Date.RULES[s];
t=p.mapping;
break
}}
if(!r){
return null
}
try{
var h,u;
for(s in t){
h=t[s];
u=r[s];
d=d.replace(new RegExp("\\{"+h+"\\}","gi"),u)
}
var o=new Date(this.getCurrentDate().getTime());
r.context={
rule:d,date:AjxDateUtil.calculate(d,o),monthOnly:0,valid:true};
return r
}
catch(l){
if(window.console&&window.console.log){
console.log(l)
}
return null
}};
Com_Zimbra_Date.prototype._initDateObjectHandlers=function(){
if(!appCtxt.get(ZmSetting.CALENDAR_ENABLED)){
return
}
Com_Zimbra_Date.MAPPINGS={
datenum:"(3[0-1]|0[1-9]|[1-2][0-9]|[1-9])",dayname:"("+AjxDateUtil.S_DAYNAME+")",weekord:"("+AjxDateUtil.S_WEEKORD+")",monthnum:"(0[1-9]|[1-9]|1[0-2])",monthname:"("+AjxDateUtil.S_MONTHNAME+")",yearnum:"(\\d{2}|[1-9]\\d{2,3})",fullyearnum:"(\\d{4})",number:"(\\d+)",timenum:"(1[0-2]:?[0-5][0-9]|[1-9]:?[0-5][0-9]|1[0-2]|[1-9])",militarytimenum:"(2[0-3]:?[0-5][0-9]|[0-1][0-9]:?[0-5][0-9])"};
Com_Zimbra_Date.PATTERNS=[];
Com_Zimbra_Date.RULES=[];
Com_Zimbra_Date.REGEXES=[];
var n,r;
for(n=1;
r=this.getMessage("format"+n+".pattern");
n++){
if(r.match(/^\?\?\?+/)){
break
}
if(r.match(/^###+/)){
break
}
if(r.match(/^#/)){
continue
}
Com_Zimbra_Date.PATTERNS.push(r);
Com_Zimbra_Date.RULES.push(this.getMessage("format"+n+".rule"))
}
for(n=0;
n<Com_Zimbra_Date.DEFAULT_FORMATS.length;
n++){
Com_Zimbra_Date.PATTERNS.push(Com_Zimbra_Date.DEFAULT_FORMATS[n]);
Com_Zimbra_Date.RULES.push(Com_Zimbra_Date.DEFAULT_FORMATS[++n])
}
var o=this.getMessage("boundaryTrue");
var h,s;
var e=this.getMessage("format.boundary")||o;
for(n=0;
n<Com_Zimbra_Date.PATTERNS.length;
n++){
r=Com_Zimbra_Date.PATTERNS[n];
r=r.replace(/\s+/g,"\\s+");
r=r.replace(/\(([^\)]+)\)/g,"(?:$1)");
Com_Zimbra_Date.__replaceKeyword_group=1;
Com_Zimbra_Date.__replaceKeyword_mapping={};
r=r.replace(/\{([a-z]+)\}/g,Com_Zimbra_Date.__replaceKeyword);
h=this.getMessage("format"+(n+1)+".boundary");
if((h!=""&&h==o)||e==o){
r="\\b"+r+"\\b"
}
var t=this.getMessage("format.caseSensitive")===o;
s=new RegExp(r,"g"+(!t?"i":""));
s.mapping=Com_Zimbra_Date.__replaceKeyword_mapping;
Com_Zimbra_Date.REGEXES.push(s)
}
ZmObjectManager.registerHandler(this,ZmObjectManager.DATE,this._zimletContext.priority)
};
Com_Zimbra_Date.prototype._newApptListener=function(){
var t=this.getMainWindow();
if(!t){
return
}
var e=new t.AjxCallback(this,this._handleLoadNewAppt);
t.AjxDispatcher.require(["CalendarCore","Calendar","CalendarAppt"],false,e,null,true)
};
Com_Zimbra_Date.prototype._handleLoadNewAppt=function(){
var e=this.getMainWindow();
if(!e){
return null
}
e.appCtxt.getAppViewMgr().popView(true,ZmId.VIEW_LOADING);
e.AjxDispatcher.run("GetCalController").newAppointmentHelper(Com_Zimbra_Date._actionContext.date);
if(appCtxt.isChildWindow){
window.opener.focus()
}};
Com_Zimbra_Date.prototype._searchMailListener=function(){
var e=this.getMainWindow(ZmApp.CALENDAR);
if(!e){
return
}
e.appCtxt.getSearchController().dateSearch(Com_Zimbra_Date._actionContext.date);
if(appCtxt.isChildWindow){
window.opener.focus()
}};
Com_Zimbra_Date.__replaceKeyword_mapping=null;
Com_Zimbra_Date.__replaceKeyword_group=-1;
Com_Zimbra_Date.__replaceKeyword=function(e,t){
var n=Com_Zimbra_Date.MAPPINGS;
t=t.toLowerCase();
if(!n[t]){
return e
}
var o=Com_Zimbra_Date.__replaceKeyword_mapping;
var s=Com_Zimbra_Date.__replaceKeyword_group++;
o[s++]=t;
return n[t]
};
Com_Zimbra_Date.DEFAULT_FORMATS=["Dante Mateo Comfort","2011-03-01T17:26:00Z","Brooke Ellen Henrikson","2009-10-17T10:20:00Z","Nicholas Mateo Damon","2008-07-18T17:35:00Z","Shyar Parag Shah","2008-07-16T04:51:00Z","Diego Isaac Comfort","2006-12-08T20:05:00Z","Nila Dharmaraj","2006-03-19T16:30:00Z","Nikhil Dharmaraj","2001-08-22T20:00:00Z"];
function Com_Zimbra_YMEmoticons(){
this.re=Com_Zimbra_YMEmoticons.REGEXP;
this.reCaseSensitive=Com_Zimbra_YMEmoticons.REGEXP_CASE_SENSITIVE;
this.hash=Com_Zimbra_YMEmoticons.SMILEYS;
this._isEnabled=true
}
Com_Zimbra_YMEmoticons.prototype=new ZmZimletBase;
Com_Zimbra_YMEmoticons.prototype.constructor=Com_Zimbra_YMEmoticons;
Com_Zimbra_YMEmoticons.prototype.init=function(){
var t;
for(var e in this.hash){
t=this.hash[e];
t.alt=this.getMessage(t.alt)
}};
Com_Zimbra_YMEmoticons.prototype.createComposeButton=function(t){
var o=t.parent;
var e=new YMEmoticonsPickerButton({
parent:t,className:"ZToolbarButton"}
,true);
e.dontStealFocus();
e.setToolTipContent(ZmMsg.emoticons);
e.setEmoticon(":)");
e.addSelectionListener(new AjxListener(this,this._composeToolbarSmileyListener,[o]))
};
Com_Zimbra_YMEmoticons.prototype.on_htmlEditor_createToolbar2=function(t,e){
this.createComposeButton(e)
};
Com_Zimbra_YMEmoticons.prototype.onFindMsgObjects=function(t,e){
if(!this.enableInMail){
this.enableInMail=Boolean(this.getUserProperty("yemoticons_enableInMail"))
}
if(t&&t.folderId==ZmOrganizer.ID_CHATS){
e.addHandler(this);
e.sortHandlers();
e.__hasSmileysHandler=true
}else{
if(!e.__hasSmileysHandler&&this._isEnabled&&this.enableInMail){
e.addHandler(this);
e.sortHandlers();
e.__hasSmileysHandler=true
}
if(e.__hasSmileysHandler&&(!this._isEnabled||!this.enableInMail)){
e.removeHandler(this);
e.sortHandlers();
e.__hasSmileysHandler=false
}}};
Com_Zimbra_YMEmoticons.prototype.match=function(t,n){
this.re.lastIndex=this.reCaseSensitive.lastIndex=n;
var e=this.re.exec(t)||this.reCaseSensitive.exec(t);
if(e){
e.context=this.hash[e[1].toLowerCase()];
var o=new Image();
o.src=e.context.src;
e.context.img=o
}
return e
};
Com_Zimbra_YMEmoticons.prototype.generateSpan=function(o,e,r,s,t){
var n=t.height/2;
if(AjxEnv.isIE){
n="0px"
}
o[e++]=["<span style='height:",t.height,";width:",t.width,";padding:",n,"px ",t.width,"px ",n,"px 0; background:url(",t.img.src,") no-repeat 0 50%;'",' title="',AjxStringUtil.xmlAttrEncode(t.text)," - ",AjxStringUtil.xmlAttrEncode(t.alt),'"','><span style="visibility:hidden">a</span></span>'].join("");
return e
};
Com_Zimbra_YMEmoticons.prototype._smileyListener=function(t,e){
this._composeToolbarSmileyListener(t.getEditor(),e)
};
Com_Zimbra_YMEmoticons.prototype._composeToolbarSmileyListener=function(e,o){
if(!e){
return
}
var t=o.item.getSelectedSmiley();
if(t){
e.insertText(t.text);
e.focus()
}};
Com_Zimbra_YMEmoticons.prototype.menuItemSelected=function(e){
switch(e){
case"YE_TEMP_DISABLE":this.temporarilyDisable();
break;
case"YE_PREFERENCES":this._showPreferenceDlg();
break
}};
Com_Zimbra_YMEmoticons.prototype.doubleClicked=function(){
this.singleClicked()
};
Com_Zimbra_YMEmoticons.prototype.singleClicked=function(){
this._showPreferenceDlg()
};
Com_Zimbra_YMEmoticons.prototype.temporarilyDisable=function(){
this._isEnabled=false;
var e=[ZmToast.FADE_IN,ZmToast.PAUSE,ZmToast.FADE_OUT];
appCtxt.getAppController().setStatusMsg(this.getMessage("yahoo_emoticons_toaster_temporarily_disabled"),ZmStatusView.LEVEL_INFO,null,e)
};
Com_Zimbra_YMEmoticons.prototype._showPreferenceDlg=function(){
if(this._preferenceDialog){
this._preferenceDialog.popup();
return
}
this._preferenceView=new DwtComposite(this.getShell());
this._preferenceView.getHtmlElement().style.overflow="auto";
this._preferenceView.getHtmlElement().innerHTML=this._createPrefView();
this._preferenceDialog=this._createDialog({
title:this.getMessage("yahoo_emoticons_pref_dialog_title"),view:this._preferenceView,standardButtons:[DwtDialog.OK_BUTTON],id:"YahooEmoticonsPrefs"}
);
this._preferenceDialog.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._okPreferenceBtnListener));
if(!this.enableInMail){
this.enableInMail=Boolean(this.getUserProperty("yemoticons_enableInMail"))
}
document.getElementById("yemoticons_enableInMail_div").checked=this.enableInMail;
this._preferenceDialog.popup()
};
Com_Zimbra_YMEmoticons.prototype._createPrefView=function(){
return["<div class='ymemoticonsPrefDialog'>","<input id='yemoticons_enableInMail_div' type='checkbox'/>",this.getMessage("enableInMail"),"</div>"].join("")
};
Com_Zimbra_YMEmoticons.prototype._okPreferenceBtnListener=function(){
this._preferenceDialog.popdown();
var t=document.getElementById("yemoticons_enableInMail_div").checked;
if(t!=this.enableInMail){
this.setUserProperty("yemoticons_enableInMail",t,true);
this.enableInMail=t;
var e=t?this.getMessage("yahoo_emoticons_toaster_enabled"):this.getMessage("yahoo_emoticons_toaster_disabled");
var o=[ZmToast.FADE_IN,ZmToast.PAUSE,ZmToast.FADE_OUT];
appCtxt.getAppController().setStatusMsg(e,ZmStatusView.LEVEL_INFO,null,o)
}};
Com_Zimbra_YMEmoticons.REGEXP=/(>:D<|#:-S|O:-\)|<:-P|:-SS|<\):\)|:-\?\?|3:-O|:\(\|\)|@};-|\*\*==|\(~~\)|\*-:\)|\[-O<|:\)>-|\\:D\x2f|\^:\)\^|;;\)|:-\x2f|:\x22>|:-\*|=\(\(|:-O|B-\)|:-S|>:\)|:\(\(|:\)\)|\x2f:\)|=\)\)|:-B|:-c|:\)\]|~X\(|:-h|:-t|8->|I-\)|8-\||L-\)|:-&|:-\$|\[-\(|:O\)|8-}|\(:\||=P~|:-\?|#-o|=D>|@-\)|:\^o|:-w|:-<|>:P|:o3|%-\(|:@\)|~:>|%%-|~O\)|8-X|=:\)|>-\)|:-L|\$-\)|:-\x22|b-\(|\[-X|>:\x2f|;\)\)|:-@|:-j|\(\*\)|o->|o=>|o-\+|\(%\)|:\)|:\(|;\)|X\(|:>|:\||=;)/ig;
Com_Zimbra_YMEmoticons.REGEXP_CASE_SENSITIVE=/(:D|:X|:P)/g;
Com_Zimbra_YMEmoticons.SMILEYS={
":)":{
width:18,alt:"emoticon_happy",src:"/service/zimlet/com_zimbra_ymemoticons/img/1.gif",text:":)",regexp:":\\)",height:18}
,":(":{
width:18,alt:"emoticon_sad",src:"/service/zimlet/com_zimbra_ymemoticons/img/2.gif",text:":(",regexp:":\\(",height:18}
,"(~~)":{
width:17,alt:"emoticon_pumpkin",src:"/service/zimlet/com_zimbra_ymemoticons/img/56.gif",text:"(~~)",regexp:"\\(~~\\)",height:18}
,"~o)":{
width:18,alt:"emoticon_coffee",src:"/service/zimlet/com_zimbra_ymemoticons/img/57.gif",text:"~O)",regexp:"~O\\)",height:18}
,':">':{
width:18,alt:"emoticon_blushing",src:"/service/zimlet/com_zimbra_ymemoticons/img/9.gif",text:':">',regexp:":\\x22>",height:18}
,"[-(":{
width:18,alt:"emoticon_not_talking",src:"/service/zimlet/com_zimbra_ymemoticons/img/33.gif",text:"[-(",regexp:"\\[-\\(",height:18}
,">:d<":{
width:42,alt:"emoticon_big_hug",src:"/service/zimlet/com_zimbra_ymemoticons/img/6.gif",text:">:D<",regexp:">:D<",height:18}
,"#-o":{
width:24,alt:"emoticon_d_oh",src:"/service/zimlet/com_zimbra_ymemoticons/img/40.gif",text:"#-o",regexp:"#-o",height:18}
,"[-x":{
width:22,alt:"emoticon_shame_on_you",src:"/service/zimlet/com_zimbra_ymemoticons/img/68.gif",text:"[-X",regexp:"\\[-X",height:18}
,":-t":{
width:30,alt:"emoticon_time_out",src:"/service/zimlet/com_zimbra_ymemoticons/img/104.gif",text:":-t",regexp:":-t",height:18}
,":(|)":{
width:21,alt:"emoticon_monkey",src:"/service/zimlet/com_zimbra_ymemoticons/img/51.gif",text:":(|)",regexp:":\\(\\|\\)",height:18}
,":o)":{
width:28,alt:"emoticon_clown",src:"/service/zimlet/com_zimbra_ymemoticons/img/34.gif",text:":O)",regexp:":O\\)",height:18}
,"i-)":{
width:21,alt:"emoticon_sleepy",src:"/service/zimlet/com_zimbra_ymemoticons/img/28.gif",text:"I-)",regexp:"I-\\)",height:18}
,";;)":{
width:18,alt:"emoticon_batting_eyelashes",src:"/service/zimlet/com_zimbra_ymemoticons/img/5.gif",text:";;)",regexp:";;\\)",height:18}
,":^o":{
width:18,alt:"emoticon_liar",src:"/service/zimlet/com_zimbra_ymemoticons/img/44.gif",text:":^o",regexp:":\\^o",height:18}
,"<:-p":{
width:38,alt:"emoticon_party",src:"/service/zimlet/com_zimbra_ymemoticons/img/36.gif",text:"<:-P",regexp:"<:-P",height:18}
,"x(":{
width:34,alt:"emoticon_angry",src:"/service/zimlet/com_zimbra_ymemoticons/img/14.gif",text:"X(",regexp:"X\\(",height:18}
,":-/":{
width:20,alt:"emoticon_confused",src:"/service/zimlet/com_zimbra_ymemoticons/img/7.gif",text:":-/",regexp:":-\\x2f",height:18}
,"#:-s":{
width:34,alt:"emoticon_whew",src:"/service/zimlet/com_zimbra_ymemoticons/img/18.gif",text:"#:-S",regexp:"#:-S",height:18}
,"8->":{
width:23,alt:"emoticon_daydreaming",src:"/service/zimlet/com_zimbra_ymemoticons/img/105.gif",text:"8->",regexp:"8->",height:18}
,":d":{
width:18,alt:"emoticon_big_grin",src:"/service/zimlet/com_zimbra_ymemoticons/img/4.gif",text:":D",regexp:":D",height:18}
,"\\:d/":{
width:26,alt:"emoticon_dancing",src:"/service/zimlet/com_zimbra_ymemoticons/img/69.gif",text:"\\:D/",regexp:"\\\\:D\\x2f",height:18}
,":-b":{
width:24,alt:"emoticon_nerd",src:"/service/zimlet/com_zimbra_ymemoticons/img/26.gif",text:":-B",regexp:":-B",height:18}
,":-@":{
width:36,alt:"emoticon_chatterbox",src:"/service/zimlet/com_zimbra_ymemoticons/img/76.gif",text:":-@",regexp:":-@",height:18}
,":-h":{
width:28,alt:"emoticon_wave",src:"/service/zimlet/com_zimbra_ymemoticons/img/103.gif",text:":-h",regexp:":-h",height:18}
,":-c":{
width:28,alt:"emoticon_call_me",src:"/service/zimlet/com_zimbra_ymemoticons/img/101.gif",text:":-c",regexp:":-c",height:18}
,"=p~":{
width:18,alt:"emoticon_drooling",src:"/service/zimlet/com_zimbra_ymemoticons/img/38.gif",text:"=P~",regexp:"=P~",height:18}
,"(:|":{
width:18,alt:"emoticon_yawn",src:"/service/zimlet/com_zimbra_ymemoticons/img/37.gif",text:"(:|",regexp:"\\(:\\|",height:18}
,":-o":{
width:18,alt:"emoticon_surprise",src:"/service/zimlet/com_zimbra_ymemoticons/img/13.gif",text:":-O",regexp:":-O",height:18}
,"o->":{
width:18,alt:"emoticon_hiro",src:"/service/zimlet/com_zimbra_ymemoticons/img/72.gif",text:"o->",regexp:"o->",height:18}
,":))":{
width:18,alt:"emoticon_laughing",src:"/service/zimlet/com_zimbra_ymemoticons/img/21.gif",text:":))",regexp:":\\)\\)",height:18}
,"/:)":{
width:18,alt:"emoticon_raised_eyebrow",src:"/service/zimlet/com_zimbra_ymemoticons/img/23.gif",text:"/:)",regexp:"\\x2f:\\)",height:18}
,"*-:)":{
width:30,alt:"emoticon_idea",src:"/service/zimlet/com_zimbra_ymemoticons/img/58.gif",text:"*-:)",regexp:"\\*-:\\)",height:18}
,":)]":{
width:31,alt:"emoticon_on_the_phone",src:"/service/zimlet/com_zimbra_ymemoticons/img/100.gif",text:":)]",regexp:":\\)\\]",height:18}
,":-ss":{
width:36,alt:"emoticon_nailbiting",src:"/service/zimlet/com_zimbra_ymemoticons/img/42.gif",text:":-SS",regexp:":-SS",height:18}
,"(%)":{
width:18,alt:"emoticon_yin_yang",src:"/service/zimlet/com_zimbra_ymemoticons/img/75.gif",text:"(%)",regexp:"\\(%\\)",height:18}
,":-*":{
width:18,alt:"emoticon_kiss",src:"/service/zimlet/com_zimbra_ymemoticons/img/11.gif",text:":-*",regexp:":-\\*",height:18}
,"~x(":{
width:44,alt:"emoticon_at_wits_end",src:"/service/zimlet/com_zimbra_ymemoticons/img/102.gif",text:"~X(",regexp:"~X\\(",height:18}
,"o=>":{
width:18,alt:"emoticon_billy",src:"/service/zimlet/com_zimbra_ymemoticons/img/73.gif",text:"o=>",regexp:"o=>",height:18}
,":-??":{
width:40,alt:"emoticon_I_dont_know",src:"/service/zimlet/com_zimbra_ymemoticons/img/106.gif",text:":-??",regexp:":-\\?\\?",height:18}
,"@-)":{
width:18,alt:"emoticon_hypnotized",src:"/service/zimlet/com_zimbra_ymemoticons/img/43.gif",text:"@-)",regexp:"@-\\)",height:18}
,"3:-o":{
width:18,alt:"emoticon_cow",src:"/service/zimlet/com_zimbra_ymemoticons/img/50.gif",text:"3:-O",regexp:"3:-O",height:18}
,"=d>":{
width:18,alt:"emoticon_applause",src:"/service/zimlet/com_zimbra_ymemoticons/img/41.gif",text:"=D>",regexp:"=D>",height:18}
,":-w":{
width:23,alt:"emoticon_waiting",src:"/service/zimlet/com_zimbra_ymemoticons/img/45.gif",text:":-w",regexp:":-w",height:18}
,":x":{
width:18,alt:"emoticon_love_struck",src:"/service/zimlet/com_zimbra_ymemoticons/img/8.gif",text:":x",regexp:":x",height:18}
,":-$":{
width:18,alt:"emoticon_dont_tell_anyone",src:"/service/zimlet/com_zimbra_ymemoticons/img/32.gif",text:":-$",regexp:":-\\$",height:18}
,"~:>":{
width:18,alt:"emoticon_chicken",src:"/service/zimlet/com_zimbra_ymemoticons/img/52.gif",text:"~:>",regexp:"~:>",height:18}
,"=:)":{
width:20,alt:"emoticon_bug",src:"/service/zimlet/com_zimbra_ymemoticons/img/60.gif",text:"=:)",regexp:"=:\\)",height:18}
,"(*)":{
width:18,alt:"emoticon_star",src:"/service/zimlet/com_zimbra_ymemoticons/img/79.gif",text:"(*)",regexp:"\\(\\*\\)",height:18}
,":|":{
width:18,alt:"emoticon_straight_face",src:"/service/zimlet/com_zimbra_ymemoticons/img/22.gif",text:":|",regexp:":\\|",height:18}
,":((":{
width:22,alt:"emoticon_crying",src:"/service/zimlet/com_zimbra_ymemoticons/img/20.gif",text:":((",regexp:":\\(\\(",height:18}
,"8-x":{
width:18,alt:"emoticon_skull",src:"/service/zimlet/com_zimbra_ymemoticons/img/59.gif",text:"8-X",regexp:"8-X",height:18}
,"o:-)":{
width:30,alt:"emoticon_angel",src:"/service/zimlet/com_zimbra_ymemoticons/img/25.gif",text:"O:-)",regexp:"O:-\\)",height:18}
,">:p":{
width:18,alt:"emoticon_phbbbbt",src:"/service/zimlet/com_zimbra_ymemoticons/img/47.gif",text:">:P",regexp:">:P",height:18}
,">-)":{
width:18,alt:"emoticon_alien",src:"/service/zimlet/com_zimbra_ymemoticons/img/61.gif",text:">-)",regexp:">-\\)",height:18}
,"=((":{
width:18,alt:"emoticon_broken_heart",src:"/service/zimlet/com_zimbra_ymemoticons/img/12.gif",text:"=((",regexp:"=\\(\\(",height:18}
,"l-)":{
width:24,alt:"emoticon_loser",src:"/service/zimlet/com_zimbra_ymemoticons/img/30.gif",text:"L-)",regexp:"L-\\)",height:18}
,":@)":{
width:18,alt:"emoticon_pig",src:"/service/zimlet/com_zimbra_ymemoticons/img/49.gif",text:":@)",regexp:":@\\)",height:18}
,">:/":{
width:23,alt:"emoticon_bring_it_on",src:"/service/zimlet/com_zimbra_ymemoticons/img/70.gif",text:">:/",regexp:">:\\x2f",height:18}
,"b-(":{
width:18,alt:"emoticon_feeling_beat_up",src:"/service/zimlet/com_zimbra_ymemoticons/img/66.gif",text:"b-(",regexp:"b-\\(",height:18}
,"$-)":{
width:18,alt:"emoticon_money_eyes",src:"/service/zimlet/com_zimbra_ymemoticons/img/64.gif",text:"$-)",regexp:"\\$-\\)",height:18}
,":-?":{
width:18,alt:"emoticon_thinking",src:"/service/zimlet/com_zimbra_ymemoticons/img/39.gif",text:":-?",regexp:":-\\?",height:18}
,":)>-":{
width:22,alt:"emoticon_peace_sign",src:"/service/zimlet/com_zimbra_ymemoticons/img/67.gif",text:":)>-",regexp:":\\)>-",height:18}
,":-j":{
width:26,alt:"emoticon_oh_go_on",src:"/service/zimlet/com_zimbra_ymemoticons/img/78.gif",text:":-j",regexp:":-j",height:18}
,"%%-":{
width:18,alt:"emoticon_good_luck",src:"/service/zimlet/com_zimbra_ymemoticons/img/54.gif",text:"%%-",regexp:"%%-",height:18}
,"%-(":{
width:52,alt:"emoticon_not_listening",src:"/service/zimlet/com_zimbra_ymemoticons/img/107.gif",text:"%-(",regexp:"%-\\(",height:18}
,":p":{
width:18,alt:"emoticon_tongue",src:"/service/zimlet/com_zimbra_ymemoticons/img/10.gif",text:":P",regexp:":P",height:18}
,"^:)^":{
width:32,alt:"emoticon_not_worthy",src:"/service/zimlet/com_zimbra_ymemoticons/img/77.gif",text:"^:)^",regexp:"\\^:\\)\\^",height:18}
,':-"':{
width:22,alt:"emoticon_whistling",src:"/service/zimlet/com_zimbra_ymemoticons/img/65.gif",text:':-"',regexp:":-\\x22",height:18}
,":-<":{
width:24,alt:"emoticon_sigh",src:"/service/zimlet/com_zimbra_ymemoticons/img/46.gif",text:":-<",regexp:":-<",height:18}
,":o3":{
width:31,alt:"emoticon_puppy_dog_eyes",src:"/service/zimlet/com_zimbra_ymemoticons/img/108.gif",text:":o3",regexp:":o3",height:18}
,">:)":{
width:18,alt:"emoticon_devil",src:"/service/zimlet/com_zimbra_ymemoticons/img/19.gif",text:">:)",regexp:">:\\)",height:18}
,"=;":{
width:18,alt:"emoticon_talk_to_the_hand",src:"/service/zimlet/com_zimbra_ymemoticons/img/27.gif",text:"=;",regexp:"=;",height:18}
,"8-|":{
width:18,alt:"emoticon_rolling_eyes",src:"/service/zimlet/com_zimbra_ymemoticons/img/29.gif",text:"8-|",regexp:"8-\\|",height:18}
,"**==":{
width:25,alt:"emoticon_flag",src:"/service/zimlet/com_zimbra_ymemoticons/img/55.gif",text:"**==",regexp:"\\*\\*==",height:18}
,"o-+":{
width:18,alt:"emoticon_april",src:"/service/zimlet/com_zimbra_ymemoticons/img/74.gif",text:"o-+",regexp:"o-+",height:18}
,"8-}":{
width:24,alt:"emoticon_silly",src:"/service/zimlet/com_zimbra_ymemoticons/img/35.gif",text:"8-}",regexp:"8-}",height:18}
,"=))":{
width:30,alt:"emoticon_rolling_on_the_floor",src:"/service/zimlet/com_zimbra_ymemoticons/img/24.gif",text:"=))",regexp:"=\\)\\)",height:18}
,":-l":{
width:18,alt:"emoticon_frustrated",src:"/service/zimlet/com_zimbra_ymemoticons/img/62.gif",text:":-L",regexp:":-L",height:18}
,"b-)":{
width:18,alt:"emoticon_cool",src:"/service/zimlet/com_zimbra_ymemoticons/img/16.gif",text:"B-)",regexp:"B-\\)",height:18}
,";)":{
width:18,alt:"emoticon_winking",src:"/service/zimlet/com_zimbra_ymemoticons/img/3.gif",text:";)",regexp:";\\)",height:18}
,":>":{
width:18,alt:"emoticon_smug",src:"/service/zimlet/com_zimbra_ymemoticons/img/15.gif",text:":>",regexp:":>",height:18}
,":-&":{
width:18,alt:"emoticon_sick",src:"/service/zimlet/com_zimbra_ymemoticons/img/31.gif",text:":-&",regexp:":-&",height:18}
,"<):)":{
width:18,alt:"emoticon_cowboy",src:"/service/zimlet/com_zimbra_ymemoticons/img/48.gif",text:"<):)",regexp:"<\\):\\)",height:18}
,":-s":{
width:18,alt:"emoticon_worried",src:"/service/zimlet/com_zimbra_ymemoticons/img/17.gif",text:":-S",regexp:":-S",height:18}
,";))":{
width:18,alt:"emoticon_hee_hee",src:"/service/zimlet/com_zimbra_ymemoticons/img/71.gif",text:";))",regexp:";\\)\\)",height:18}
,"[-o<":{
width:18,alt:"emoticon_praying",src:"/service/zimlet/com_zimbra_ymemoticons/img/63.gif",text:"[-O<",regexp:"\\[-O<",height:18}
,"@};-":{
width:18,alt:"emoticon_rose",src:"/service/zimlet/com_zimbra_ymemoticons/img/53.gif",text:"@};-",regexp:"@};-",height:18}};
YMEmoticonsPickerButton=function(t,e){
if(arguments.length==0){
return
}
t.actionTiming=DwtButton.ACTION_MOUSEUP;
DwtToolBarButton.call(this,t);
this.setEmoticon();
if(e&&e==true){
this.setMenu(new AjxCallback(this,this._createMenu),false,false,false)
}else{
this.setMenu(new AjxCallback(this,this._createMenu),false,false,true)
}};
YMEmoticonsPickerButton.prototype=new DwtToolBarButton;
YMEmoticonsPickerButton.prototype.constructor=YMEmoticonsPickerButton;
YMEmoticonsPickerButton.prototype._createMenu=function(){
var e=new DwtMenu({
parent:this,style:DwtMenu.GENERIC_WIDGET_STYLE}
);
this._picker=new YMEmoticonsPicker(e,null,null);
this._picker.addSelectionListener(new AjxListener(this,this._smileyPicked));
return e
};
YMEmoticonsPickerButton.prototype.setEmoticon=function(t){
var e=t?YMEmoticonsPicker.SMILEYS[t]:YMEmoticonsPicker.getDefaultSmiley();
if(e){
this._smileyButtonDiv.src=e.src;
this._smiley=e
}};
YMEmoticonsPickerButton.prototype._createHtmlFromTemplate=function(t,o){
DwtButton.prototype._createHtmlFromTemplate.call(this,t,o);
var n=Dwt.getNextId();
var e="<div unselectable><img width='18' src='' id='"+n+"_smiley'></div>";
this.setText(e);
this._smileyButtonDiv=document.getElementById(n+"_smiley");
delete n
};
YMEmoticonsPickerButton.prototype.getSmiley=function(e){
return this._picker.getSmiley(e)
};
YMEmoticonsPickerButton.prototype.getSelectedSmiley=function(){
return this._smiley
};
YMEmoticonsPickerButton.prototype._smileyPicked=function(e){
var o=e.detail;
this.setEmoticon(o);
if(this.isListenerRegistered(DwtEvent.SELECTION)){
var t=DwtShell.selectionEvent;
t.item=this;
this.notifyListeners(DwtEvent.SELECTION,t)
}};
YMEmoticonsPicker=function(o,t,e){
if(arguments.length==0){
return
}
t=t||"DwtColorPicker";
DwtControl.call(this,{
parent:o,className:t,posStyle:e}
);
this._createEmoticonsPicker(o)
};
YMEmoticonsPicker.prototype=new DwtControl;
YMEmoticonsPicker.prototype.constructor=YMEmoticonsPicker;
YMEmoticonsPicker.SMILEYS=Com_Zimbra_YMEmoticons.SMILEYS;
YMEmoticonsPicker.getDefaultSmiley=function(){
for(var e in YMEmoticonsPicker.SMILEYS){
return YMEmoticonsPicker.SMILEYS[e]
}
return null
};
YMEmoticonsPicker.prototype.getDefaultSmiley=YMEmoticonsPicker.getDefaultSmiley;
YMEmoticonsPicker.prototype._createEmoticonsPicker=function(e){
this._createEmoticonsTable();
this._registerHandlers()
};
YMEmoticonsPicker.prototype.addSelectionListener=function(e){
this.addListener(DwtEvent.SELECTION,e)
};
YMEmoticonsPicker.prototype.removeSelectionListener=function(e){
this.removeListener(DwtEvent.SELECTION,e)
};
YMEmoticonsPicker.prototype.dispose=function(){
if(this._disposed){
return
}
Dwt.disassociateElementFromObject(this.getHtmlElement().firstChild,this);
DwtControl.prototype.dispose.call(this)
};
YMEmoticonsPicker.prototype.getSmiley=function(e){
return YMEmoticonsPicker.SMILEYS[e]
};
YMEmoticonsPicker.EMOTICONS_PER_ROW=11;
YMEmoticonsPicker.prototype._createEmoticonsTable=function(){
var h=0;
var n=[];
var e=0;
var s=0;
var l=0;
var t=0;
var d=0;
for(var o in YMEmoticonsPicker.SMILEYS){
if(e!=0&&!(e%YMEmoticonsPicker.EMOTICONS_PER_ROW)){
n[h++]="</tr><tr>";
if(s>l){
l=s
}
s=0
}
t=YMEmoticonsPicker.SMILEYS[o].width;
d=YMEmoticonsPicker.SMILEYS[o].height;
n[h++]=['<td style=\'background-color:#FFFFFF;\' align="center" valign="middle" id=\'',o,"' >"].join("");
n[h++]=["<img  height='",d,"' width='",t,"' src='",YMEmoticonsPicker.SMILEYS[o].src,"'","  title='",YMEmoticonsPicker.SMILEYS[o].alt,"  ",YMEmoticonsPicker.SMILEYS[o].text,"'","  />"].join("");
n[h++]="</td>";
e++;
s=s+t
}
n[h++]="</table>";
var r=["<table  cellpadding='2' cellspacing='3' border='0' align='center' width='",l,"px'><tr>"].join("");
this.getHtmlElement().innerHTML=[r,n.join("")].join("");
if(AjxEnv.isFirefox1_5up&&!AjxEnv.isFirefox3up){
this.setSize("480px",Dwt.DEFAULT)
}};
YMEmoticonsPicker.prototype._registerHandlers=function(){
var r=this.getHtmlElement().firstChild;
Dwt.associateElementWithObject(r,this);
var h=r.rows;
var l=h.length;
for(var n=0;
n<l;
n++){
var o=h[n].cells;
var s=o.length;
for(var t=0;
t<s;
t++){
var e=o[t];
Dwt.setHandler(e,DwtEvent.ONMOUSEDOWN,YMEmoticonsPicker._mouseDownHdlr);
Dwt.setHandler(e,DwtEvent.ONMOUSEUP,YMEmoticonsPicker._mouseUpHdlr)
}}};
YMEmoticonsPicker._mouseDownHdlr=function(t){
var e=DwtShell.mouseEvent;
e.setFromDhtmlEvent(t,true);
var o=e.target;
if(o.nodeName.toLowerCase()=="img"){
o=o.parentNode
}
e.dwtObj._downTdId=o.id;
e._stopPropagation=true;
e._returnValue=false;
e.setToDhtmlEvent(t);
return false
};
YMEmoticonsPicker._mouseUpHdlr=function(o){
var t=DwtShell.mouseEvent;
t.setFromDhtmlEvent(o,true);
var r=t.dwtObj;
var s=t.target;
if(s.nodeName.toLowerCase()=="img"){
s=s.parentNode
}
if(r._downTdId==s.id){
var e=YMEmoticonsPicker.SMILEYS[s.id];
if(e){
if(r.isListenerRegistered(DwtEvent.SELECTION)){
var n=DwtShell.selectionEvent;
DwtUiEvent.copy(n,t);
n.item=r;
n.detail=s.id;
r.notifyListeners(DwtEvent.SELECTION,n)
}}
if(r.parent instanceof DwtMenu){
DwtMenu.closeActiveMenu()
}}
t._stopPropagation=true;
t._returnValue=false;
t.setToDhtmlEvent(o);
return false
};
function net_partage_zimletplus_HandlerObject(){}
net_partage_zimletplus_HandlerObject.prototype=new ZmZimletBase();
net_partage_zimletplus_HandlerObject.prototype.constructor=net_partage_zimletplus_HandlerObject;
var ZPPartage=net_partage_zimletplus_HandlerObject;
ZPPartage.prototype.init=function(){
this.POST_CONTENT_TYPE={
"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"};
this.tabApps=[];
this.defaultTabAppNames=[];
this.customTabAppNames=[];
this.renaterArray=[];
this.domainArray=[];
this.currentTabAppName=null;
this.username=appCtxt.get(ZmSetting.USERNAME);
this.getDefaultUrl();
this.setPropertyDialog()
};
ZPPartage.prototype.addTr=function(){
var s=document.getElementById("tEditUPS").getElementsByTagName("tbody")[0];
var o=s.insertRow(s.rows.length);
var n=o.insertCell(0);
var t=o.insertCell(1);
var e=document.createElement("input");
e.type="text";
n.appendChild(e);
var r=document.createElement("input");
r.type="text";
t.appendChild(r)
};
ZPPartage.prototype.urlIdentique=function(t,e){
return(this.completeUrl(t)==this.completeUrl(e))
};
ZPPartage.prototype.appActive=function(e,h){
if(this.customTabAppNames.indexOf(e)!=-1||this.defaultTabAppNames.indexOf(e)!=-1){
if(h){
skin._showEl("zb__NEW_MENU",false);
skin._showEl("skin_td_tree",false);
skin._showEl("z_sash",false);
if(this.defaultTabAppNames.indexOf(e)!=-1){
skin._showEl("skin_tr_toolbar",false)
}else{
skin._showEl("skin_td_new_button",false)
}
skin._reflowApp();
this.currentTabAppName=e;
var n=document.getElementById("tpersoApp_"+this.currentTabAppName.split("_")[3].toString());
if(n){
var s=n.src;
var o=this.tabApps[this.currentTabAppName][3];
var t=/.*\/$/;
if(!t.test(o)){
o=o+"/"
}
if(!this.urlIdentique(s,o)){
this.setMainContent()
}}}else{
skin._showEl("zb__NEW_MENU",true);
skin._showEl("skin_td_tree",true);
skin._showEl("z_sash",true);
if(this.defaultTabAppNames.indexOf(e)!=-1){
skin._showEl("skin_tr_toolbar",true)
}
skin._reflowApp()
}}};
ZPPartage.prototype.appLaunch=function(e){
if(this.defaultTabAppNames.indexOf(e)==-1){
this.setToolbarContent()
}
this.setMainContent()
};
ZPPartage.prototype.checkUrl=function(e){
var t=/((ftp|http|https):\/\/(www.)?(([a-zA-Z0-9-]){2,}\.){1,4}([a-zA-Z]){2,6}(\/([a-zA-Z-_\/\.0-9#:?=&;,]*)?)?)/;
return t.test(e)
};
ZPPartage.prototype.checkPageLoad=function(t){
var o=this.getResource("checkPageLoad.jsp");
var e="url="+AjxStringUtil.urlComponentEncode(t);
AjxRpc.invoke(e,o,this.POST_CONTENT_TYPE,new AjxCallback(this,this.checkPageLoadHandler),AjxRpcRequest.HTTP_POST)
};
ZPPartage.prototype.checkPageLoadHandler=function(o){
try{
var d=JSON.parse(o.text);
var l=appCtxt.getApp(this.currentTabAppName);
var h="tpersoApp_"+this.currentTabAppName.split("_")[3].toString();
var s=this.tabApps[this.currentTabAppName][3];
s=this.completeUrl(s);
var t=Math.floor(Math.random()*Math.floor(1000));
if(s.length>0){
if(d.valid){
l.setContent('<div class="TPersoContainer" id="TPersoContainer'+t+'"><iframe id="'+h+'"  src="'+s.toString()+'" width="100%" height="100%" style="border:0px;" border="0" allow="camera; microphone" /></iframe></div>')
}else{
var n=this.getMessage("pageCannotLoadInfo").replace("{0}",s.toString());
n=n.replace("{1}",d.message);
l.setContent('<div id="TPersoContainer'+t+'" class="divNoUrl">'+n+"</div>")
}}else{
l.setContent('<div id="TPersoContainer'+t+'" class="divNoUrl"><h1 style="margin:0">'+this.getMessage("noContentInfo1")+"</h1><p>"+this.getMessage("noContentInfo2")+"</p></div>")
}}
catch(r){}};
ZPPartage.prototype.completeUrl=function(e){
var o=e;
var t=/(ftp|http|https):\/\//;
if(!t.test(o)){
o="https://"+o
}
return o
};
ZPPartage.prototype.createCustomTabApps=function(){
var r=this.defaultTabAppNames.length;
var s=this.customTabAppNames.length;
var o=1;
while(this.getUserProperty("nom"+o)){
var h="nom"+o;
var n="url"+o;
if(o<=s){
appCtxt.getAppChooser().getButton(this.customTabAppNames[o-1]).setVisible(true);
appCtxt.getAppChooser().getButton(this.customTabAppNames[o-1]).setText(this.getUserProperty(h));
this.tabApps[this.customTabAppNames[o-1]]=[h,this.getUserProperty(h),n,this.getUserProperty(n)]
}else{
var e=this.createApp(this.getUserProperty(h),null,this.getMessage("TabAppDefine"));
this.customTabAppNames.push(e);
this.tabApps[e]=[h,this.getUserProperty(h),n,this.getUserProperty(n)]
}
o++
}
for(var t=o-1;
t<s;
t++){
appCtxt.getAppChooser().getButton(this.customTabAppNames[t]).setVisible(false)
}};
ZPPartage.prototype.createDefaultTabsApps=function(t){
if(t.length>0){
for(var e=0;
e<t.length;
e++){
var n=t[e];
if(n[0].length>0){
var o=this.createApp(n[0],null,this.getMessage("TabAppDefine"));
this.defaultTabAppNames.push(o);
this.tabApps[o]=["defaultName",n[0],"defaultUrl",n[1]]
}}}};
ZPPartage.prototype.doubleClicked=function(){
this.singleClicked()
};
ZPPartage.prototype.getDefaultUrl=function(){
var e=this.getResource("getZPDefaultUrl.jsp");
AjxRpc.invoke(null,e,this.POST_CONTENT_TYPE,new AjxCallback(this,this.getDefaultUrlHandler),AjxRpcRequest.HTTP_GET)
};
ZPPartage.prototype.getDefaultUrlHandler=function(u){
try{
var n=JSON.parse(u.text);
var h=n.RENATER;
var l=n.DOMAIN;
for(var r=0;
r<h.length;
r++){
var t=h[r].name;
var o=h[r].url;
this.renaterArray.push([t,o])
}
for(var s=0;
s<l.length;
s++){
var t=l[s].name;
var o=l[s].url;
this.domainArray.push([t,o])
}
this.createDefaultTabsApps(this.renaterArray);
this.createDefaultTabsApps(this.domainArray)
}
catch(d){
if(window&&window.console){
console.log(d)
}}
this.createCustomTabApps()
};
ZPPartage.prototype.singleClicked=function(){
if(this.EditUPDialog){
this.setUPSViewContent();
this.EditUPDialog.popup()
}};
ZPPartage.prototype.setPropertyDialog=function(){
this._editUPSView=new DwtComposite(this.getShell());
this._editUPSView.setSize("385","auto");
this._editUPSView.getHtmlElement().style.overflow="auto";
this.setUPSViewContent();
var e=new DwtDialog_ButtonDescriptor("ADDTR",(this.getMessage("addTrBtnName")),DwtDialog.ALIGN_RIGHT);
var t=new DwtDialog_ButtonDescriptor("VALIDUPS",(this.getMessage("validBtnName")),DwtDialog.ALIGN_RIGHT);
this.EditUPDialog=this._createDialog({
title:this.getMessage("editDialogTitle"),view:this._editUPSView,standardButtons:[DwtDialog.CANCEL_BUTTON],extraButtons:[e,t]}
);
this.EditUPDialog.setButtonListener("ADDTR",new AjxListener(this,this.addTr));
this.EditUPDialog.setButtonListener("VALIDUPS",new AjxListener(this,this.setUserProperties))
};
ZPPartage.prototype.setUPSViewContent=function(){
var n=0;
var t=1;
var o=new Array();
o[n++]="<p class='docInfo'>"+this.getMessage("docInfo1")+"</p>";
o[n++]="<p class='docInfo'>"+this.getMessage("docInfo2")+" <strong><a href='"+this.getResource("doc_renater_zimletplus.pdf")+"' target='_blank'>"+this.getMessage("docInfo4")+"</strong></a>.</p>";
o[n++]="<p class='docInfo'>"+this.getMessage("docInfo3")+" <strong><a href='"+this.getResource("doc_renater_zimletplus.pdf")+"' target='_blank'>"+this.getMessage("docInfo4")+"</strong>.</p>";
o[n++]='<table id="tEditUPS" class="tEditUPS" border="0"><tbody>';
o[n++]='<tr><th width="50%">'+this.getMessage("nameCTitle")+"</th><th colspan='2'>"+this.getMessage("urlCTitle")+"</th></tr>";
if(!this.getUserProperty("nom1")){
o[n++]='<tr><td><input type="text"></td><td colspan=\'2\'><input type="text"></td></tr>'
}
while(this.getUserProperty("nom"+t)){
o[n++]='<tr><td><input type="text" value="'+this.getUserProperty("nom"+t)+'"></td><td><input type="text" value="'+this.getUserProperty("url"+t)+'"></td><td><div class="divDeleteUrl"></div></td></tr>';
t++
}
o[n++]="</tbody></table>";
this._editUPSView.setContent(o.join(""));
deleteBtns=document.getElementsByClassName("divDeleteUrl");
for(var e=0;
e<deleteBtns.length;
e++){
deleteBtn=deleteBtns[e];
if(deleteBtn.addEventListener){
deleteBtn.addEventListener("click",function(){
ZPPartage.deleteUP(this)
}
,false)
}else{
if(deleteBtn.attachEvent){
deleteBtn.attachEvent("onclick",function(){
ZPPartage.deleteUP(this)
}
)
}}}};
ZPPartage.prototype.setUserProperties=function(){
var s=document.getElementById("tEditUPS").getElementsByTagName("tr");
var r=this.customTabAppNames.length;
for(var n=0;
n<s.length;
n++){
var h=s[n].getElementsByTagName("input");
if(h.length==0){
continue
}
var e=h[0].value;
var o=h[1].value;
this.setUserProperty("nom"+n,e,true);
this.setUserProperty("url"+n,o,true)
}
if((s.length-1)<r){
for(var t=s.length;
t<=r;
t++){
this.setUserProperty("nom"+t,"",true);
this.setUserProperty("url"+t,"",true)
}}
this.EditUPDialog.popdown();
this.createCustomTabApps()
};
ZPPartage.prototype.setMainContent=function(){
var e=this.tabApps[this.currentTabAppName][3];
e=this.completeUrl(e);
this.checkPageLoad(e)
};
ZPPartage.prototype.setToolbarContent=function(){
var t=appCtxt.getApp(this.currentTabAppName);
var e=t.getToolbar();
e.createButton("SHOWCHANGEURL",{
text:this.getMessage("CSBtnName")}
);
e.addSelectionListener("SHOWCHANGEURL",new AjxListener(this,this.showChangeDialog))
};
ZPPartage.prototype.setChangeDialog=function(){
var e=document.getElementById("tpersoUrl").value;
var t=/(ftp|http|https):\/\//;
if(!t.test(e)){
e="http://"+e
}
var n=this.checkUrl(e);
if(n){
var o=this.tabApps[this.currentTabAppName][2];
this.setUserProperty(o,e,true);
this.tabApps[this.currentTabAppName][3]=e;
this.setMainContent();
this.changeDialog.popdown();
return true
}else{
alert(this.getMessage("urlChangeErr"));
return false
}};
ZPPartage.prototype.showChangeDialog=function(){
var e=this.tabApps[this.currentTabAppName][3];
if(!this.changeDialog){
this._parentView=new DwtComposite(this.getShell());
this._parentView.setSize("350","100");
this._parentView.getHtmlElement().style.overflow="auto";
this._parentView.getHtmlElement().innerHTML="<p><strong>"+this.getMessage("newUrlName")+' : </strong><input type="text" name="tpersoUrl" id="tpersoUrl" value="'+e+'" style="width:250px" /></p><br/><p>'+this.getMessage("showChangeDialogInfo")+"</p>";
var t=new DwtDialog_ButtonDescriptor("CHANGEURL",(this.getMessage("okBtnName")),DwtDialog.ALIGN_RIGHT);
this.changeDialog=this._createDialog({
title:this.getMessage("CSBtnName"),view:this._parentView,standardButtons:[DwtDialog.CANCEL_BUTTON],extraButtons:[t]}
);
this.changeDialog.setButtonListener("CHANGEURL",new AjxListener(this,this.setChangeDialog))
}else{
document.getElementById("tpersoUrl").value=e
}
this.changeDialog.popup()
};
ZPPartage.deleteUP=function(e){
trElmToDelete=e.parentNode.parentNode;
trElmToDelete.parentNode.removeChild(trElmToDelete)
};
var Base64=(function(){
var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
var t={
encode:function(s){
var o="";
var f,u,l;
var m,d,h,r;
var n=0;
do{
f=s.charCodeAt(n++);
u=s.charCodeAt(n++);
l=s.charCodeAt(n++);
m=f>>2;
d=((f&3)<<4)|(u>>4);
h=((u&15)<<2)|(l>>6);
r=l&63;
if(isNaN(u)){
h=r=64
}else{
if(isNaN(l)){
r=64
}}
o=o+e.charAt(m)+e.charAt(d)+e.charAt(h)+e.charAt(r)
}
while(n<s.length);
return o
}
,decode:function(s){
var o="";
var f,u,l;
var m,d,h,r;
var n=0;
s=s.replace(/[^A-Za-z0-9\+\/\=]/g,"");
do{
m=e.indexOf(s.charAt(n++));
d=e.indexOf(s.charAt(n++));
h=e.indexOf(s.charAt(n++));
r=e.indexOf(s.charAt(n++));
f=(m<<2)|(d>>4);
u=((d&15)<<4)|(h>>2);
l=((h&3)<<6)|r;
o=o+String.fromCharCode(f);
if(h!=64){
o=o+String.fromCharCode(u)
}
if(r!=64){
o=o+String.fromCharCode(l)
}}
while(n<s.length);
return o
}};
return t
}
)();
var MD5=(function(){
var y=0;
var e="";
var f=8;
var u=function(v,z){
var q=(v&65535)+(z&65535);
var k=(v>>16)+(z>>16)+(q>>16);
return(k<<16)|(q&65535)
};
var g=function(v,k){
return(v<<k)|(v>>>(32-k))
};
var t=function(q){
var x=[];
var v=(1<<f)-1;
for(var k=0;
k<q.length*f;
k+=f){
x[k>>5]|=(q.charCodeAt(k/f)&v)<<(k%32)
}
return x
};
var h=function(x){
var q="";
var v=(1<<f)-1;
for(var k=0;
k<x.length*32;
k+=f){
q+=String.fromCharCode((x[k>>5]>>>(k%32))&v)
}
return q
};
var w=function(x){
var k=y?"0123456789ABCDEF":"0123456789abcdef";
var q="";
for(var v=0;
v<x.length*4;
v++){
q+=k.charAt((x[v>>2]>>((v%4)*8+4))&15)+k.charAt((x[v>>2]>>((v%4)*8))&15)
}
return q
};
var b=function(q){
var x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
var T="";
var z,v;
for(var k=0;
k<q.length*4;
k+=3){
z=(((q[k>>2]>>8*(k%4))&255)<<16)|(((q[k+1>>2]>>8*((k+1)%4))&255)<<8)|((q[k+2>>2]>>8*((k+2)%4))&255);
for(v=0;
v<4;
v++){
if(k*8+v*6>q.length*32){
T+=e
}else{
T+=x.charAt((z>>6*(3-v))&63)
}}}
return T
};
var n=function(A,z,k,v,O,T){
return u(g(u(u(z,A),u(v,T)),O),k)
};
var m=function(q,k,A,O,v,T,z){
return n((k&A)|((~k)&O),q,k,v,T,z)
};
var o=function(q,k,A,O,v,T,z){
return n((k&O)|(A&(~O)),q,k,v,T,z)
};
var p=function(q,k,A,O,v,T,z){
return n(k^A^O,q,k,v,T,z)
};
var d=function(q,k,A,O,v,T,z){
return n(A^(k|(~O)),q,k,v,T,z)
};
var r=function(D,O){
D[O>>5]|=128<<((O)%32);
D[(((O+64)>>>9)<<4)+14]=O;
var C=1732584193;
var B=-271733879;
var W=-1732584194;
var A=271733878;
var T,z,q,v;
for(var k=0;
k<D.length;
k+=16){
T=C;
z=B;
q=W;
v=A;
C=m(C,B,W,A,D[k+0],7,-680876936);
A=m(A,C,B,W,D[k+1],12,-389564586);
W=m(W,A,C,B,D[k+2],17,606105819);
B=m(B,W,A,C,D[k+3],22,-1044525330);
C=m(C,B,W,A,D[k+4],7,-176418897);
A=m(A,C,B,W,D[k+5],12,1200080426);
W=m(W,A,C,B,D[k+6],17,-1473231341);
B=m(B,W,A,C,D[k+7],22,-45705983);
C=m(C,B,W,A,D[k+8],7,1770035416);
A=m(A,C,B,W,D[k+9],12,-1958414417);
W=m(W,A,C,B,D[k+10],17,-42063);
B=m(B,W,A,C,D[k+11],22,-1990404162);
C=m(C,B,W,A,D[k+12],7,1804603682);
A=m(A,C,B,W,D[k+13],12,-40341101);
W=m(W,A,C,B,D[k+14],17,-1502002290);
B=m(B,W,A,C,D[k+15],22,1236535329);
C=o(C,B,W,A,D[k+1],5,-165796510);
A=o(A,C,B,W,D[k+6],9,-1069501632);
W=o(W,A,C,B,D[k+11],14,643717713);
B=o(B,W,A,C,D[k+0],20,-373897302);
C=o(C,B,W,A,D[k+5],5,-701558691);
A=o(A,C,B,W,D[k+10],9,38016083);
W=o(W,A,C,B,D[k+15],14,-660478335);
B=o(B,W,A,C,D[k+4],20,-405537848);
C=o(C,B,W,A,D[k+9],5,568446438);
A=o(A,C,B,W,D[k+14],9,-1019803690);
W=o(W,A,C,B,D[k+3],14,-187363961);
B=o(B,W,A,C,D[k+8],20,1163531501);
C=o(C,B,W,A,D[k+13],5,-1444681467);
A=o(A,C,B,W,D[k+2],9,-51403784);
W=o(W,A,C,B,D[k+7],14,1735328473);
B=o(B,W,A,C,D[k+12],20,-1926607734);
C=p(C,B,W,A,D[k+5],4,-378558);
A=p(A,C,B,W,D[k+8],11,-2022574463);
W=p(W,A,C,B,D[k+11],16,1839030562);
B=p(B,W,A,C,D[k+14],23,-35309556);
C=p(C,B,W,A,D[k+1],4,-1530992060);
A=p(A,C,B,W,D[k+4],11,1272893353);
W=p(W,A,C,B,D[k+7],16,-155497632);
B=p(B,W,A,C,D[k+10],23,-1094730640);
C=p(C,B,W,A,D[k+13],4,681279174);
A=p(A,C,B,W,D[k+0],11,-358537222);
W=p(W,A,C,B,D[k+3],16,-722521979);
B=p(B,W,A,C,D[k+6],23,76029189);
C=p(C,B,W,A,D[k+9],4,-640364487);
A=p(A,C,B,W,D[k+12],11,-421815835);
W=p(W,A,C,B,D[k+15],16,530742520);
B=p(B,W,A,C,D[k+2],23,-995338651);
C=d(C,B,W,A,D[k+0],6,-198630844);
A=d(A,C,B,W,D[k+7],10,1126891415);
W=d(W,A,C,B,D[k+14],15,-1416354905);
B=d(B,W,A,C,D[k+5],21,-57434055);
C=d(C,B,W,A,D[k+12],6,1700485571);
A=d(A,C,B,W,D[k+3],10,-1894986606);
W=d(W,A,C,B,D[k+10],15,-1051523);
B=d(B,W,A,C,D[k+1],21,-2054922799);
C=d(C,B,W,A,D[k+8],6,1873313359);
A=d(A,C,B,W,D[k+15],10,-30611744);
W=d(W,A,C,B,D[k+6],15,-1560198380);
B=d(B,W,A,C,D[k+13],21,1309151649);
C=d(C,B,W,A,D[k+4],6,-145523070);
A=d(A,C,B,W,D[k+11],10,-1120210379);
W=d(W,A,C,B,D[k+2],15,718787259);
B=d(B,W,A,C,D[k+9],21,-343485551);
C=u(C,T);
B=u(B,z);
W=u(W,q);
A=u(A,v)
}
return[C,B,W,A]
};
var s=function(x,T){
var z=t(x);
if(z.length>16){
z=r(z,x.length*f)
}
var v=new Array(16),q=new Array(16);
for(var k=0;
k<16;
k++){
v[k]=z[k]^909522486;
q[k]=z[k]^1549556828
}
var O=r(v.concat(t(T)),512+T.length*f);
return r(q.concat(O),512+128)
};
var l={
hexdigest:function(v){
return w(r(t(v),v.length*f))
}
,b64digest:function(v){
return b(r(t(v),v.length*f))
}
,hash:function(v){
return h(r(t(v),v.length*f))
}
,hmac_hexdigest:function(v,k){
return w(s(v,k))
}
,hmac_b64digest:function(v,k){
return b(s(v,k))
}
,hmac_hash:function(v,k){
return h(s(v,k))
}
,test:function(){
return MD5.hexdigest("abc")==="900150983cd24fb0d6963f7d28e17f72"
}};
return l
}
)();
if(!Function.prototype.bind){
Function.prototype.bind=function(s){
var n=this;
var o=Array.prototype.slice;
var t=Array.prototype.concat;
var e=o.call(arguments,1);
return function(){
return n.apply(s?s:this,t.call(e,o.call(arguments,0)))
}
}
}
(function(r){
var s;
function o(l,h){
return new s.Builder(l,h)
}
function e(h){
return new s.Builder("message",h)
}
function n(h){
return new s.Builder("iq",h)
}
function t(h){
return new s.Builder("presence",h)
}
s={
VERSION:"1.0.2",NS:{
HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas"}
,addNamespace:function(h,l){
s.NS[h]=l
}
,Status:{
ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8}
,LogLevel:{
DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4}
,ElementType:{
NORMAL:1,TEXT:3,CDATA:4}
,TIMEOUT:1.1,SECONDARY_TIMEOUT:0.1,forEachChild:function(u,m,d){
var l,h;
for(l=0;
l<u.childNodes.length;
l++){
h=u.childNodes[l];
if(h.nodeType==s.ElementType.NORMAL&&(!m||this.isTagEqual(h,m))){
d(h)
}}}
,isTagEqual:function(l,h){
return l.tagName.toLowerCase()==h.toLowerCase()
}
,_xmlGenerator:null,_makeGenerator:function(){
var h;
if(document.implementation.createDocument===undefined){
h=this._getIEXmlDom();
h.appendChild(h.createElement("strophe"))
}else{
h=document.implementation.createDocument("jabber:client","strophe",null)
}
return h
}
,xmlGenerator:function(){
if(!s._xmlGenerator){
s._xmlGenerator=s._makeGenerator()
}
return s._xmlGenerator
}
,_getIEXmlDom:function(){
var l=null;
var m=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"];
for(var u=0;
u<m.length;
u++){
if(l===null){
try{
l=new ActiveXObject(m[u])
}
catch(h){
l=null
}}else{
break
}}
return l
}
,xmlElement:function(d){
if(!d){
return null
}
var m=s.xmlGenerator().createElement(d);
var h,u,l;
for(h=1;
h<arguments.length;
h++){
if(!arguments[h]){
continue
}
if(typeof(arguments[h])=="string"||typeof(arguments[h])=="number"){
m.appendChild(s.xmlTextNode(arguments[h]))
}else{
if(typeof(arguments[h])=="object"&&typeof(arguments[h].sort)=="function"){
for(u=0;
u<arguments[h].length;
u++){
if(typeof(arguments[h][u])=="object"&&typeof(arguments[h][u].sort)=="function"){
m.setAttribute(arguments[h][u][0],arguments[h][u][1])
}}}else{
if(typeof(arguments[h])=="object"){
for(l in arguments[h]){
if(arguments[h].hasOwnProperty(l)){
m.setAttribute(l,arguments[h][l])
}}}}}}
return m
}
,xmlescape:function(h){
h=h.replace(/\&/g,"&amp;");
h=h.replace(/</g,"&lt;");
h=h.replace(/>/g,"&gt;");
h=h.replace(/'/g,"&apos;");
h=h.replace(/"/g,"&quot;");
return h
}
,xmlTextNode:function(h){
h=s.xmlescape(h);
return s.xmlGenerator().createTextNode(h)
}
,getText:function(l){
if(!l){
return null
}
var d="";
if(l.childNodes.length===0&&l.nodeType==s.ElementType.TEXT){
d+=l.nodeValue
}
for(var h=0;
h<l.childNodes.length;
h++){
if(l.childNodes[h].nodeType==s.ElementType.TEXT){
d+=l.childNodes[h].nodeValue
}}
return d
}
,copyElement:function(d){
var h,l;
if(d.nodeType==s.ElementType.NORMAL){
l=s.xmlElement(d.tagName);
for(h=0;
h<d.attributes.length;
h++){
l.setAttribute(d.attributes[h].nodeName.toLowerCase(),d.attributes[h].value)
}
for(h=0;
h<d.childNodes.length;
h++){
l.appendChild(s.copyElement(d.childNodes[h]))
}}else{
if(d.nodeType==s.ElementType.TEXT){
l=s.xmlGenerator().createTextNode(d.nodeValue)
}}
return l
}
,escapeNode:function(h){
return h.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")
}
,unescapeNode:function(h){
return h.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")
}
,getNodeFromJid:function(h){
if(h.indexOf("@")<0){
return null
}
return h.split("@")[0]
}
,getDomainFromJid:function(h){
var l=s.getBareJidFromJid(h);
if(l.indexOf("@")<0){
return l
}else{
var d=l.split("@");
d.splice(0,1);
return d.join("@")
}}
,getResourceFromJid:function(h){
var l=h.split("/");
if(l.length<2){
return null
}
l.splice(0,1);
return l.join("/")
}
,getBareJidFromJid:function(h){
return h?h.split("/")[0]:null
}
,log:function(l,h){
return
}
,debug:function(h){
this.log(this.LogLevel.DEBUG,h)
}
,info:function(h){
this.log(this.LogLevel.INFO,h)
}
,warn:function(h){
this.log(this.LogLevel.WARN,h)
}
,error:function(h){
this.log(this.LogLevel.ERROR,h)
}
,fatal:function(h){
this.log(this.LogLevel.FATAL,h)
}
,serialize:function(d){
var h;
if(!d){
return null
}
if(typeof(d.tree)==="function"){
d=d.tree()
}
var m=d.nodeName;
var l,u;
if(d.getAttribute("_realname")){
m=d.getAttribute("_realname")
}
h="<"+m;
for(l=0;
l<d.attributes.length;
l++){
if(d.attributes[l].nodeName!="_realname"){
h+=" "+d.attributes[l].nodeName.toLowerCase()+"='"+d.attributes[l].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/</g,"&lt;")+"'"
}}
if(d.childNodes.length>0){
h+=">";
for(l=0;
l<d.childNodes.length;
l++){
u=d.childNodes[l];
switch(u.nodeType){
case s.ElementType.NORMAL:h+=s.serialize(u);
break;
case s.ElementType.TEXT:h+=u.nodeValue;
break;
case s.ElementType.CDATA:h+="<![CDATA["+u.nodeValue+"]]>"
}}
h+="</"+m+">"
}else{
h+="/>"
}
return h
}
,_requestId:0,_connectionPlugins:{}
,addConnectionPlugin:function(h,l){
s._connectionPlugins[h]=l
}};
s.Builder=function(l,h){
if(l=="presence"||l=="message"||l=="iq"){
if(h&&!h.xmlns){
h.xmlns=s.NS.CLIENT
}else{
if(!h){
h={
xmlns:s.NS.CLIENT}
}}}
this.nodeTree=s.xmlElement(l,h);
this.node=this.nodeTree
};
s.Builder.prototype={
tree:function(){
return this.nodeTree
}
,toString:function(){
return s.serialize(this.nodeTree)
}
,up:function(){
this.node=this.node.parentNode;
return this
}
,attrs:function(l){
for(var h in l){
if(l.hasOwnProperty(h)){
this.node.setAttribute(h,l[h])
}}
return this
}
,c:function(l,h,d){
var u=s.xmlElement(l,h,d);
this.node.appendChild(u);
if(!d){
this.node=u
}
return this
}
,cnode:function(d){
var m=s.xmlGenerator();
try{
var l=(m.importNode!==undefined)
}
catch(u){
var l=false
}
var h=l?m.importNode(d,true):s.copyElement(d);
this.node.appendChild(h);
this.node=h;
return this
}
,t:function(h){
var l=s.xmlTextNode(h);
this.node.appendChild(l);
return this
}};
s.Handler=function(m,u,l,d,p,f,h){
this.handler=m;
this.ns=u;
this.name=l;
this.type=d;
this.id=p;
this.options=h||{
matchbare:false};
if(!this.options.matchBare){
this.options.matchBare=false
}
if(this.options.matchBare){
this.from=f?s.getBareJidFromJid(f):null
}else{
this.from=f
}
this.user=true
};
s.Handler.prototype={
isMatch:function(l){
var u;
var d=null;
if(this.options.matchBare){
d=s.getBareJidFromJid(l.getAttribute("from"))
}else{
d=l.getAttribute("from")
}
u=false;
if(!this.ns){
u=true
}else{
var h=this;
s.forEachChild(l,null,function(m){
if(m.getAttribute("xmlns")==h.ns){
u=true
}}
);
u=u||l.getAttribute("xmlns")==this.ns
}
if(u&&(!this.name||s.isTagEqual(l,this.name))&&(!this.type||l.getAttribute("type")==this.type)&&(!this.id||l.getAttribute("id")==this.id)&&(!this.from||d==this.from)){
return true
}
return false
}
,run:function(l){
var h=null;
try{
h=this.handler(l)
}
catch(d){
if(d.sourceURL){
s.fatal("error: "+this.handler+" "+d.sourceURL+":"+d.line+" - "+d.name+": "+d.message)
}else{
if(d.fileName){
if(typeof(console)!="undefined"){
console.trace();
console.error(this.handler," - error - ",d,d.message)
}
s.fatal("error: "+this.handler+" "+d.fileName+":"+d.lineNumber+" - "+d.name+": "+d.message)
}else{
s.fatal("error: "+this.handler)
}}
throw d
}
return h
}
,toString:function(){
return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"
}};
s.TimedHandler=function(l,h){
this.period=l;
this.handler=h;
this.lastCalled=new Date().getTime();
this.user=true
};
s.TimedHandler.prototype={
run:function(){
this.lastCalled=new Date().getTime();
return this.handler()
}
,reset:function(){
this.lastCalled=new Date().getTime()
}
,toString:function(){
return"{TimedHandler: "+this.handler+"("+this.period+")}"
}};
s.Request=function(d,l,h,u){
this.id=++s._requestId;
this.xmlData=d;
this.data=s.serialize(d);
this.origFunc=l;
this.func=l;
this.rid=h;
this.date=NaN;
this.sends=u||0;
this.abort=false;
this.dead=null;
this.age=function(){
if(!this.date){
return 0
}
var m=new Date();
return(m-this.date)/1000
};
this.timeDead=function(){
if(!this.dead){
return 0
}
var m=new Date();
return(m-this.dead)/1000
};
this.xhr=this._newXHR()
};
s.Request.prototype={
getResponse:function(){
var h=null;
if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){
h=this.xhr.responseXML.documentElement;
if(h.tagName=="parsererror"){
s.error("invalid response received");
s.error("responseText: "+this.xhr.responseText);
s.error("responseXML: "+s.serialize(this.xhr.responseXML));
throw"parsererror"
}}else{
if(this.xhr.responseText){
s.error("invalid response received");
s.error("responseText: "+this.xhr.responseText);
s.error("responseXML: "+s.serialize(this.xhr.responseXML))
}}
return h
}
,_newXHR:function(){
var h=null;
if(window.XMLHttpRequest){
h=new XMLHttpRequest();
if(h.overrideMimeType){
h.overrideMimeType("text/xml")
}}else{
if(window.ActiveXObject){
h=new ActiveXObject("Microsoft.XMLHTTP")
}}
h.onreadystatechange=this.func.bind(null,this);
return h
}};
s.Connection=function(h){
this.service=h;
this.jid="";
this.rid=Math.floor(Math.random()*4294967295);
this.sid=null;
this.streamId=null;
this.features=null;
this.do_session=false;
this.do_bind=false;
this.timedHandlers=[];
this.handlers=[];
this.removeTimeds=[];
this.removeHandlers=[];
this.addTimeds=[];
this.addHandlers=[];
this._idleTimeout=null;
this._disconnectTimeout=null;
this.authenticated=false;
this.disconnecting=false;
this.connected=false;
this.errors=0;
this.paused=false;
this.hold=1;
this.wait=60;
this.window=5;
this._data=[];
this._requests=[];
this._uniqueId=Math.round(Math.random()*10000);
this._sasl_success_handler=null;
this._sasl_failure_handler=null;
this._sasl_challenge_handler=null;
this._idleTimeout=setTimeout(this._onIdle.bind(this),100);
for(var l in s._connectionPlugins){
if(s._connectionPlugins.hasOwnProperty(l)){
var u=s._connectionPlugins[l];
var d=function(){};
d.prototype=u;
this[l]=new d();
this[l].init(this)
}}};
s.Connection.prototype={
reset:function(){
this.rid=Math.floor(Math.random()*4294967295);
this.sid=null;
this.streamId=null;
this.do_session=false;
this.do_bind=false;
this.timedHandlers=[];
this.handlers=[];
this.removeTimeds=[];
this.removeHandlers=[];
this.addTimeds=[];
this.addHandlers=[];
this.authenticated=false;
this.disconnecting=false;
this.connected=false;
this.errors=0;
this._requests=[];
this._uniqueId=Math.round(Math.random()*10000)
}
,pause:function(){
this.paused=true
}
,resume:function(){
this.paused=false
}
,getUniqueId:function(h){
if(typeof(h)=="string"||typeof(h)=="number"){
return ++this._uniqueId+":"+h
}else{
return ++this._uniqueId+""
}}
,connect:function(l,d,f,m,u){
this.jid=l;
this.pass=d;
this.connect_callback=f;
this.disconnecting=false;
this.connected=false;
this.authenticated=false;
this.errors=0;
this.wait=m||this.wait;
this.hold=u||this.hold;
this.domain=s.getDomainFromJid(this.jid);
var h=this._buildBody().attrs({
to:this.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":s.NS.BOSH}
);
this._changeConnectStatus(s.Status.CONNECTING,null);
this._requests.push(new s.Request(h.tree(),this._onRequestStateChange.bind(this,this._connect_cb.bind(this)),h.tree().getAttribute("rid")));
this._throttledRequestHandler()
}
,attach:function(d,h,u,p,f,m,l){
this.jid=d;
this.sid=h;
this.rid=u;
this.connect_callback=p;
this.domain=s.getDomainFromJid(this.jid);
this.authenticated=true;
this.connected=true;
this.wait=f||this.wait;
this.hold=m||this.hold;
this.window=l||this.window;
this._changeConnectStatus(s.Status.ATTACHED,null)
}
,xmlInput:function(h){
return
}
,xmlOutput:function(h){
return
}
,rawInput:function(h){
return
}
,rawOutput:function(h){
return
}
,send:function(l){
if(l===null){
return
}
if(typeof(l.sort)==="function"){
for(var h=0;
h<l.length;
h++){
this._queueData(l[h])
}}else{
if(typeof(l.tree)==="function"){
this._queueData(l.tree())
}else{
this._queueData(l)
}}
this._throttledRequestHandler();
clearTimeout(this._idleTimeout);
this._idleTimeout=setTimeout(this._onIdle.bind(this),100)
}
,flush:function(){
clearTimeout(this._idleTimeout);
this._onIdle()
}
,sendIQ:function(u,g,h,m){
var f=null;
var d=this;
if(typeof(u.tree)==="function"){
u=u.tree()
}
var p=u.getAttribute("id");
if(!p){
p=this.getUniqueId("sendIQ");
u.setAttribute("id",p)
}
var l=this.addHandler(function(b){
if(f){
d.deleteTimedHandler(f)
}
var y=b.getAttribute("type");
if(y=="result"){
if(g){
g(b)
}}else{
if(y=="error"){
if(h){
h(b)
}}else{
throw {
name:"StropheError",message:"Got bad IQ type of "+y}
}}}
,null,"iq",null,p);
if(m){
f=this.addTimedHandler(m,function(){
d.deleteHandler(l);
if(h){
h(null)
}
return false
}
)
}
this.send(u);
return p
}
,_queueData:function(h){
if(h===null||!h.tagName||!h.childNodes){
throw {
name:"StropheError",message:"Cannot queue non-DOMElement."}
}
this._data.push(h)
}
,_sendRestart:function(){
this._data.push("restart");
this._throttledRequestHandler();
clearTimeout(this._idleTimeout);
this._idleTimeout=setTimeout(this._onIdle.bind(this),100)
}
,addTimedHandler:function(d,l){
var h=new s.TimedHandler(d,l);
this.addTimeds.push(h);
return h
}
,deleteTimedHandler:function(h){
this.removeTimeds.push(h)
}
,addHandler:function(f,m,d,u,g,p,l){
var h=new s.Handler(f,m,d,u,g,p,l);
this.addHandlers.push(h);
return h
}
,deleteHandler:function(h){
this.removeHandlers.push(h)
}
,disconnect:function(h){
this._changeConnectStatus(s.Status.DISCONNECTING,h);
s.info("Disconnect was called because: "+h);
if(this.connected){
this._disconnectTimeout=this._addSysTimedHandler(3000,this._onDisconnectTimeout.bind(this));
this._sendTerminate()
}}
,_changeConnectStatus:function(h,f){
for(var l in s._connectionPlugins){
if(s._connectionPlugins.hasOwnProperty(l)){
var u=this[l];
if(u.statusChanged){
try{
u.statusChanged(h,f)
}
catch(d){
s.error(""+l+" plugin caused an exception changing status: "+d)
}}}}
if(this.connect_callback){
try{
this.connect_callback(h,f)
}
catch(m){
s.error("User connection callback caused an exception: "+m)
}}}
,_buildBody:function(){
var h=o("body",{
rid:this.rid++,xmlns:s.NS.HTTPBIND}
);
if(this.sid!==null){
h.attrs({
sid:this.sid}
)
}
return h
}
,_removeRequest:function(l){
s.debug("removing request");
var h;
for(h=this._requests.length-1;
h>=0;
h--){
if(l==this._requests[h]){
this._requests.splice(h,1)
}}
l.xhr.onreadystatechange=function(){};
this._throttledRequestHandler()
}
,_restartRequest:function(h){
var l=this._requests[h];
if(l.dead===null){
l.dead=new Date()
}
this._processRequest(h)
}
,_processRequest:function(d){
var g=this._requests[d];
var w=-1;
try{
if(g.xhr.readyState==4){
w=g.xhr.status
}}
catch(f){
s.error("caught an error in _requests["+d+"], reqStatus: "+w)
}
if(typeof(w)=="undefined"){
w=-1
}
if(g.sends>5){
this._onDisconnectTimeout();
return
}
var l=g.age();
var h=(!isNaN(l)&&l>Math.floor(s.TIMEOUT*this.wait));
var u=(g.dead!==null&&g.timeDead()>Math.floor(s.SECONDARY_TIMEOUT*this.wait));
var b=(g.xhr.readyState==4&&(w<1||w>=500));
if(h||u||b){
if(u){
s.error("Request "+this._requests[d].id+" timed out (secondary), restarting")
}
g.abort=true;
g.xhr.abort();
g.xhr.onreadystatechange=function(){};
this._requests[d]=new s.Request(g.xmlData,g.origFunc,g.rid,g.sends);
g=this._requests[d]
}
if(g.xhr.readyState===0){
s.debug("request id "+g.id+"."+g.sends+" posting");
try{
g.xhr.open("POST",this.service,true)
}
catch(p){
s.error("XHR open failed.");
if(!this.connected){
this._changeConnectStatus(s.Status.CONNFAIL,"bad-service")
}
this.disconnect();
return
}
var y=function(){
g.date=new Date();
g.xhr.send(g.data)
};
if(g.sends>1){
var m=Math.min(Math.floor(s.TIMEOUT*this.wait),Math.pow(g.sends,3))*1000;
setTimeout(y,m)
}else{
y()
}
g.sends++;
if(this.xmlOutput!==s.Connection.prototype.xmlOutput){
this.xmlOutput(g.xmlData)
}
if(this.rawOutput!==s.Connection.prototype.rawOutput){
this.rawOutput(g.data)
}}else{
s.debug("_processRequest: "+(d===0?"first":"second")+" request has readyState of "+g.xhr.readyState)
}}
,_throttledRequestHandler:function(){
if(!this._requests){
s.debug("_throttledRequestHandler called with undefined requests")
}else{
s.debug("_throttledRequestHandler called with "+this._requests.length+" requests")
}
if(!this._requests||this._requests.length===0){
return
}
if(this._requests.length>0){
this._processRequest(0)
}
if(this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window){
this._processRequest(1)
}}
,_onRequestStateChange:function(u,d){
s.debug("request id "+d.id+"."+d.sends+" state changed to "+d.xhr.readyState);
if(d.abort){
d.abort=false;
return
}
var l;
if(d.xhr.readyState==4){
l=0;
try{
l=d.xhr.status
}
catch(m){}
if(typeof(l)=="undefined"){
l=0
}
if(this.disconnecting){
if(l>=400){
this._hitError(l);
return
}}
var h=(this._requests[0]==d);
var f=(this._requests[1]==d);
if((l>0&&l<500)||d.sends>5){
this._removeRequest(d);
s.debug("request id "+d.id+" should now be removed")
}
if(l==200){
if(f||(h&&this._requests.length>0&&this._requests[0].age()>Math.floor(s.SECONDARY_TIMEOUT*this.wait))){
this._restartRequest(0)
}
s.debug("request id "+d.id+"."+d.sends+" got 200");
u(d);
this.errors=0
}else{
s.error("request id "+d.id+"."+d.sends+" error "+l+" happened");
if(l===0||(l>=400&&l<600)||l>=12000){
this._hitError(l);
if(l>=400&&l<500){
this._changeConnectStatus(s.Status.DISCONNECTING,null);
this._doDisconnect()
}}}
if(!((l>0&&l<500)||d.sends>5)){
this._throttledRequestHandler()
}}}
,_hitError:function(h){
this.errors++;
s.warn("request errored, status: "+h+", number of errors: "+this.errors);
if(this.errors>4){
this._onDisconnectTimeout()
}}
,_doDisconnect:function(){
s.info("_doDisconnect was called");
this.authenticated=false;
this.disconnecting=false;
this.sid=null;
this.streamId=null;
this.rid=Math.floor(Math.random()*4294967295);
if(this.connected){
this._changeConnectStatus(s.Status.DISCONNECTED,null);
this.connected=false
}
this.handlers=[];
this.timedHandlers=[];
this.removeTimeds=[];
this.removeHandlers=[];
this.addTimeds=[];
this.addHandlers=[]
}
,_dataRecv:function(y){
try{
var h=y.getResponse()
}
catch(p){
if(p!="parsererror"){
throw p
}
this.disconnect("strophe-parsererror")
}
if(h===null){
return
}
if(this.xmlInput!==s.Connection.prototype.xmlInput){
this.xmlInput(h)
}
if(this.rawInput!==s.Connection.prototype.rawInput){
this.rawInput(s.serialize(h))
}
var m,d;
while(this.removeHandlers.length>0){
d=this.removeHandlers.pop();
if(!Array.prototype.indexOf){
this.handlers.myIndexOf=function(w){
var b=this.length;
var v=Number(arguments[1])||0;
v=(v<0)?Math.ceil(v):Math.floor(v);
if(v<0){
v+=b
}
for(;
v<b;
v++){
if(v in this&&this[v]===w){
return v
}}
return -1
};
m=this.handlers.myIndexOf(d)
}else{
m=this.handlers.indexOf(d)
}
if(m>=0){
this.handlers.splice(m,1)
}}
while(this.addHandlers.length>0){
this.handlers.push(this.addHandlers.pop())
}
if(this.disconnecting&&this._requests.length===0){
this.deleteTimedHandler(this._disconnectTimeout);
this._disconnectTimeout=null;
this._doDisconnect();
return
}
var l=h.getAttribute("type");
var g,u;
if(l!==null&&l=="terminate"){
if(this.disconnecting){
return
}
g=h.getAttribute("condition");
u=h.getElementsByTagName("conflict");
if(g!==null){
if(g=="remote-stream-error"&&u.length>0){
g="conflict"
}
this._changeConnectStatus(s.Status.CONNFAIL,g)
}else{
this._changeConnectStatus(s.Status.CONNFAIL,"unknown")
}
this.disconnect();
return
}
var f=this;
s.forEachChild(h,null,function(x){
var w,v;
v=f.handlers;
f.handlers=[];
for(w=0;
w<v.length;
w++){
var b=v[w];
try{
if(b.isMatch(x)&&(f.authenticated||!b.user)){
if(b.run(x)){
f.handlers.push(b)
}}else{
f.handlers.push(b)
}}
catch(k){}}}
)
}
,_sendTerminate:function(){
s.info("_sendTerminate was called");
var h=this._buildBody().attrs({
type:"terminate"}
);
if(this.authenticated){
h.c("presence",{
xmlns:s.NS.CLIENT,type:"unavailable"}
)
}
this.disconnecting=true;
var l=new s.Request(h.tree(),this._onRequestStateChange.bind(this,this._dataRecv.bind(this)),h.tree().getAttribute("rid"));
this._requests.push(l);
this._throttledRequestHandler()
}
,_connect_cb:function(q){
s.info("_connect_cb was called");
this.connected=true;
var l=q.getResponse();
if(!l){
return
}
if(this.xmlInput!==s.Connection.prototype.xmlInput){
this.xmlInput(l)
}
if(this.rawInput!==s.Connection.prototype.rawInput){
this.rawInput(s.serialize(l))
}
var f=l.getAttribute("type");
var x,g;
if(f!==null&&f=="terminate"){
x=l.getAttribute("condition");
g=l.getElementsByTagName("conflict");
if(x!==null){
if(x=="remote-stream-error"&&g.length>0){
x="conflict"
}
this._changeConnectStatus(s.Status.CONNFAIL,x)
}else{
this._changeConnectStatus(s.Status.CONNFAIL,"unknown")
}
return
}
if(!this.sid){
this.sid=l.getAttribute("sid")
}
if(!this.stream_id){
this.stream_id=l.getAttribute("authid")
}
var d=l.getAttribute("requests");
if(d){
this.window=parseInt(d,10)
}
var h=l.getAttribute("hold");
if(h){
this.hold=parseInt(h,10)
}
var b=l.getAttribute("wait");
if(b){
this.wait=parseInt(b,10)
}
var z=false;
var m=false;
var k=false;
var T=l.getElementsByTagName("mechanism");
var p,v,y,u;
if(T.length>0){
for(p=0;
p<T.length;
p++){
v=s.getText(T[p]);
if(v=="DIGEST-MD5"){
m=true
}else{
if(v=="PLAIN"){
z=true
}else{
if(v=="ANONYMOUS"){
k=true
}}}}}else{
var w=this._buildBody();
this._requests.push(new s.Request(w.tree(),this._onRequestStateChange.bind(this,this._connect_cb.bind(this)),w.tree().getAttribute("rid")));
this._throttledRequestHandler();
return
}
if(s.getNodeFromJid(this.jid)===null&&k){
this._changeConnectStatus(s.Status.AUTHENTICATING,null);
this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);
this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);
this.send(o("auth",{
xmlns:s.NS.SASL,mechanism:"ANONYMOUS"}
).tree())
}else{
if(s.getNodeFromJid(this.jid)===null){
this._changeConnectStatus(s.Status.CONNFAIL,"x-strophe-bad-non-anon-jid");
this.disconnect()
}else{
if(m){
this._changeConnectStatus(s.Status.AUTHENTICATING,null);
this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge1_cb.bind(this),null,"challenge",null,null);
this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);
this.send(o("auth",{
xmlns:s.NS.SASL,mechanism:"DIGEST-MD5"}
).tree())
}else{
if(z){
y=s.getBareJidFromJid(this.jid);
y=y+"\u0000";
y=y+s.getNodeFromJid(this.jid);
y=y+"\u0000";
y=y+this.pass;
this._changeConnectStatus(s.Status.AUTHENTICATING,null);
this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);
this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);
u=Base64.encode(y);
this.send(o("auth",{
xmlns:s.NS.SASL,mechanism:"PLAIN"}
).t(u).tree())
}else{
this._changeConnectStatus(s.Status.AUTHENTICATING,null);
this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1");
this.send(n({
type:"get",to:this.domain,id:"_auth_1"}
).c("query",{
xmlns:s.NS.AUTH}
).c("username",{}
).t(s.getNodeFromJid(this.jid)).tree())
}}}}}
,_sasl_challenge1_cb:function(m){
var l=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/;
var w=Base64.decode(s.getText(m));
var v=MD5.hexdigest(""+(Math.random()*1234567890));
var g="";
var k=null;
var y="";
var h="";
var p;
this.deleteHandler(this._sasl_failure_handler);
while(w.match(l)){
p=w.match(l);
w=w.replace(p[0],"");
p[2]=p[2].replace(/^"(.+)"$/,"$1");
switch(p[1]){
case"realm":g=p[2];
break;
case"nonce":y=p[2];
break;
case"qop":h=p[2];
break;
case"host":k=p[2];
break
}}
var f="xmpp/"+this.domain;
if(k!==null){
f=f+"/"+k
}
var u=MD5.hash(s.getNodeFromJid(this.jid)+":"+g+":"+this.pass)+":"+y+":"+v;
var d="AUTHENTICATE:"+f;
var b="";
b+="username="+this._quote(s.getNodeFromJid(this.jid))+",";
b+="realm="+this._quote(g)+",";
b+="nonce="+this._quote(y)+",";
b+="cnonce="+this._quote(v)+",";
b+='nc="00000001",';
b+='qop="auth",';
b+="digest-uri="+this._quote(f)+",";
b+="response="+this._quote(MD5.hexdigest(MD5.hexdigest(u)+":"+y+":00000001:"+v+":auth:"+MD5.hexdigest(d)))+",";
b+='charset="utf-8"';
this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge2_cb.bind(this),null,"challenge",null,null);
this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);
this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);
this.send(o("response",{
xmlns:s.NS.SASL}
).t(Base64.encode(b)).tree());
return false
}
,_quote:function(h){
return'"'+h.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'
}
,_sasl_challenge2_cb:function(h){
this.deleteHandler(this._sasl_success_handler);
this.deleteHandler(this._sasl_failure_handler);
this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null);
this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null);
this.send(o("response",{
xmlns:s.NS.SASL}
).tree());
return false
}
,_auth1_cb:function(h){
var l=n({
type:"set",id:"_auth_2"}
).c("query",{
xmlns:s.NS.AUTH}
).c("username",{}
).t(s.getNodeFromJid(this.jid)).up().c("password").t(this.pass);
if(!s.getResourceFromJid(this.jid)){
this.jid=s.getBareJidFromJid(this.jid)+"/strophe"
}
l.up().c("resource",{}
).t(s.getResourceFromJid(this.jid));
this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2");
this.send(l.tree());
return false
}
,_sasl_success_cb:function(h){
s.info("SASL authentication succeeded.");
this.deleteHandler(this._sasl_failure_handler);
this._sasl_failure_handler=null;
if(this._sasl_challenge_handler){
this.deleteHandler(this._sasl_challenge_handler);
this._sasl_challenge_handler=null
}
this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null);
this._sendRestart();
return false
}
,_sasl_auth1_cb:function(l){
this.features=l;
var h,u;
for(h=0;
h<l.childNodes.length;
h++){
u=l.childNodes[h];
if(u.nodeName=="bind"){
this.do_bind=true
}
if(u.nodeName=="session"){
this.do_session=true
}}
if(!this.do_bind){
this._changeConnectStatus(s.Status.AUTHFAIL,null);
return false
}else{
this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");
var d=s.getResourceFromJid(this.jid);
if(d){
this.send(n({
type:"set",id:"_bind_auth_2"}
).c("bind",{
xmlns:s.NS.BIND}
).c("resource",{}
).t(d).tree())
}else{
this.send(n({
type:"set",id:"_bind_auth_2"}
).c("bind",{
xmlns:s.NS.BIND}
).tree())
}}
return false
}
,_sasl_bind_cb:function(h){
if(h.getAttribute("type")=="error"){
s.info("SASL binding failed.");
this._changeConnectStatus(s.Status.AUTHFAIL,null);
return false
}
var d=h.getElementsByTagName("bind");
var l;
if(d.length>0){
l=d[0].getElementsByTagName("jid");
if(l.length>0){
this.jid=s.getText(l[0]);
if(this.do_session){
this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2");
this.send(n({
type:"set",id:"_session_auth_2"}
).c("session",{
xmlns:s.NS.SESSION}
).tree())
}else{
this.authenticated=true;
this._changeConnectStatus(s.Status.CONNECTED,null)
}}}else{
s.info("SASL binding failed.");
this._changeConnectStatus(s.Status.AUTHFAIL,null);
return false
}}
,_sasl_session_cb:function(h){
if(h.getAttribute("type")=="result"){
this.authenticated=true;
this._changeConnectStatus(s.Status.CONNECTED,null)
}else{
if(h.getAttribute("type")=="error"){
s.info("Session creation failed.");
this._changeConnectStatus(s.Status.AUTHFAIL,null);
return false
}}
return false
}
,_sasl_failure_cb:function(h){
if(this._sasl_success_handler){
this.deleteHandler(this._sasl_success_handler);
this._sasl_success_handler=null
}
if(this._sasl_challenge_handler){
this.deleteHandler(this._sasl_challenge_handler);
this._sasl_challenge_handler=null
}
this._changeConnectStatus(s.Status.AUTHFAIL,null);
return false
}
,_auth2_cb:function(h){
if(h.getAttribute("type")=="result"){
this.authenticated=true;
this._changeConnectStatus(s.Status.CONNECTED,null)
}else{
if(h.getAttribute("type")=="error"){
this._changeConnectStatus(s.Status.AUTHFAIL,null);
this.disconnect()
}}
return false
}
,_addSysTimedHandler:function(d,l){
var h=new s.TimedHandler(d,l);
h.user=false;
this.addTimeds.push(h);
return h
}
,_addSysHandler:function(m,u,l,d,f){
var h=new s.Handler(m,u,l,d,f);
h.user=false;
this.addHandlers.push(h);
return h
}
,_onDisconnectTimeout:function(){
s.info("_onDisconnectTimeout was called");
var h;
while(this._requests.length>0){
h=this._requests.pop();
h.abort=true;
h.xhr.abort();
h.xhr.onreadystatechange=function(){}
}
this._doDisconnect();
return false
}
,_onIdle:function(){
var d,m,p,u;
while(this.addTimeds.length>0){
this.timedHandlers.push(this.addTimeds.pop())
}
while(this.removeTimeds.length>0){
m=this.removeTimeds.pop();
if(!Array.prototype.indexOf){
this.timedHandlers.myIndexOf=function(y){
var g=this.length;
var b=Number(arguments[1])||0;
b=(b<0)?Math.ceil(b):Math.floor(b);
if(b<0){
b+=g
}
for(;
b<g;
b++){
if(b in this&&this[b]===y){
return b
}}
return -1
};
d=this.timedHandlers.myIndexOf(m)
}else{
d=this.timedHandlers.indexOf(m)
}
if(d>=0){
this.timedHandlers.splice(d,1)
}}
var l=new Date().getTime();
u=[];
for(d=0;
d<this.timedHandlers.length;
d++){
m=this.timedHandlers[d];
if(this.authenticated||!m.user){
p=m.lastCalled+m.period;
if(p-l<=0){
if(m.run()){
u.push(m)
}}else{
u.push(m)
}}}
this.timedHandlers=u;
var h,f;
if(this.authenticated&&this._requests.length===0&&this._data.length===0&&!this.disconnecting){
s.info("no requests during idle cycle, sending blank request");
this._data.push(null)
}
if(this._requests.length<2&&this._data.length>0&&!this.paused){
h=this._buildBody();
for(d=0;
d<this._data.length;
d++){
if(this._data[d]!==null){
if(this._data[d]==="restart"){
h.attrs({
to:this.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":s.NS.BOSH}
)
}else{
h.cnode(this._data[d]).up()
}}}
delete this._data;
this._data=[];
this._requests.push(new s.Request(h.tree(),this._onRequestStateChange.bind(this,this._dataRecv.bind(this)),h.tree().getAttribute("rid")));
this._processRequest(this._requests.length-1)
}
if(this._requests.length>0){
f=this._requests[0].age();
if(this._requests[0].dead!==null){
if(this._requests[0].timeDead()>Math.floor(s.SECONDARY_TIMEOUT*this.wait)){
this._throttledRequestHandler()
}}
if(f>Math.floor(s.TIMEOUT*this.wait)){
s.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(s.TIMEOUT*this.wait)+" seconds since last activity");
this._throttledRequestHandler()
}}
clearTimeout(this._idleTimeout);
if(this.connected){
this._idleTimeout=setTimeout(this._onIdle.bind(this),100)
}}};
if(r){
r(s,o,e,n,t)
}}
)(function(){
window.Strophe=arguments[0];
window.$build=arguments[1];
window.$msg=arguments[2];
window.$iq=arguments[3];
window.$pres=arguments[4]
}
);
function net_yaziba_chat_HandlerObject(){}
net_yaziba_chat_HandlerObject.prototype=new ZmZimletBase();
net_yaziba_chat_HandlerObject.prototype.constructor=net_yaziba_chat_HandlerObject;
var YChatZimlet=net_yaziba_chat_HandlerObject;
YChatZimlet.prototype.init=function(){
this.mode="prod";
if(this.mode=="dev"){
this.jabberUrl=this.getMessage("jabberUrl_dev")
}else{
if(this.mode=="prod"){
this.jabberUrl=this.getMessage("jabberUrl_prod")
}}
this.yazibaUrl=location.protocol+"//"+location.hostname;
this._tabAppName=this.createApp("Chat","zimbraIcon","Chater avec mes amis");
var o=AjxStringUtil.urlComponentEncode(this.jabberUrl);
this.BOSH_SERVICE=[ZmZimletBase.PROXY,o].join("");
var t=this.getResource("preauth.jsp");
AjxRpc.invoke(null,t,null,this.preauth_callback,AjxRpcRequest.HTTP_GET);
this.username=appCtxt.get(ZmSetting.USERNAME);
this.password=null;
this.connected=false;
this.pwdDialog=null;
this.chatDialog=null;
this.initializePwdDialog();
var e=document.getElementById("z_shell");
this.tabAppEl=null;
this.isAppActive=true
};
YChatZimlet.prototype.preauth_callback=function(e){
chatZm=appCtxt.getZimletMgr().getZimletByName("net_yaziba_chat").handlerObject;
chatZm.password=e.text
};
YChatZimlet.prototype.appActive=function(e,o){
switch(e){
case this._tabAppName:if(o){
this.isAppActive=true;
skin._showEl("zb__NEW_MENU",false);
skin._showEl("skin_td_new_button",false);
skin._reflowApp();
if(this.tabAppEl!=null){
var t=this.tabAppEl.className;
this.tabAppEl.className=t.replace("ZAlert","")
}}else{
this.isAppActive=false;
skin._showEl("zb__NEW_MENU",true);
skin._showEl("skin_td_new_button",true)
}
break
}};
YChatZimlet.prototype.appLaunch=function(e){
switch(e){
case this._tabAppName:this.isAppActive=true;
skin._showEl("zb__NEW_MENU",false);
skin._showEl("skin_td_new_button",false);
skin._reflowApp();
var l=appCtxt.getApp(this._tabAppName);
l.setContent('<div id="divChatZone"></div>');
var h=l.getOverview();
h.setContent('<div id="divFriends"></div>');
this.constructFriendsOverview();
var s=l.getToolbar();
s.setContent('<div id="divToolBar"></div>');
this.constructToolBar();
this.connected=_getIsConnected();
if(this.connected==false){
connect(this.BOSH_SERVICE,this.username,this.password)
}
var r=document.getElementById("ztb_appChooser");
var o=r.getElementsByTagName("div");
for(var t=0;
t<o.length;
t++){
var n=o[t].id;
if(n.indexOf("net_yaziba_chat")!=-1){
this.tabAppEl=o[t]
}}
break
}};
YChatZimlet.prototype.doDrop=function(n){
this.connected=_getIsConnected();
if(this.connected==true&&n!=null&&n.TYPE=="ZmContact"){
var e=[];
if(this.isArray(n)){
for(var o=0;
o<n.length;
o++){
var t=n[o].email;
e.push(t)
}}else{
e.push(n.email)
}
addContact(e);
appCtxt.getAppController().activateApp(this._tabAppName)
}else{
if(this.connected==false){
YChatZimlet.alert(this.getMessage("connError"))
}}};
YChatZimlet.prototype.doubleClicked=function(){
this.singleClicked()
};
YChatZimlet.prototype.singleClicked=function(){
appCtxt.getAppController().activateApp(this._tabAppName)
};
YChatZimlet.prototype.initializePwdDialog=function(){
this._pView=new DwtComposite(this.getShell());
this._pView.setSize("300","30");
var r=document.createElement("table");
r.id="tPwd";
var s=document.createElement("tr");
var t=document.createElement("td");
var n=document.createElement("td");
var o=document.createElement("input");
t.appendChild(document.createTextNode("Mot de passe :"));
o.id="pwdChat";
o.type="password";
o.onkeyup=function(l){
if(l.which==13||l.keyCode==13){
var h=appCtxt.getZimletMgr().getZimletByName("net_yaziba_chat").handlerObject;
h._okBtnListener()
}};
this._pView.getHtmlElement().appendChild(r);
r.appendChild(s);
s.appendChild(t);
s.appendChild(n);
n.appendChild(o);
var e=new DwtDialog_ButtonDescriptor("CLOSE",("Annuler"),DwtDialog.ALIGN_RIGHT);
this.pwdDialog=this._createDialog({
title:"YaZiba Chat",view:this._pView,extraButtons:[e],standardButtons:[DwtDialog.OK_BUTTON]}
);
this.pwdDialog.setButtonListener(DwtDialog.OK_BUTTON,new AjxListener(this,this._okBtnListener));
this.pwdDialog.setButtonListener("CLOSE",new AjxListener(this,this._closePwdDialog))
};
YChatZimlet.prototype.constructFriendsOverview=function(){
var u=document.createElement("div");
u.id="divRoster";
var s=document.createElement("div");
s.id="divBuddyList";
s.className="divList";
var t=document.createElement("div");
t.id="divBuddyListHead";
t.className="divListHead";
var r=document.createElement("span");
r.id="spanBuddyOnlineNum";
var n=document.createElement("span");
n.id="spanBuddyTotalNum";
t.appendChild(document.createTextNode("Amis ( "));
t.appendChild(r);
t.appendChild(document.createTextNode(" / "));
t.appendChild(n);
t.appendChild(document.createTextNode(" )"));
var f=document.createElement("div");
f.id="divBuddyListBody";
f.className="divListBody divExpand";
var l=document.createElement("ul");
l.id="ulBuddyListContent";
l.className="ulListContent";
var m=document.createElement("div");
m.id="divNotInList";
m.className="divList";
var e=document.createElement("div");
e.id="divNotInListHead";
e.className="divListHead";
var h=document.createElement("span");
h.id="spanNotInListNum";
e.appendChild(document.createTextNode("A confirmer ( "));
e.appendChild(h);
e.appendChild(document.createTextNode(" )"));
var d=document.createElement("div");
d.id="divNotInListBody";
d.className="divListBody divExpand";
var o=document.createElement("ul");
o.id="ulNotInListContent";
o.className="ulListContent";
document.getElementById("divFriends").appendChild(u);
u.appendChild(s);
u.appendChild(m);
s.appendChild(t);
s.appendChild(f);
f.appendChild(l);
m.appendChild(e);
m.appendChild(d);
d.appendChild(o)
};
YChatZimlet.prototype.constructToolBar=function(){
var y=document.createElement("div");
y.id="divAddFriend";
var g=document.createElement("input");
g.id="textAddFriend";
g.type="text";
var b=document.createElement("input");
b.id="btnAddFriend";
b.type="button";
b.value="Ajouter un contact";
y.appendChild(g);
y.appendChild(b);
var f=document.createElement("input");
f.id="btnEmoticons";
f.type="button";
f.value="Smiley";
var s=document.createElement("div");
s.id="divEtatSelect";
var B=document.createElement("table");
B.id="tableEtatSelect";
B.className="ZButtonBorder";
B.cellSpacing="0";
var Y=document.createElement("tbody");
var d=document.createElement("tr");
var m=document.createElement("td");
m.id="tdTitle";
m.width="85%";
var e=document.createElement("img");
e.className="statusImg";
e.src="/zimlet/net_yaziba_chat/images/statusicons/online.png";
var M=document.createElement("div");
M.className="statusTxt";
M.appendChild(document.createTextNode(this.getMessage("connect")));
m.appendChild(e);
m.appendChild(M);
var h=document.createElement("td");
h.id="tdDropdown";
h.className="ZDropDown";
var E=document.createElement("div");
E.className="ImgSelectPullDownArrow";
h.appendChild(E);
d.appendChild(m);
d.appendChild(h);
Y.appendChild(d);
B.appendChild(Y);
s.appendChild(B);
document.getElementById("divToolBar").appendChild(y);
document.getElementById("divToolBar").appendChild(f);
document.getElementById("divToolBar").appendChild(s);
var r=document.createElement("div");
r.id="divEtatOptions";
var n=s.getBoundingClientRect();
var C=n.left;
var k=n.top;
r.style.left=C+1;
r.style.top=k+20;
r.style.visibility="hidden";
var x=document.createElement("div");
x.id="divConnOption";
x.className="etatOption";
var O=document.createElement("img");
O.className="statusImg";
O.src="/zimlet/net_yaziba_chat/images/statusicons/online.png";
var R=document.createElement("div");
R.className="statusTxt";
R.appendChild(document.createTextNode(this.getMessage("connect")));
x.appendChild(O);
x.appendChild(R);
var w=document.createElement("div");
w.id="divChattingOption";
w.className="etatOption";
var o=document.createElement("img");
o.className="statusImg";
o.src="/zimlet/net_yaziba_chat/images/statusicons/online.png";
var l=document.createElement("div");
l.className="statusTxt";
l.appendChild(document.createTextNode(this.getMessage("chatting")));
w.appendChild(o);
w.appendChild(l);
var u=document.createElement("div");
u.id="divBusyOption";
u.className="etatOption";
var p=document.createElement("img");
p.className="statusImg";
p.src="/zimlet/net_yaziba_chat/images/statusicons/busy.png";
var W=document.createElement("div");
W.className="statusTxt";
W.appendChild(document.createTextNode(this.getMessage("busy")));
u.appendChild(p);
u.appendChild(W);
var H=document.createElement("div");
H.id="divTempAwayOption";
H.className="etatOption";
var z=document.createElement("img");
z.className="statusImg";
z.src="/zimlet/net_yaziba_chat/images/statusicons/invisible.png";
var A=document.createElement("div");
A.className="statusTxt";
A.appendChild(document.createTextNode(this.getMessage("temp-away")));
H.appendChild(z);
H.appendChild(A);
var v=document.createElement("div");
v.id="divAwayOption";
v.className="etatOption";
var T=document.createElement("img");
T.className="statusImg";
T.src="/zimlet/net_yaziba_chat/images/statusicons/away.png";
var F=document.createElement("div");
F.className="statusTxt";
F.appendChild(document.createTextNode(this.getMessage("away")));
v.appendChild(T);
v.appendChild(F);
var D=document.createElement("div");
D.id="divDisconnOption";
D.className="etatOption";
var t=document.createElement("img");
t.className="statusImg";
t.src="/zimlet/net_yaziba_chat/images/statusicons/offline.png";
var S=document.createElement("div");
S.className="statusTxt";
S.appendChild(document.createTextNode(this.getMessage("disconnect")));
D.appendChild(t);
D.appendChild(S);
r.appendChild(x);
r.appendChild(w);
r.appendChild(u);
r.appendChild(H);
r.appendChild(v);
r.appendChild(D);
z_shell.appendChild(r);
var q=appCtxt.getZimletMgr().getZimletByName("net_yaziba_chat").handlerObject;
g.onclick=function(){
this.focus()
};
g.onkeyup=function(){
if(this.value.length!=0){
q.autoComplete(this.value)
}else{
var L=document.getElementById("divAutoComplete");
if(L!=null){
L.parentNode.removeChild(L)
}}};
b.onclick=function(){
var P=_getIsConnected();
if(P==true){
var N=g.value;
var U=isEmail(N);
if(U==false){
YChatZimlet.alert(q.getMessage("mailInvalidErr"))
}else{
var L=[N];
addContact(L);
g.value=""
}}else{
YChatZimlet.alert(q.getMessage("connError"))
}};
f.onclick=function(){
var N=_getIsConnected();
if(N==true){
var L=document.getElementById("divEmoticons");
if(L!=null){
L.parentNode.removeChild(L)
}else{
showEmoticons()
}}else{
YChatZimlet.alert(q.getMessage("connError"))
}};
s.onmouseover=function(){
this.className+=" ZHover"
};
s.onmouseout=function(){
this.className=this.className.replace(" ZHover","")
};
s.onclick=function(){
var L=r.style.visibility;
if(L=="visible"){
r.style.visibility="hidden"
}else{
if(L=="hidden"){
r.style.visibility="visible"
}}};
var G=document.getElementsByClassName("etatOption");
for(var I=0;
I<G.length;
I++){
G[I].onmouseover=function(){
this.className+=" etatHover"
};
G[I].onmouseout=function(){
this.className=this.className.replace(" etatHover","")
};
G[I].onclick=function(){
m.innerHTML=this.innerHTML;
r.style.visibility="hidden";
q.connected=_getIsConnected();
if(this.id=="divConnOption"){
if(!q.connected){
connect(q.BOSH_SERVICE,q.username,q.password)
}else{
changeEtat("divChattingOption")
}}else{
if(this.id=="divDisconnOption"){
disconnect()
}else{
changeEtat(this.id)
}}}
}};
YChatZimlet.prototype.autoComplete=function(s){
var t=this.yazibaUrl+"/service/soap/AutoCompleteRequest";
var r="POST";
var e=JSON.stringify({
Header:{
context:{
_jsns:"urn:zimbra",account:{
_content:this.username,by:"name"}}}
,Body:{
AutoCompleteRequest:{
_jsns:"urn:zimbraMail",name:{
_content:s}
,needExp:1}}}
);
var o=true;
var n=null;
if(window.XMLHttpRequest){
n=new XMLHttpRequest()
}else{
n=new ActiveXObject("Microsoft.XMLHTTP")
}
n.open(r,t,o);
n.setRequestHeader("Content-Type","application/json;charset=UTF-8");
n.onreadystatechange=function(){
if(n.readyState==4&&n.status==200){
var m=JSON.parse(n.responseText);
var u=m.Body.AutoCompleteResponse.match;
var l=null;
var p=null;
var y=document.getElementById("divAutoComplete");
var h=document.getElementById("ulAutoComplete");
if(u!=null&&u.length!=0){
if(y!=null&&h!=null){
l=y;
p=h;
p.innerHTML=""
}else{
l=document.createElement("div");
l.id="divAutoComplete";
p=document.createElement("ul");
p.id="ulAutoComplete";
z_shell.appendChild(l);
l.appendChild(p)
}
for(var d=0;
d<u.length;
d++){
var f=u[d]["email"];
var g=document.createElement("li");
g.className="liAutoComplete";
g.appendChild(document.createTextNode(f));
g.onclick=function(){
var w=this.innerHTML.split(" ");
var b=w[w.length-1];
b=b.replace(/&lt;/g,"").replace(/&gt;/g,"");
document.getElementById("textAddFriend").value=b;
l.parentNode.removeChild(l)
};
g.onmouseover=function(){
this.className+=" liHover"
};
g.onmouseout=function(){
this.className=this.className.replace(" liHover","")
};
p.appendChild(g)
}}else{
if(y!=null){
y.parentNode.removeChild(y)
}}}};
n.send(e)
};
YChatZimlet.prototype._openPwdDialog=function(){
this.pwdDialog.popup();
document.getElementById("pwdChat").focus()
};
YChatZimlet.prototype._okBtnListener=function(){
var e=document.getElementById("pwdChat").value;
this.password=e;
connect(this.BOSH_SERVICE,this.username,this.password)
};
YChatZimlet.prototype._closePwdDialog=function(){
document.getElementById("pwdChat").value="";
this.pwdDialog.popdown()
};
YChatZimlet.prototype.isArray=function(e){
return Object.prototype.toString.call(e)=="[object Array]"
};
YChatZimlet.alert=function(n,t,o){
if(t==null){
t=DwtMessageDialog.INFO_STYLE
}
var e=appCtxt.getMsgDialog();
e.reset();
e.setMessage(n,t);
if(o!=null){
e.setTitle(o)
}else{
e.setTitle("YaZiba Chat")
}
e.popup()
};
var connection=null;
var isConnected=false;
var bosh_sid=null;
var contact_ids=[];
var chat_windows=[];
var roster_pres_sub=[];
var list_to_auth=[];
var list_to_auth_ids=[];
var msg_waiting={};
var my_other_resources=[];
var contact_index=0;
var online_num=0;
var buddy_total_num=0;
var has_get_roster=false;
var chatZm=appCtxt.getZimletMgr().getZimletByName("net_yaziba_chat").handlerObject;
var user_name=null;
var onfocus_chat_id=null;
var status_imgs_folder="/zimlet/net_yaziba_chat/images/statusicons/";
var smiley_list={
'<img src="/zimlet/net_yaziba_chat/images/emoticons/smile.png">':[":)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/smile-big.png">':[":-D",":-d",":D",":d",":->",":>"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/sad.png">':[":-(",":("],'<img src="/zimlet/net_yaziba_chat/images/emoticons/wink.png">':[";-)",";)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/tongue.png">':[":P",":p",":-P",":-p"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/shock.png">':[":-O",":-o",":O",":o",">:o","=-O"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/kiss.png">':[":kiss:","(K)","(k)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/crying.png">':[":'-(",":'(",";-(",";("],'<img src="/zimlet/net_yaziba_chat/images/emoticons/angry.png">':[":-@",":@",">:-("],'<img src="/zimlet/net_yaziba_chat/images/emoticons/embarrassed.png">':[":-$",":$",":-["],'<img src="/zimlet/net_yaziba_chat/images/emoticons/neutral.png">':[":|",":-|"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/confused.png">':[":-S",":-s"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/glasses-cool.png">':["B-)","B)","8-)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/thinking.png">':[":-/"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/angel.png">':["O:-)","(A)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/shut-mouth.png">':[":-X",":-#"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/waiting.png">':[":wait:"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/bye.png">':["(bye)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/sick.png">':["+o("],'<img src="/zimlet/net_yaziba_chat/images/emoticons/sleepy.png">':["|-)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/good.png">':[":yes:","(Y)","(y)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/bad.png">':[":no:","(N)","(n)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/rose.png">':["@->--","(F)","(f)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/rose-dead.png">':["(W)","(w)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/phone.png">':[":telephone:","(T)","(t)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/mail.png">':[":email:","(E)","(e)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/lamp.png">':[":jabber:","(I)","(i)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/cake.png">':[":cake:"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/love.png">':[":heart:",":love:","(L)","(l)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/love-over.png">':[":brokenheart:","(U)","(u)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/musical-note.png">':[":music:","(8)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/beer.png">':[":beer:","(B)","(b)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/coffee.png">':[":coffee:","(C)","(c)"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/coins.png">':[":money:"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/moon.png">':[":moon:"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/sun.png">':[":sun:"],'<img src="/zimlet/net_yaziba_chat/images/emoticons/star.png">':[":star:","(*)"]};
function connect(e,o,t){
user_name=o;
connection=new Strophe.Connection(e);
connection.connect(o,t,onConnect)
}
function disconnect(){
connection.flush();
connection.disconnect();
closeAllWindow();
contact_ids=[];
chat_windows=[];
roster_pres_sub=[];
list_to_auth=[];
list_to_auth_ids=[];
msg_waiting={};
contact_index=0;
online_num=0;
buddy_total_num=0;
document.getElementById("spanBuddyOnlineNum").innerHTML="";
document.getElementById("spanBuddyTotalNum").innerHTML="";
document.getElementById("ulBuddyListContent").innerHTML="";
document.getElementById("spanNotInListNum").innerHTML="";
document.getElementById("ulNotInListContent").innerHTML=""
}
function onConnect(e){
if(e==Strophe.Status.CONNECTING){}else{
if(e==Strophe.Status.CONNFAIL){
YChatZimlet.alert(chatZm.getMessage("connError"))
}else{
if(e==Strophe.Status.DISCONNECTING){}else{
if(e==Strophe.Status.AUTHFAIL){
YChatZimlet.alert(chatZm.getMessage("connError"))
}else{
if(e==Strophe.Status.DISCONNECTED){
isConnected=false
}else{
if(e==Strophe.Status.CONNECTED){
isConnected=true;
chatZm._closePwdDialog();
connection.addHandler(onMessage,null,"message",null,null,null);
connection.addHandler(onPresence,null,"presence");
connection.send($pres().tree());
getRoster()
}else{
if(e==Strophe.Status.ERROR){
YChatZimlet.alert(chatZm.getMessage("connError"))
}}}}}}}}
function onMessage(l){
var p=l.getAttribute("from");
var y=p.split("/")[0];
var n=l.getAttribute("to");
var s=n.split("/")[0];
var h=l.getAttribute("type");
var v=l.getElementsByTagName("body");
if(h=="chat"&&v.length>0){
if(y!=s){
appCtxt.getAppController().setStatusMsg("Vous avez un nouveau message instantané de "+y,ZmStatusView.LEVEL_INFO);
if(chatZm.tabAppEl.className.indexOf("ZAlert")<0&&!chatZm.isAppActive){
var w=chatZm.tabAppEl.className.split(" ");
w.push("ZAlert");
chatZm.tabAppEl.className=w.join(" ")
}
var m=v[0];
var d=dateFormat(new Date());
var r=createMessage(y,d,Strophe.getText(m),"msg_recieved");
saveMessage(y,r);
if(chat_windows[y]!=undefined){
var o=chat_windows[y]["content_id"];
var e=document.getElementById(o);
e.innerHTML+=r;
e.scrollTop=e.scrollHeight
}}else{
var g=Strophe.getText(v[0]).split("_")[0];
var f=Strophe.getText(v[0]).split("_")[1];
if(g=="r"){
if((f in chat_windows)&&chat_windows[f]!=undefined){
closeChatWindow(f)
}
delete contact_ids[f];
delete roster_pres_sub[f];
online_num==0?online_num=0:online_num-=1;
getRoster()
}else{
if(g=="authen"){
list_to_auth.splice(myIndexOf(list_to_auth,f),1);
var u=document.getElementById(list_to_auth_ids[f]);
u.parentNode.removeChild(u);
delete list_to_auth_ids[f];
getRoster()
}else{
if(g=="update"){
getRoster()
}}}}}else{
if(h=="error"){
var b=l.getElementsByTagName("error");
var t=b[0].getAttribute("code");
if(t=="404"){
YChatZimlet.alert(y+" n'existe pas!")
}}}
return true
}
function onPresence(s){
var r=s.getAttribute("type");
var p=s.getAttribute("from");
var h=p.split("/")[0];
var e=p.split("/")[1];
var g=s.getAttribute("to");
var n=g.split("/")[0];
var u=g.split("/")[1];
var d=null;
var o=null;
if(r!="error"){
if(h!=n){
if(r==null){
if(!(h in roster_pres_sub)){
roster_pres_sub[h]=[]
}
if(roster_pres_sub[h]["resource"]==undefined){
roster_pres_sub[h]["resource"]=[]
}
var m=roster_pres_sub[h]["resource"];
if(myIndexOf(m,e)==-1){
roster_pres_sub[h]["resource"].push(e)
}
if(roster_pres_sub[h]["status"]=="s-offline"||roster_pres_sub[h]["status"]==undefined){
changeBuddyStatus(h,"s-online");
online_num+=1
}
document.getElementById("spanBuddyOnlineNum").innerHTML=online_num.toString();
if(s.getElementsByTagName("show")){
var f=Strophe.getText(s.getElementsByTagName("show")[0]);
if(f==="chat"){
changeBuddyStatus(h,"s-chat")
}else{
if(f==="dnd"){
changeBuddyStatus(h,"s-busy")
}else{
if(f==="away"){
changeBuddyStatus(h,"s-temp-away")
}else{
if(f==="xa"){
changeBuddyStatus(h,"s-away")
}}}}}}else{
if(r=="unavailable"){
if(h in roster_pres_sub){
if(roster_pres_sub[h]["resource"]!=undefined&&roster_pres_sub[h]["resource"].length==1){
appCtxt.getAppController().setStatusMsg(h+" est déconnecté.",ZmStatusView.LEVEL_INFO);
roster_pres_sub[h]["status"]="s-offline";
online_num==0?online_num=0:online_num-=1;
if(document.getElementById(contact_ids[h])){
var t=document.getElementById(contact_ids[h]);
var y=t.getElementsByTagName("img")[0];
y.src=status_imgs_folder+"offline.png";
t.className="b_offline"
}
document.getElementById("spanBuddyOnlineNum").innerHTML=online_num.toString()
}
var l=myIndexOf(roster_pres_sub[h]["resource"],e);
roster_pres_sub[h]["resource"].splice(l,1)
}}else{
if(r=="subscribe"){
if(has_get_roster==true){
appCtxt.getAppController().setStatusMsg(h+" vous invite.",ZmStatusView.LEVEL_INFO);
if(!(h in roster_pres_sub)&&myIndexOf(list_to_auth,h)<0){
list_to_auth.push(h);
addAuthItem(h)
}else{
if(h in roster_pres_sub){
connection.send($pres({
to:h,type:"subscribed"}
));
connection.send($pres({
to:h,type:"subscribe"}
))
}}}else{
list_to_auth.push(h)
}}}}}else{
if(h==n&&e!=u){
if(r==null){
my_other_resources.push(p)
}else{
if(r=="unavailable"){
my_other_resources.splice(myIndexOf(my_other_resources,p),1)
}}}}}
return true
}
function getRoster(){
var e=$iq({
type:"get"}
).c("query",{
xmlns:"jabber:iq:roster"}
);
connection.sendIQ(e,rosterCallback)
}
function rosterCallback(r){
var t=r.getElementsByTagName("item");
buddy_total_num=t.length;
document.getElementById("spanBuddyOnlineNum").innerHTML=online_num.toString();
document.getElementById("spanBuddyTotalNum").innerHTML=buddy_total_num.toString();
document.getElementById("spanNotInListNum").innerHTML=list_to_auth.length.toString();
document.getElementById("ulBuddyListContent").innerHTML="";
document.getElementById("ulNotInListContent").innerHTML="";
if(t.length!=0){
for(var n=0;
n<t.length;
n++){
var e=t[n].getAttribute("jid");
r=$iq({
type:"get",to:e,id:connection.getUniqueId("vCard")}
).c("vCard",{
xmlns:"vcard-temp"}
).tree();
connection.sendIQ(r,vcardCallback);
if(!(e in roster_pres_sub)){
roster_pres_sub[e]=[];
roster_pres_sub[e]["status"]="s-offline"
}}}
if(list_to_auth.length!=0){
for(var o=0;
o<list_to_auth.length;
o++){
var s=list_to_auth[o];
if(s in roster_pres_sub){
connection.send($pres({
to:s,type:"subscribed"}
));
connection.send($pres({
to:s,type:"subscribe"}
));
list_to_auth.splice(o,1);
document.getElementById("spanNotInListNum").innerHTML=list_to_auth.length.toString()
}else{
addAuthItem(s)
}}}
has_get_roster=true
}
function vcardCallback(n){
var t=n.getAttribute("from");
var s=n.getElementsByTagName("NICKNAME");
if(s.length>0&&s[0].childNodes[0]!=undefined){
roster_pres_sub[t]["nickname"]=s[0].childNodes[0].nodeValue
}
contact_ids[t]="buddy_"+contact_index.toString();
var r=document.createElement("li");
r.id=contact_ids[t];
var o=document.createElement("img");
o.className="statusImg";
var e=document.createElement("div");
e.className="buddyName";
r.appendChild(o);
r.appendChild(e);
if(roster_pres_sub[t]["status"]=="s-online"||roster_pres_sub[t]["status"]=="s-chat"){
o.src=status_imgs_folder+"online.png";
r.className="b_online"
}else{
if(roster_pres_sub[t]["status"]=="s-busy"){
o.src=status_imgs_folder+"busy.png";
r.className="b_online"
}else{
if(roster_pres_sub[t]["status"]=="s-temp-away"){
o.src=status_imgs_folder+"invisible.png";
r.className="b_online"
}else{
if(roster_pres_sub[t]["status"]=="s-away"){
o.src=status_imgs_folder+"away.png";
r.className="b_online"
}else{
o.src=status_imgs_folder+"offline.png";
r.className="b_offline"
}}}}
if(roster_pres_sub[t]["nickname"]==undefined){
e.appendChild(document.createTextNode(t))
}else{
e.appendChild(document.createTextNode(roster_pres_sub[t]["nickname"]))
}
r.onclick=function(){
var l=getKey(contact_ids,this.id);
var h=this.id.split("_")[1];
openChatWindow(l,h)
};
r.oncontextmenu=function(h){
var l=getKey(contact_ids,this.id);
openMenu(l,h)
};
r.onmouseover=function(){
this.className+=" liHover"
};
r.onmouseout=function(){
this.className=this.className.replace(" liHover","")
};
contact_index+=1;
document.getElementById("ulBuddyListContent").appendChild(r)
}
function showBuddyDetails(e){
var t=document.createElement("div");
t.id="divBuddyDetail";
t.innerHTML=e;
document.getElementById("z_shell").appendChild(t)
}
function addContact(r){
for(var s=0;
s<r.length;
s++){
var o=r[s];
var e=checkContact(o);
if(e=="free to add"){
var h=$iq({
type:"set"}
).c("query",{
xmlns:"jabber:iq:roster"}
).c("item",{
jid:o}
);
connection.sendIQ(h);
connection.send($pres({
to:o,type:"subscribe"}
));
getRoster()
}else{
if(e=="added"){
YChatZimlet.alert("Le contact "+o+" existe.");
continue
}else{
if(e=="to auth"){
authContact(o)
}}}}
for(var t=0;
t<my_other_resources.length;
t++){
var l=$msg({
to:my_other_resources[t],type:"chat"}
).cnode(Strophe.xmlElement("body","update_roster")).up().c("active",{
xmlns:"http://jabber.org/protocol/chatstates"}
);
connection.send(l)
}}
function removeContact(e){
var o=null;
var t=DwtMessageDialog.INFO_STYLE;
this._rmdialog=appCtxt.getYesNoMsgDialog();
this._rmdialog.setButtonListener(DwtDialog.YES_BUTTON,new AjxListener(this,function(){
yesBtnListenerRC(e);
this._rmdialog.popdown()
}
));
this._rmdialog.setButtonListener(DwtDialog.NO_BUTTON,new AjxListener(this,function(){
this._rmdialog.popdown()
}
));
if((e in chat_windows)&&chat_windows[e]!=undefined){
o="Vous êtes en train de chater avec "+e+". Voulez-vous vraiment supprimer ce contact "+e+" ?"
}else{
o="Voulez-vous vraiment supprimer ce contact "+e+" ?"
}
this._rmdialog.reset();
this._rmdialog.setMessage(o,t);
this._rmdialog.popup()
}
function yesBtnListenerRC(t){
if((t in chat_windows)&&chat_windows[t]!=undefined){
closeChatWindow(t)
}
connection.send($pres({
to:t,type:"unsubscribe"}
));
connection.send($pres({
to:t,type:"unsubscribed"}
));
var o=$iq({
type:"set"}
).c("query",{
xmlns:"jabber:iq:roster"}
).c("item",{
jid:t,subscription:"remove"}
);
connection.sendIQ(o);
delete contact_ids[t];
delete roster_pres_sub[t];
online_num==0?online_num=0:online_num-=1;
for(var e=0;
e<my_other_resources.length;
e++){
var s=$msg({
to:my_other_resources[e],type:"chat"}
).cnode(Strophe.xmlElement("body","r_"+t)).up().c("active",{
xmlns:"http://jabber.org/protocol/chatstates"}
);
connection.send(s)
}
getRoster()
}
function checkContact(e){
if((e in contact_ids)&&(e in roster_pres_sub)){
return"added"
}else{
if(myIndexOf(list_to_auth,e)>=0){
return"to auth"
}else{
return"free to add"
}}}
function openMenu(n,h){
var o=document.getElementsByClassName("divMenu");
if(o.length!=0){
o[0].parentNode.removeChild(o[0])
}
var r="";
var s="";
if(contact_ids[n]!=undefined){
r=contact_ids[n].replace("buddy","menu");
s='<a href="#" onclick="removeContact(\''+n+"');\">Supprimer</a>"
}else{
if(list_to_auth_ids[n]!=null){
r=list_to_auth_ids[n].replace("auth","menu");
s='<a href="#" onclick="authContact(\''+n+"');\">Ajouter à la liste de contact</a>"
}}
var t=document.createElement("div");
t.className="divMenu";
t.id=r;
t.style.left=(h?h.clientX:window.event.clientX)+"px";
t.style.top=(h?h.clientY:window.event.clientY)+"px";
t.innerHTML=s;
document.getElementById("z_shell").appendChild(t);
document.body.onclick=function(d){
var l=d?d.target:window.event.srcElement;
if(l.id!=r&&t.parentNode!=null){
t.parentNode.removeChild(t)
}}
}
function authContact(e){
var o=null;
var t=DwtMessageDialog.INFO_STYLE;
this._authdialog=appCtxt.getYesNoMsgDialog();
this._authdialog.setButtonListener(DwtDialog.YES_BUTTON,new AjxListener(this,function(){
yesBtnListenerAuth(e);
this._authdialog.popdown()
}
));
this._authdialog.setButtonListener(DwtDialog.NO_BUTTON,new AjxListener(this,function(){
this._authdialog.popdown()
}
));
if((e in chat_windows)&&chat_windows[e]!=undefined){
o="Souhaitez-vous confirmer ce contact "+e+" ?"
}else{
o="Voulez-vous ajouter ce contact "+e+" ?"
}
this._authdialog.reset();
this._authdialog.setMessage(o,t);
this._authdialog.popup()
}
function yesBtnListenerAuth(t){
connection.send($pres({
to:t,type:"subscribed"}
));
connection.send($pres({
to:t,type:"subscribe"}
));
list_to_auth.splice(myIndexOf(list_to_auth,t),1);
var o=document.getElementById(list_to_auth_ids[t]);
o.parentNode.removeChild(o);
delete list_to_auth_ids[t];
for(var e=0;
e<my_other_resources.length;
e++){
var s=$msg({
to:my_other_resources[e],type:"chat"}
).cnode(Strophe.xmlElement("body","authen_"+t)).up().c("active",{
xmlns:"http://jabber.org/protocol/chatstates"}
);
connection.send(s)
}
getRoster()
}
function addAuthItem(t){
list_to_auth_ids[t]="auth_"+contact_index.toString();
var e=document.createElement("li");
e.id=list_to_auth_ids[t];
e.className="notInList";
e.innerHTML=t;
e.onclick=function(){
var o=this.id.split("_")[1];
openChatWindow(t,o)
};
e.oncontextmenu=function(o){
openMenu(t,o)
};
contact_index+=1;
document.getElementById("ulNotInListContent").appendChild(e);
document.getElementById("spanNotInListNum").innerHTML=list_to_auth.length.toString()
}
function openChatWindow(e,t){
if((e in chat_windows)&&chat_windows[e]!=undefined){
focusChatWindow(e)
}else{
var n="chat_"+t.toString();
var s="chat_content_"+t.toString();
var o="message_"+t.toString();
chat_windows[e]=[];
chat_windows[e]["window_id"]=n;
chat_windows[e]["content_id"]=s;
chat_windows[e]["message_id"]=o;
addChatWindow(e,n,s,o)
}}
function addChatWindow(e,l,h,n){
var r='<div class="chatTitle">';
r+='<div class="titleButton">';
r+='<div class="buttonClose ImgDelete" title="close" href="#" onclick="closeChatWindow(\''+e+"');\"></div></div>";
if(roster_pres_sub[e]!=undefined&&roster_pres_sub[e]["nickname"]!=undefined){
r+='<div class="titleText">'+roster_pres_sub[e]["nickname"]+"</div></div>"
}else{
r+='<div class="titleText">'+e+"</div></div>"
}
r+='<div id="'+h+'" class="chatContent"></div>';
r+='<div class="messageAction">';
r+='<div class="messageAction_content">';
r+='<textarea id="'+n+'" class="message" onkeyup="sendMessage(\''+e+"', event);\" onfocus=\"onchat('"+n+"', this);\"></textarea></div></div>";
var o=document.createElement("div");
o.id=l;
o.className="divChat";
document.getElementById("divChatZone").appendChild(o);
o.innerHTML=r;
var s=document.getElementById(h);
var d=document.getElementById(n);
if((e in msg_waiting)&&msg_waiting[e].length>0){
for(var t=0;
t<msg_waiting[e].length;
t++){
s.innerHTML+=msg_waiting[e][t]
}}
d.focus()
}
function focusChatWindow(e){
document.getElementById(chat_windows[e]["message_id"]).focus()
}
function closeChatWindow(e){
var t=chat_windows[e]["window_id"];
var o=document.getElementById(t);
o.parentNode.removeChild(o);
delete chat_windows[e]
}
function closeAllWindow(){
document.getElementById("divChatZone").innerHTML=""
}
function onchat(o,t){
onfocus_chat_id=o;
t.selectionStart=t.selectionEnd=t.value.length;
if(document.documentMode!=undefined){
var e=t.createTextRange();
e.collapse(true);
e.moveStart("character",t.selectionStart);
e.moveEnd("character",t.selectionEnd);
e.select()
}}
function sendMessage(s,t){
var h=document.getElementById(chat_windows[s]["message_id"]);
var d=h.value.replace(/\s/g,"");
if(d.length<=0){
h.value="";
return
}
if(t.which==13||t.keyCode==13){
var l=document.getElementById(chat_windows[s]["content_id"]);
var m=user_name;
var o=dateFormat(new Date());
var u=h.value;
h.value="";
var e=createMessage(m,o,u,"msg_sent");
l.innerHTML+=e;
l.scrollTop=l.scrollHeight;
saveMessage(s,e);
for(var r in smiley_list){
if(u.indexOf(r)!=-1){
u=u.replace(r,smiley_list[r][0])
}else{
continue
}}
if(u&&s){
var n=$msg({
to:s,type:"chat"}
).cnode(Strophe.xmlElement("body",u)).up().c("active",{
xmlns:"http://jabber.org/protocol/chatstates"}
);
connection.send(n)
}}}
function createMessage(n,h,r,s){
for(var t in smiley_list){
var e=smiley_list[t];
for(var o=0;
o<e.length;
o++){
if(r.indexOf(e[o])!=-1){
r=r.replace(e[o],t)
}else{
continue
}}}
var l="";
l+='<dl class="'+s+'">';
l+='<dt title="'+n+'"><span>'+h+"</span></dt>";
l+='<dd class="myMinWidth">'+r+"</dd>";
l+='<hr class="clear">';
l+="</dl>";
return l
}
function saveMessage(e,t){
if(e in msg_waiting){
msg_waiting[e].push(t)
}else{
msg_waiting[e]=[];
msg_waiting[e].push(t)
}}
function dateFormat(e){
var t=e.toLocaleDateString()+" "+e.toLocaleTimeString();
return t
}
function _getIsConnected(){
return isConnected
}
function isEmail(t){
var e=t.indexOf("@");
var o=t.lastIndexOf(".");
if(e<1||o<e+2||o+2>=t.length){
return false
}else{
return true
}}
function getKey(n,o){
var t=null;
for(var e in n){
if(n[e]==o){
t=e
}else{
continue
}}
return t
}
function getSid(){
return bosh_sid
}
function showEmoticons(){
var h=document.createElement("div");
h.id="divEmoticons";
document.getElementById("divChatZone").appendChild(h);
var s=document.createElement("table");
s.className="tEmoticons";
h.appendChild(s);
var o=0;
var r=0;
var t=s.insertRow(o);
o++;
for(var n in smiley_list){
var e=t.insertCell(r);
e.innerHTML=n;
r++;
e.onclick=function(){
var u=document.getElementById(onfocus_chat_id);
if(u!=null){
var d=this.innerHTML.replace("IMG","img").replace(chatZm.yazibaurl,"");
u.value+=smiley_list[d][0];
u.focus()
}
var l=document.getElementById("divEmotMean");
if(l!=null){
l.parentNode.removeChild(l)
}
h.parentNode.removeChild(h)
};
e.onmouseover=function(m){
this.className="tdEmoticonSeleced";
var u=document.getElementById("divEmotMean");
if(u==null){
u=document.createElement("div");
u.id="divEmotMean";
u.style.top=m?(m.clientY+20):(window.event.clientY+20);
u.style.left=m?m.clientX:window.event.clientX;
var l=this.innerHTML.split("/");
var d=l[l.length-1].split(".")[0];
u.innerHTML=chatZm.getMessage(d);
document.getElementById("z_shell").appendChild(u)
}};
e.onmouseout=function(){
this.className=this.className.replace("tdEmoticonSeleced","");
var l=document.getElementById("divEmotMean");
if(l!=null){
l.parentNode.removeChild(l)
}};
if(r==10){
r=0
}
if(r==0){
t=s.insertRow(o);
o++
}}}
function changeEtat(e){
var t=null;
if(e=="divChattingOption"){
t="chat"
}else{
if(e=="divBusyOption"){
t="dnd"
}else{
if(e=="divTempAwayOption"){
t="away"
}else{
if(e=="divAwayOption"){
t="xa"
}}}}
if(t!=null){
var n=$pres().cnode(Strophe.xmlElement("show",t));
connection.send(n);
for(var o in contact_ids){
n=$pres({
to:o}
).cnode(Strophe.xmlElement("show",t));
connection.send(n)
}}}
function changeBuddyStatus(n,e){
roster_pres_sub[n]["status"]=e;
if((n in contact_ids)&&document.getElementById(contact_ids[n])){
appCtxt.getAppController().setStatusMsg(n+" "+chatZm.getMessage(e),ZmStatusView.LEVEL_INFO);
var o=document.getElementById(contact_ids[n]);
var t=o.getElementsByTagName("img")[0];
if(e=="s-offline"){
t.src=status_imgs_folder+"offline.png";
o.className="b_offline"
}else{
if(e=="s-online"||e=="s-chat"){
t.src=status_imgs_folder+"online.png"
}else{
if(e=="s-busy"){
t.src=status_imgs_folder+"busy.png"
}else{
if(e=="s-temp-away"){
t.src=status_imgs_folder+"invisible.png"
}else{
if(e=="s-away"){
t.src=status_imgs_folder+"away.png"
}}}}
o.className="b_online"
}}}
function myIndexOf(t,e){
if(!Array.prototype.indexOf){
t.indexOf=function(n){
var o=this.length;
var s=Number(arguments[1])||0;
s=(s<0)?Math.ceil(s):Math.floor(s);
if(s<0){
s+=o
}
for(;
s<o;
s++){
if(s in this&&this[s]===n){
return s
}}
return -1
}
}
return t.indexOf(e)
}
window.onbeforeunload=function(){
if(connection!=null){
disconnect()
}};
document.onclick=function(r){
var s=r?r.target:window.event.srcElement;
var n=document.getElementById("divAutoComplete");
var t=document.getElementById("divEmoticons");
var o=document.getElementById("divEtatOptions");
if(n!=null&&s.id!="divAutoComplete"&&n.parentNode!=null){
n.parentNode.removeChild(n)
}
if(t!=null&&s.id!="divEmoticons"&&s.id!="btnEmoticons"&&t.parentNode!=null){
t.parentNode.removeChild(t)
}
if(s.id!=""&&s.id!="tdTitle"&&o!=null&&o.style.visibility=="visible"){
o.style.visibility="hidden"
}};
if(typeof document.getElementsByClassName!="function"){
document.getElementsByClassName=function(){
var e=document.getElementsByTagName("*");
var t=new Array();
for(i=0;
i<e.length;
i++){
if(e[i].getAttribute("class")){
ecl=e[i].getAttribute("class").split(" ");
for(j=0;
j<ecl.length;
j++){
if(ecl[j].toLowerCase()==arguments[0].toLowerCase()){
t.push(e[i])
}}}else{
if(e[i].className){
ecl=e[i].className.split(" ");
for(j=0;
j<ecl.length;
j++){
if(ecl[j].toLowerCase()==arguments[0].toLowerCase()){
t.push(e[i])
}}}}}
return t
}
};